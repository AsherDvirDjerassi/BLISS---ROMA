---
title: "Sources of Ethnic Inequality in Bulgaria: Evidence of Roma Discrimination"
author: "Asher Dvir-Djerassi"
date: ""
output:
  bookdown::pdf_book:
    toc: no
  pdf_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    number_sections: yes
bibliography: bibliography.bib
geometry: margin = 1.5in
header-includes:
- \usepackage{booktabs}
- \usepackage{lipsum}
- \usepackage{dcolumn}
- \usepackage{rotating, graphicx}
- \usepackage{float}
- \usepackage{setspace}
- \onehalfspacing
nocite: '@*'
fontsize: 11pt
subtitle: "Writing Sample: Excerpt from Master's Thesis in Data Science"
abstract: "Bulgarian Roma, who constitute roughly 10 percent of Bulgaria's population, unambiguously face some of the most egregious material poverty and discrimination in contemporary Europe. Corollary, income inequality between Roma and non-Roma in contemporary Bulgaria is dramatic. Mean and median monthly net wages of Roma are roughly 60 percent that of non-Roma earnings. In terms of total net monthly household income, Roma households saw average and median incomes half the size of non-Roma households. The aim of this paper is to decompose the factors leading to this inequality. Namely, the analysis undertaken here seeks to decompose the extent to which differences in endowments -- e.g. differences in educational attainment, regional differences, household composition, and demographics -- explain inequalities between Roma and non-Roma versus the role of factors specific to Roma -- e.g. employer discrimination, structural discrimination, and any other characteristics specific to this ethnic group. By applying the World Bank's 2013 Bulgarian Longitudinal Inclusive Society Survey to a log-linear model, there is clear evidence that belonging to the Roma ethnicity depreciates labor market earnings as well as total household income when controlling for other relevant labor market characteristics. Furthermore, via a Blinder-Oaxaca Decomposition, the contribution of different factors to the gap in economic outcomes between Bulgarian Roma and non-Roma are estimated. The estimates produced by both the Blinder-Oaxaca Decomposition and the log-linear model provide clear evidence that factors like structural and employment discrimination are driving economic inequality between Bulgarian Roma and non-Roma, rather than factors like educational or demographic differences."
---
\inputencoding{latin2}


\newpage
\tableofcontents

```{r warning=FALSE, message=FALSE, include=FALSE}
### -------- Packages ---------- ###
#NOTE: additional packages are also uploaded below when needed. 

#install.packages("tinytex")
#tinytex::install_tinytex(force = TRUE)
#install.packages("bookdown")
library("bookdown")
#install.packages("survey")
library("survey")
#install.packages("RSQLite")
library("RSQLite") 
#install.packages("tidyverse")
library("tidyverse")
#install.packages("RefManageR")
library("RefManageR")
#install.packages("foreign")
library("foreign")
#install.packages("dplyr")
library("dplyr")
library("knitr")
#install.packages("ggplot2")
library("ggplot2")
#install.packages("Hmisc")
library("Hmisc")
library("lattice") 
library("gridExtra") 
library("scales")
#options(kableExtra.latex.load_packages = TRUE)
#install.packages("kableExtra")
library("kableExtra")
#install.packages("https://CRAN.R-project.org/package=sjPlot")
require("sjPlot")
#install.packages("stargazer")
library("stargazer")
#install.packages("xtable")
library("xtable") 
#install.packages("texreg")
library("texreg")
#install.packages("magrittr")
library("magrittr")
#install.packages("survey")
library("survey")
#install.packages("tableone")
library("tableone")
#install.packages("data.table")
library("data.table")
#install.packages("oaxaca")
library("oaxaca")
#install.packages("olsrr")
library("olsrr")
#install.packages("lmtest")
library("lmtest")
#install.packages("sandwich")
library("sandwich")
#install.packages("tableone")
library("tableone")
#install.packages("texreg")
library("texreg")


### ------ Set Working Directory ###

#setwd("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal")

### -------- Create .bib file from Zotero  ---------- ###

#Link Zotero account to create bibliography in 
user_id = 2693449 #Zotero userID

collection_id = "7HMW3TNA" #Collection Key - The collection id is just the last character set after collectionKey/ at the end of the collection’s URL. https://www.zotero.org/napoleon_asher/items/collectionKey/7HMW3TNA

private_key = "UW0LHvayXhxsAYr3jpIjtA1N" # private key of zetero account can be created through the following steps: Zotero account, Home --> Settings--> Feeds/API --> then "click on "Create new private key"

biblio <- ReadZotero(user = user_id, .params = list(collection = collection_id, key = private_key )) #Creates an object called biblio which reads the reference material from the Zotero collection for which the reference IDs above link to. 

WriteBib(biblio, file = "bibliography.bib", biblatex = TRUE, append = FALSE, verbose = TRUE) #Creates a .bib document in the the working directory. Name the .bib file what the bibliography is called in the intro section (i.e. bibliography: bibliography.bib)

```

\newpage
# Introduction

Bulgarian Roma unambiguously face some of the most egregious social exclusion, material poverty, and discrimination in contemporary Europe. Presently, Bulgarian Roma -- often pejoratively termed gypsies or tsigani -- constitute roughly 10 percent of the population of Bulgaria [@european_commission_european_2014].^[The analysis for this paper was conducted in R. The Rmarkdown file used to create this PDF can be found at the Github repository for this project: https://github.com/AsherDvirDjerassi/BLISS---ROMA .] The European Union Agency for Fundamental Rights along with other EU agencies, the United Nations Development Program, the World Bank, and the Open Society Foundation have identified the degree of Roma discrimination and ethnic inequality in Bulgaria as abhorrent [*see* @ram_europeanized_2014; @the_economist_left_2015 ].^[According to the Bulgarian national census, Roma make up 5% of the population. However, it is widely agreed that the census dramatically underestimates the true size of the Roma population due to lack of proper registration of Roma, distrust of officials, and intentional obscuration of ethnicity for fear of prejudice (*see* @european_commission_european_2014 and @the_economist_left_2015).]  

These organizations and other stakeholders have made efforts to curb discrimination towards and alleviate material poverty among Bulgarian Roma.^[One such effort was the Social Inclusion Project, a joint EU, World Bank, and Bulgarian initiative launched in 2008 and concluded in 2015. Funded by a €40 million loan guarantee from the World Bank, €73.43 million in contributions from the European Social Fund, and matched by €23.30 million in funding from local communities, this single initiative guaranteed funding equal to a quarter of a percent of Bulgaria's 2007 GDP of €48.8 billion [*see* @independent_evaluation_group_project_2018].] From 2007 to 2013, 3.2 percent (or €37 million) of the funds drawn from the European Social Fund by Bulgaria were dedicated for the explicit purpose of integrating disadvantaged people, namely Roma [@european_commission_european_2014]. Despite substantial funding dedicated towards Bulgarian Roma, the European Commission (2014) has argued that funding levels are far from sufficient to deal with the extremity of the inequality of opportunity Bulgarian Roma face. The Commission claims that Bulgaria should allocate 20 percent of the funds it is eligible to withdraw from the European Social Fund for the purpose of reducing poverty and social exclusion among Roma; this would have translated into €231 million for the 2007--2013 period, or roughly half a percent of annual GDP.

Despite calls by civil society and the European Union -- alongside abundant evidence of extreme material poverty and lack of opportunity among Bulgarian Roma -- the current political make-up of Bulgaria has ensured that efforts to reduce inequality and discrimination against Roma are waning. Rather, forces of discrimination have been on the rise since the 2017 Bulgarian elections when a coalition of three ultra-rightwing parties were brought into government by Boyko Borisov, who has held the office of prime minister for a nearly continuously stretch since 2009 [*see* @dnevnik_volen_2018]. In order to maintain control of the government after an election that significantly reduced the size of the Citizens for European Development of Bulgaria (GERB), the prime minister’s party went into coalition with the United Patriots, a coalition of three ultra nationalist, anti-Roma parties that was formed in 2016.^[The following parties constitute the United Patriots: The VMRO (a faction of the Bulgarian National Movement), the National Front for the Salvation of Bulgaria (NFSB), and Ataka.]

As of October 2018, 7 out of 20 ministers and deputies minister in government come from the ultra-rightwing United Patriots. Valeri Simeonov, co-leader of the ultra-right wing coalition, currently holds the position of the Deputy Prime Minister and is tasked with overseeing Bulgaria’s National Council on Co-operation on Ethnic and Integration Issues, which is intended to coordinate policy on minority rights with Bulgarian and European NGOs. Despite holding a position designed to defend minority rights, Simeonov has called the country's Roma minority "ferocious humanoids" whose women "have the instincts of street dogs"[ @katie_french_far-right_2018].

## Evidence of Systematic Prejudice

Drawing from survey data, Alexey Pamporov, a leading Bulgarian sociologist with the Bulgarian Academy of Sciences, writes that "approximately 30% of Bulgarians do not want Roma people living in the country"[-@pamporov_drunken_2012]. Stereotypes of Roma as "lazy," "dirty," "deceitful," and "thievish" proliferate throughout Bulgarian media, popular culture, and mainstream discourse. Pamporov argues that the prevalence of these deleterious stereotypes reinforces residential and educational segregation and leads to labor market discrimination.

Pamporov, along with researchers from the Open Society Foundation, conducted content analysis on Bulgaria's leading newspapers in the few months preceding the 2009 parliamentary elections. Of the articles analyzed, 716 were identified as mentioning Roma either directly or indirectly, while "61.5% seemingly attempted to be politically correct.” These articles used "the endonyms Roma, Romani or other derivatives from these terms, [but] in the majority of articles, referring to ethnicity did not improve the articles' value and informativeness...[A quarter of articles] used the exonym Gypsies. In 55.4% of cases the protagonists are referred to as swarthy... Ethnic identity is not mentioned at all in only 1% of the articles" [@pamporov_drunken_2012, p. 145]. While Bulgarian newspapers vary widely in the share of articles that provide positive, negative, or neutral representations of Roma, typically between 11 and 33 percent of a newspaper's coverage was classified as negative. 

In a set of anonymous questionnaires presented in 2011 to ethnic Bulgarians working as doctors, social workers, or teachers, it is clear that while most ethnic minorities in Bulgaria generally have positive associations, Roma do not [@metodieva_beyond_2012]. Pomaks (ethnic-Bulgarians whose ancestors converted to Islam) and Turks are most strongly associated with being "hardworking" and "religious," while Jews and Armenians are associated with business acumen and cleverness. In sharp contrast, "Roma are depicted as criminals, lazy, dirty, liars, and uneducated both by the national level survey and in the target groups’ samples."  

A minority of respondents -- 11.8 percent of doctors, 26.6 percent of teachers, and 4.6 percent of social workers --  agreed with the following eugenical statement: “There should be lower educational standards for Roma children, because they are not able to achieve the result of the others." To further address any eugenical prejudices members of these three professions may have, those surveyed were asked whether Roma children should face a different, 'lightweight' curriculum. Specifically, respondents were asked to agree or disagree with the following statement: "Roma children are able most of all to sing and dance well, it is in their blood. Therefore, the key to their integration is music education and labor training." A large share of respondents claimed to neither agree nor disagree (21.3 percent of doctors, 8.6 percent of teachers, and a small fraction of social workers). While this degree of ambivalence is in and of itself indicative of eugenical prejudice, an additional 31.4 percent of doctors, 39.1 percent of teachers, and 20 percent of social workers agreed with this statement.  

Likewise, 63.5 percent of doctors, 67.1 percent of teachers, and 49.1 percent of social workers agreed with the following statement: “Roma women give birth to many children in order to live on social benefits, which they receive for these children." Furthermore, 35.5 percent of doctors, 33.6 percent of teachers, and 35.1 percent of social workers also agreed with this statement: "Roma suffer from many hereditary diseases, because of marriage and sexual relations between very close relatives."

Given such widespread agreement with prejudiced ideas amongst some of the most important stewards of social institutions, it should not come as a surprise that a mere 45.6 percent of ethnic Bulgarians would agree to live in the same neighborhood as Roma @metodieva_beyond_2012. Likewise, this same 2012 survey reports that a mere 12 percent of ethnic Bulgarians would be willing to marry a Roma person.


## Ethnic Inequality and Discrimination in Bulgaria

While it is beyond the scope of this article to establish the complete array of possible consequences that such stereotypes engender, the pervasiveness of negative stereotypes gives strong reason to believe that discrimination against Bulgarian Roma is widespread and plays a significant role in shaping the gap between Roma and ethnic Bulgarians. The EU Agency for Fundamental Rights surveyed minorities across Europe to find the relative incidence of hate-motivated harassment. Roma across Europe experienced the highest rate of hate-motivated harassment of any ethnic minority [@european_union_agency_for_fundamental_rights_survey_2014]. Furthermore, of all ethnic minorities in the EU, Bulgarian Roma have the second lowest level of trust in their legal system after Estonian Roma @european_union_agency_for_fundamental_rights_survey_2014

Amnesty International (2018) claims that "marginalization and widespread discrimination against Roma persists." In addition to employment discrimination, Amnesty stresses the obstacles Bulgarian Roma face in accessing public services, particularly education, healthcare, housing, and infrastructure (particularly sewage, trash collection, and clean roads). The most striking and visceral manifestation of ethnic inequality in Bulgaria is the severe inadequacy of infrastructure and housing in Roma communities. According to a 2011 survey conducted by the EU Agency for Fundamental Rights, which surveyed Roma households in primarily Roma neighborhoods and ethnic Bulgarians that lived near to these communities, 39 percent of Roma dwellings had no piped water inside compared with 4 percent of non-Roma dwellings nearby (@european_union_agency_for_fundamental_rights_survey_2014). 75 percent of Roma dwellings had no indoor toilet, relative to 31 percent of non-Roma dwellings nearby. Roma versus non-Roma with dwellings connected to sewage was 39 versus 13 percent, while access to electricity was 7 percent versus 1 percent. 

The root of this widespread segregation, inadequate housing, and subpar infrastructure lies partly in the forced settlement of Bulgarian Roma in 1958. After the completion of full land collectivization by the Communist regime, the Bulgarian politburo outlawed the often migratory living patterns of Roma.^[*See* @ilieva_number_2012 discussion of the Bulgarian Census]. Like the Communist Party's policy towards Bulgarian Turks, ethnic self-identification was heavily discouraged and collective advocacy for Roma causes was censured. The combination of sudden urbanization, lack of political representation, and prejudice on the part of the Communist regime created conditions where Roma were segregated into ghettos. After the fall of communism in the early 1990s, the collapse of state structures allowed for Bulgarian Roma to effectively squat in a manner comparable to Brazilian favelas and slums found elsewhere in the Global South [*see* @barany_politics_2000]. Such communities lacked and continue to lack de jure access to public services, as the state does not recognize a formal responsibility as it does in providing public services to legal dwellings. 

Despite clear evidence of discrimination, Bulgarian Roma report feeling discriminated against the least often among European Roma. When asked if a Bulgarian Roma person felt they had been discriminated against in the past 12 months, 30 percent of respondents said yes -- markedly lower than the typical response in Europe.^[*See* @european_union_agency_for_fundamental_rights_second_2017] Meanwhile, a mere 19 percent of Bulgarian Roma active in the labor market believed that they had been discriminated against when seeking work in the past 5 years. Two percent of working age Bulgarian Roma respondents claimed that they were not looking for work because "Roma are not hired." In contrast, the typical response for Roma in other European countries is around 4 to 6 percent. The only other countries with lower responses to this question were Hungary and Spain.  

These survey responses are puzzling. Despite widespread inequality, discrimination is not felt, particularly when it comes to the labor market. This begs the question of what relative role labor market discrimination plays in determining economic inequality between ethnic groups in Bulgaria. In terms of labor market outcomes, the gap between Roma and ethnic Bulgarians is very wide. For those of prime working age, 20--64 years old, 68 percent of non-Roma Bulgarians had at least part-time employment compared to 49 percent of Roma.^[The employment rate of ethnic Bulgarians comes from Eurostat, while the employment rate for Roma was collected in the second wave of the European Union Minorities and Discrimination Survey, 2016.]

However, it may be the case that discrimination is not as instrumental in explaining this gap as the ubiquity of negative stereotypes and prejudice may suggest. Rather, it may be the case that the gap in labor market outcomes between Roma and the rest can be largely explained by differences in relevant labor market characteristics that are outside of ethnicity, such as how much education one has, the skills one possesses, and the region one lives in. In terms of education, Roma have paltry educational outcomes relative to ethnic Bulgarians. According to the 2011 Fundamental Rights Agency Roma Survey, 67 percent of adult Roma reported leaving school before the age of 16. In contrast, a mere 26 percent of non-Roma living in the same communities as these Roma reported leaving school before 16. 

Decomposing the relative impact of factors driving ethnically-based economic inequality is essential to the enterprise of bridging this ethnic divide. With funds dedicated to the plight of Bulgarian Roma withering alongside the rise of ultra-rightwing political parties, ensuring the efficiency of each euro dedicated to ameliorating Roma poverty has even more urgency.

## Research Question

This paper seeks to answer the following: What is the relative impact of differences between non-Roma and Roma in terms of characteristics relevant to the labor market and earnings, such as educational attainment, on income disparities between these ethnic groups? Furthermore, what is the impact of being Roma, independent of such labor market factors? Otherwise stated, are there certain unobservable, Roma-specific characteristics that drive inequality between Roma and non-Roma, such as labor market discrimination or structural inequalities? 

## Data

This paper uses the Bulgarian Longitudinal Inclusive Society Survey (BLISS). BLISS is part of a larger panel survey collected between February 2010 and April 2013 from a representative sample of Bulgarian households at the behest of the World Bank and the Open Society Institute--Sofia. Information on demographics, education, taxes, transfers, and other relevant labor market information on the household and individual household members were collected. 

Distinctive among comparable surveys in Bulgaria, this panel survey can identify a representative sample of those who identify as ethnically Roma and ethnically Bulgarian. To garner sufficient variation among Bulgarian Roma, BLISS surveyed a greater number of Roma households than would be proportionate to their share of the population (i.e. a ‘booster’ sample). 

This representative survey was able to follow households and the members of those households across the survey period (February 2010 to April 2013) with quite little attrition. The planned size of the main sample in the first round was 2,384 households, and 99% of this sample was realized. A Bulgarian Roma booster sample of 296 households was planned for, with 99% of this sample realized as well. 


```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
## Data Preparation

##The procedure for merging the constituent data-sets is quite complicated, therefore, I have included an rds file on github that may be easily download in lieu of merging and cleaning the data as I originally did. However, in the r chunk below, the code used to merge the constituent data-sets is shown, albeit commented-out.

#NOTE: This prodecure can be reproduced most easily by downloading the data files from the Github repo below. The data files are organized such that a reference file, BGR_2013_BLISS_v01_M_M1.dta, is in a seperate folder (M_M1) from the files that make up 'file_list': https://github.com/AsherDvirDjerassi/BLISS---ROMA/tree/master/BLISS%20Data

#Create a data frame, which is set equal to one dataset that has all observations and household and member IDs (i.e. HH_ID and HHM_ID). I use the first dataset in the collection of the BLISS survey (i.e. BGR_2013_BLISS_v01_M_M1.dta). This file has been placed outside of the folder that is used to create the list of other datasets so that it is not included twice. 

#dataset <- data.frame()

#dataset <- read.dta("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_M1.dta") 


#dataset$m1_q1 <- iconv(dataset$m1_q1,from="CP1251",to="UTF-8") #Read names as Bulgarian Cyrillic

#Create a list of the files from the target directory.

#file_list <- list.files(path="/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_Stata8")

#colnames(dataset) <- toupper(names(dataset))    #Makes all columns names upper-case
#if ("ID_HOUSEHOLD" %in% colnames(dataset)){     #Deals with cases where HH_ID is named ID_household
#  dataset <- rename(dataset, "HH_ID" = "ID_HOUSEHOLD")
#}
#if ("HHM_ID" %in% colnames(dataset)){           #Makes data type of HHM_ID the same
#  dataset$HHM_ID <- as.character(dataset$HHM_ID)
#}
#if ("HH_ID" %in% colnames(dataset)){            #Makes data type of HH_ID the same
#  dataset$HH_ID <- as.character(dataset$HH_ID)
#}

#for (i in 1:length(file_list)) {
#  setwd("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_Stata8")
#  temp_data <- read.dta(file_list[i])               #Each data file is read
#  colnames(temp_data) <- toupper(names(temp_data))  #Makes all columns names upper-case
#  if ("ID_HOUSEHOLD" %in% colnames(temp_data)){     #Deals with cases where HH_ID is named ID_household
 #   temp_data <- rename(temp_data, "HH_ID" = "ID_HOUSEHOLD")
#  }
#  if ("HHM_ID" %in% colnames(temp_data)){           #Makes data types the same
 #   temp_data$HHM_ID <- as.character(temp_data$HHM_ID)
#  }
#  if ("HH_ID" %in% colnames(temp_data)){            #Makes data types the same
 #   temp_data$HH_ID <- as.character(temp_data$HH_ID)
#  }
#    if(length(unique(temp_data$HHM_ID))>1){
#    dataset <- left_join(dataset, temp_data, by = c("HH_ID","HHM_ID"))
#    } else {
#    temp_data$HHM_ID <- NULL
#    dataset <- left_join(dataset, temp_data, by = c("HH_ID"))
#    }
#}

#Add Psych Data
#psych_data <- read.dta("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_Stata8/BGR_2013_BLISS_v03_M_Psyh.dta")
#colnames(psych_data)[c(4,5)]<-c("HH_ID","HHM_ID")
#psych_data$HHM_ID <- as.character(psych_data$HHM_ID)
#psych_data$HH_ID <- as.character(psych_data$HH_ID)
#dataset <- left_join(dataset, psych_data, by = c("HH_ID","HHM_ID"))

#Add wt_bliss_cs_cs_ind
#wt_bliss_cs_cs_ind <- read.dta("/Users/jmaasch/Downloads/wt_bliss_cs_cs_ind.dta")
#colnames(wt_bliss_cs_cs_ind)[c(1, 9)]<-c("HH_ID","HHM_ID")
#wt_bliss_cs_cs_ind[c(2:8,10:11,13)]<-NULL
#colnames(wt_bliss_cs_cs_ind)[c(3,4)]<-c("wt_bliss_cs_cs_ind","wt_adj_bliss_cs_cs_ind")
#wt_bliss_cs_cs_ind$HHM_ID <- as.character(wt_bliss_cs_cs_ind$HHM_ID)
#wt_bliss_cs_cs_ind$HH_ID <- as.character(wt_bliss_cs_cs_ind$HH_ID)
#dataset <- left_join(dataset, wt_bliss_cs_cs_ind, by = c("HH_ID","HHM_ID"))

#saveRDS(dataset, "dataset.rds")
#getwd()
```



```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
###### ------------------------ LOOK BELOW!------------------------------- ########

#Read Data
dataset <- readRDS("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Roma Paper/Capstone - rds and r script/dataset.rds")

dim(dataset)

#NOTE: There are 7468 rows in the final data, when there should be 7467 rows. However, when creating the set of depedent and independent variables, the dataframe used in this analysis has the proper number of rows.

#The data above can be accessed directly here: https://github.com/AsherDvirDjerassi/BLISS---ROMA/blob/master/Data%20and%20Script/dataset-2.rds
```


```{r Potential Dependent Variables, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Potential Dependent Variables

#There are two dependent variables used in this project: net monthly average wages and net monthly household income

## Income components

# Taxable employment income + Income from capital, e.g. dividends and interests  + Income received by children + Income from occupational and private pensions + Private transfers received + Income from property + Taxable self-employment income + Non-reported employment income + Non-reported self-employment income - Maintenance payments

#Benefits simulated by EUROMOD: Child benefit for education  (целева помощ за ученици) + Guaranteed minimum income (помощ за социално подпомагане : гарантиран минимален доход) + Means-tested child benefit (месечна помощ за отглеждане на дете) + Contributory maternity benefit for pregnancy and childbirth (Обезщетение за бременност и майчинство) + Non-contributory benefit for raising a child under the age of 1 (месечна помощ за отглеждане на дете до 1 г. възраст) + Heating benefit (целева помощ за отопление) + Unemployment benefit (обезщетениe за безработица) + Contributory maternity benefit for bringing up child up to age 2 (Обезщетение за отглеждане на дете до 2г.) + Non-means tested child benefit for mothers in tertiary education (from 2009 on) + Non-means tested child benefit for twins (from 2009 on) + Birth grant (also for adoption) (еднократна помощ при раждане)				
#Benefits derived from EU-SILC: Sickness benefits + Lump sum pregnancy grant + Other non-means-tested family benefits + Other unemployment benefits + Educational benefit (scholarships etc.) + Other (complementary) non-means-tested social assistance benefits + Old-age pension + Survivor pensions + Disability pensions + Housing benefits + Other means-tested social assistance + Other means-tested family benefits

#-------------------------------------

# Module 2A: Labor, for Everyone in Household 15 Years and Over 
# Module 2B: For Members who Reported Working in Past 4 Weeks
# 
# dataset$M2_Q3[1:100] # Have you worked in the past 4 weeks? 
# dataset$M2_Q10A[1:100] #m2_q10 What is the total net amount that [NAME] has earned in the past 12 months
# dataset$M2_Q16A[1:100] #m2_q16a What are [NAME'S] MONTHLY AVERAGE NET wages (net of taxes and contributions). 
# dataset$M2_Q17A[1:100] #m2_q17a What are [NAME'S] MONTHLY AVERAGE NET earnings from this work or busines (current work) 

#-------------------------------------
# 
# #Module 5A: Social Assistance
# 
# dataset$M5A_Q2_11[1:100]#What was/is the monthly value of this allowance for all household members? Monthly child benefits (for children under 18 years, or 20 if in school)
# dataset$M5A_Q3_11[1:100]#What was/is the monthly value of this allowance for all household members? Infant benefits (for children under 1 year or 2 years if disabled)
# dataset$M5A_Q4_11[1:100]#What was/is the monthly value of this allowance for all household members? Monthly social assistance for low income households
# dataset$M5A_Q5_11[1:100] #What was/is the monthly value of this allowance for all household members? Heating allowance
# 
# #-------------------------------------
# 
# #Module 5B: Unemployment Benefits
# 
# dataset$M5B_Q6[1:100]#What is the monthly value of the unemployement benefits?
# 
# #-------------------------------------
# 
# #The dataset contains information from Module 5C: Other Social Protection
# 
# dataset$M5C_Q2E[1:100]#What pensions, aid or benefits did [NAME] receive in the past 12 months? What is the monthly value of this benefit [NAME] received?
# dataset$M5C_Q3E[1:100] #What pensions, aid or benefits did [NAME] receive in the past 12 months? What is the monthly value of this benefit [NAME] received?
# 
# #------------------------------------
# 
# #Module 10: Subjective
# dataset$M10_Q19[1:100]#What is the total net monthly income of your household at the moment (Total sum of the household members income from salaries/wages, pensions, social and family assistance, regular transfers from persons outside the household and from other sources)?
#-------------------------------------

```


```{r Clean and Transform Independent Variables, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

####Clean and Transform Independent Variables
#----------------------------------------------\


#Combined the data above into dependent variables
#Convert dep_vars from matrix to dataframe
dep_vars <-  dataset %>% 
                    select(HH_ID,
                          HHM_ID, 
                          M1_Q22, 
                          SAMPLE_TYPE.x,
                          M2_Q3, 
                          M2_Q16A, 
                          M5A_Q2_11, 
                          M5A_Q3_11,
                          M5A_Q4_11, 
                          M5A_Q5_11, 
                          M5B_Q6, 
                          M5C_Q2E, 
                          M5C_Q3E, 
                          M10_Q19, 
                          WTA_ADJ_HH, 
                          wt_adj_bliss_cs_cs_ind, 
                          wt_bliss_cs_cs_ind)

#Rename columns of dependent variables dataset
names(dep_vars) <- c("HH_id",
                     "HHM_id",
                     "Ethnicity",
                     "Booster or Main Sample",
                     "worked in the past 4 weeks",
                     "monthly average net wages",
                     "monthly value of child benefits",
                     "monthly value of infant benefits",
                     "monthly value of social assistance",
                     "monthly value of heating allowance",
                     "monthly value of the unemployement benefits",
                     "monthly value of pension, aid, or benefits, 1",
                     "monthly value of pension, aid, or benefits, 2",
                     "total net monthly household income", 
                     "household weights", 
                     "individual weights with population adjustment",
                     "individual weights without population adjustment")
#-------------------------------------


dep_vars$`Booster or Main Sample` <- ifelse((dep_vars$`Booster or Main Sample`)==1, "Main sample", "Booster sample")

# yes is coded as 1 and no is coded as 2 
dep_vars$`worked in the past 4 weeks`<-ifelse((dep_vars$`worked in the past 4 weeks`)==1,1, 0)

#-------------------------------------
#If ethnicity is N/A, then set ethnicity equal to the value of another member of their household, HH_id. 
setDT(dep_vars)[, ethnic := unique(Ethnicity[!is.na(Ethnicity)]), by = HH_id]


#Display the household id and member id in addition to the old ethnicity column and the new ethnicity column. 
df <- dep_vars %>% select(HH_id, HHM_id, Ethnicity, ethnic); df[100:125]; 

#Display the df for rows that contained NA for ethnicity.
head(filter(df, Ethnicity %in% NA))

#Drop old Ethnicity
dep_vars$Ethnicity <- NULL


 #-------------------------------------

#Converts all columns to numeric
dep_vars[,3:14][is.na(dep_vars[,3:14])] <- 0 

#Convert all relevant columns to numeric
dep_vars$`monthly average net wages` <- as.numeric(dep_vars$`monthly average net wages`)

dep_vars$`monthly value of child benefits` <- as.numeric(dep_vars$`monthly value of child benefits`)

dep_vars$`monthly value of infant benefits` <- as.numeric(dep_vars$`monthly value of infant benefits`)

dep_vars$`monthly value of social assistance` <- as.numeric(dep_vars$`monthly value of social assistance`)

dep_vars$`monthly value of heating allowance` <- as.numeric(dep_vars$`monthly value of child benefits`)

dep_vars$`monthly value of the unemployement benefits` <- as.numeric(dep_vars$`monthly value of the unemployement benefits`)

dep_vars$`monthly value of pension, aid, or benefits, 1` <- as.numeric(dep_vars$`monthly value of pension, aid, or benefits, 1`)

dep_vars$`monthly value of pension, aid, or benefits, 2`<- as.numeric(dep_vars$`monthly value of pension, aid, or benefits, 2`)

dep_vars$`total net monthly household income`<- as.numeric(dep_vars$`total net monthly household income`)

dep_vars$`household weights` <- as.numeric(dep_vars$`household weights`)

```



```{r Table 4.3 Market incomes number of recipients, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

#Make household weights numeric 
dep_vars$`household weights` <- as.numeric(dep_vars$`household weights`)

#Positive monthly average wages (i.e. employed)
dep_vars$`Positive monthly average wages` <- ifelse((dep_vars$`monthly average net wages`)>0,1,0)
dep_vars$`Positive monthly average wages` <- ifelse(is.na(dep_vars$`monthly average net wages`),0,1)
sum(dep_vars$`Positive monthly average wages`)

#Worked in the past 4 weeks (i.e. employed) - This is the same as the above metric
dep_vars$`worked in the past 4 weeks` <- ifelse((dep_vars$`worked in the past 4 weeks`)==2,0,1)
dep_vars$`worked in the past 4 weeks` <- ifelse(is.na(dep_vars$`worked in the past 4 weeks`),0,1)
sum(dep_vars$`Positive monthly average wages`)

dep_vars$`individual weights with population adjustment` <- as.numeric(dep_vars$`individual weights with population adjustment`)
dep_vars$`individual weights without population adjustment` <- as.numeric(dep_vars$`individual weights without population adjustment`)

```






```{r Sample `household weights`, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Sample `household weights`
#In the subsections below, I walk through the process of assigning sample `household weights` to the data. Additionally, I compare BLISS income data with household `household weights` applied to the data on Bulgarian households from the European Union Survey of Income and Living Conditions. 

## Household sample `household weights` applied to the sample at the individual level


# Discussion of `household weights` in BLISS survey documentation: 
# The propensity score represents the probability that an individual with a particular combination of characteristics would be successfully interviewed, and is therefore a measure of the response rate at the micro level. By multiplying the basic weight by the inverse of this response rate, the weighted estimates reduce the bias due to some groups being under-represented in the sample due to nonresponse. The logistic response propensity scores were calculated separately for the data from the CMS2, CMS3 and BLISS panels of sampleindividuals for the Main Survey and the Booster Survey. Another attritionn analysis was run for the panel households interviewed in all waves of each survey


#Combined booster and main sample HH `household weights` for analysis
head(dep_vars$`household weights`)

#Set N/A's equal to 0 in the household `household weights`
dep_vars$`household weights`[is.na(dep_vars$`household weights`)] <- 0  

dep_vars$`household weights` <- as.numeric(dep_vars$`household weights`)
typeof(dep_vars$`household weights`)
```



```{r Create household df, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Create dataframes of household income by source
#----------------------------------------------
dataset$M5A_Q3_11_PERYEAR[is.na(dataset$M5A_Q3_11_PERYEAR)] <- 0 
dataset$M5A_Q2_11_PERYEAR[is.na(dataset$M5A_Q2_11_PERYEAR)] <- 0 
dataset$M5A_Q4_11_PERYEAR[is.na(dataset$M5A_Q4_11_PERYEAR)] <- 0 
dataset$M5A_Q5_11[is.na(dataset$M5A_Q5_11)] <- 0 
dataset$M5C_Q2_PERYEAR[is.na(dataset$M5C_Q2_PERYEAR)] <- 0 
dataset$M5B_Q6_P[is.na(dataset$M5B_Q6_P)] <- 0 
dataset$M2_Q16_PERYEAR[is.na(dataset$M2_Q16_PERYEAR)] <- 0 


#1) household monthly value of infant benefits
`infant benefits` <- aggregate(dataset$M5A_Q3_11_PERYEAR, by=list(dataset$HH_ID), FUN=sum)

#2) household monthly value of child benefits
`child benefits` <- aggregate(dataset$M5A_Q2_11_PERYEAR, by=list(dataset$HH_ID), FUN=mean)

#3) household monthly value of social assistance
`social assistance` <- aggregate(dataset$M5A_Q4_11_PERYEAR, by=list(dataset$HH_ID), FUN=mean)

#4) household heating allowance
`heating allowance` <- aggregate(dataset$M5A_Q5_11, by=list(dataset$HH_ID), FUN=mean)

#5) Household total pensions
hh_pension <- aggregate(dataset$M5C_Q2_PERYEAR, by=list(dataset$HH_ID), FUN=sum)

#6) Unemployment insurance
`unemployment insurance` <- aggregate(dataset$M5B_Q6_P, by=list(dataset$HH_ID), FUN=sum)

#7) Household Income
hh_income <- (aggregate(dep_vars$`total net monthly household income`, by=list(dep_vars$HH_id), FUN=mean))

hh_income$x <- hh_income$x*12

#8) Household average net wages
hh_average_net_wages <-   aggregate(dataset$M2_Q16_PERYEAR, by=list(dataset$HH_ID), FUN=sum)

#9) Household Ethnicity --- particularly in the event that there are multiple ethnic groups in household
dep_vars$Roma <- ifelse( dep_vars$ethnic==3, 1, 0)
hh_roma <- aggregate(dep_vars$Roma, by=list(dep_vars$HH_id), FUN=mean)
unique(hh_roma[,2])
hh_roma[,2] <- ifelse((hh_roma[,2])==0,0, 1)
unique(hh_roma[,2])


#Use cbind to form one dataframe for household data

hh_data <- cbind.data.frame(`heating allowance`,
                            hh_average_net_wages[,2],
                            hh_income[,2],
                            hh_pension[,2], 
                            hh_roma[,2],
                            `infant benefits`[,2],
                            `child benefits`[,2],
                            `social assistance`[,2],
                            `unemployment insurance`[,2])

colnames(hh_data) <- c("HH_id","heating allowance", "average net wages", "total net household income", "household pension income", "Roma household", "household infant benefits", "household child benefits", "household social assistance income", "unemployment insurance")


dim(hh_data) #proper length (i.e. equal to the number of households) 
head(hh_data)


###----------
#hh weight
sum(is.na(dep_vars$`household weights`)) # no na values in household weights

#Extract household `household weights` - one weight per household (2525 observations)
HH_weight <- aggregate(dep_vars$`household weights`, by=list(dep_vars$HH_id), FUN=mean)

colnames(HH_weight) <- c("HH_id","HH_weight")

hh_data <- left_join(hh_data, HH_weight, by ="HH_id")

#check whether there are na values
unique(is.na(hh_data$HH_weight))

#REMOVE TIHNGS NOT NEEDED 
rm(`heating allowance`,
   hh_average_net_wages,
    hh_income,
    hh_pension, 
    hh_roma,
    `infant benefits`,
    `child benefits`,
    `social assistance`,
   `unemployment insurance`,
    HH_weight)
```

```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

total_benefits <- list()

#1) household heating allowance
total_benefits$`total monthly heating allowance` <- sum(hh_data$`heating allowance`*hh_data$HH_weight)

#2) Household average net wages
total_benefits$`total net wages` <- sum(hh_data$`average net wages`*hh_data$HH_weight)

#3) Household Income
total_benefits$`total household income` <- sum(hh_data$`total net household income`*hh_data$HH_weight)

#4) Household total pensions
total_benefits$`total pension` <- sum(hh_data$`household pension income` * hh_data$HH_weight)

#5) household monthly value of infant benefits
total_benefits$`total infant benefits` <- sum(hh_data$`household infant benefits`*hh_data$HH_weight)

#6) household monthly value of child benefits
total_benefits$`total child benefits` <- sum(hh_data$`household child benefits`*hh_data$HH_weight)

#7) household monthly value of social assistance
total_benefits$`total social assistance` <- sum(hh_data$`household social assistance income`*hh_data$HH_weight)

#8) household monthly value of unemployment
total_benefits$`unemployment insurance` <- sum(hh_data$`unemployment insurance`*hh_data$HH_weight)

total_benefits <- as.data.frame(total_benefits)/1000000

colnames(total_benefits) <- c("total monthly heating allowance", "total net wages", "total net household income", "household pension income", "household infant benefits", "household child benefits", "household social assistance income", "unemployment insurance benefits")

#Transposed total benefits annually
t(total_benefits)


#EU-SILC and administrative data
eu_silc = c(35, 25646, NA ,9469, 73, 236, 23, 363)
external = c(75, 27765, NA ,7461, 142, 352, 54, 351)  

#Monthly child benefits (for children under 18 years, or 20 if in school)	
#Infant benefits (for children under 1 year, or 2 years if disabled)	
  
euromod <- t( data.frame(eu_silc, external))

colnames(euromod) <- c("total monthly heating allowance", "total monthly average net wages", "total net monthly household income", "household pension income", "household infant benefits", "household child benefits", "household social assistance income", "unemployment insurance benefits")

euromod <- as.data.frame(t(euromod))

total_benefits <- as.data.frame(t(total_benefits))
total_benefits <- cbind(total_benefits, euromod)

colnames(total_benefits) <- c("BLISS", "EU-SILC", "Administrative Data")

total_benefits$`Ratio BLISS/EU-SILC`<-total_benefits$BLISS/ total_benefits$`EU-SILC`

total_benefits$`Ratio BLISS/Administrative Data`<-total_benefits$BLISS/ total_benefits$`Administrative Data`

table(total_benefits)

```




## Table of number of recipients in thousands by data source
#EU-SILC and administrative data
```{r}

total_recipients <- list()

#1) household heating allowance
total_recipients$`heating allowance` <- sum(ifelse(hh_data$`heating allowance`!= 0, 1, 0)*hh_data$HH_weight)
  
#2) individuals employed
total_recipients$`individuals employed` <- NA

#3) total pensions
total_recipients$`pension` <- NA

#4) household monthly value of infant benefits
total_recipients$`infant benefits` <- sum(ifelse(hh_data$`household infant benefits`!= 0, 1, 0)*hh_data$HH_weight)

#5) household monthly value of child benefits
total_recipients$`total child benefits` <- sum(ifelse(hh_data$`household child benefits`!= 0, 1, 0)*hh_data$HH_weight)

#6) household monthly value of social assistance
total_recipients$`unemployment insurance` <- NA

#7) household monthly value of social assistance
total_recipients$`social assistance` <- sum(ifelse(hh_data$`household social assistance income`!= 0, 1, 0)*hh_data$HH_weight) 
  
total_recipients <- as.data.frame(total_recipients)/1000

#Transposed total benefits annually
t(total_recipients)


eu_silc = c(35, 2930, 2967, 38, 344, 18, 201)
external = c(75, 2935, 2670, 62, 537, 50, 117)  

#Monthly child benefits (for children under 18 years, or 20 if in school)	
#I assume this refers to means tested child benefit


#Infant benefits (for children under 1 year, or 2 years if disabled)	
  
euromod_recipients <- t( data.frame(eu_silc, external))

colnames(euromod_recipients) <- c("households receiving heating allowances", "individuals employed", "household pension income", "households receiving infant benefits", "households receiving child benefits", "household receiving social assistance income", "individuals receiving unemployment insurance benefits")

euromod_recipients <- as.data.frame(t(euromod_recipients))

total_recipients <- as.data.frame(t(total_recipients))
total_recipients <- cbind(total_recipients, euromod_recipients)

colnames(total_recipients) <- c("BLISS", "EU-SILC", "Administrative Data")

total_recipients$`Ratio BLISS/EU-SILC`<-total_recipients$BLISS/ total_recipients$`EU-SILC`

total_recipients$`Ratio BLISS/Administrative Data`<-total_recipients$BLISS/ total_recipients$`Administrative Data`

table(total_recipients)
```


```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

#Weighted dataset
weighted_dataset <-svydesign(id=~1, weights = ~"household weights" , data = dep_vars)

#Table of weighted 
weighted_table <- svyCreateTableOne(vars = "pensions", data=weighted_dataset$variables)

#Print weighted table of pensions, for those with positive pension values. 
print(weighted_table, smd= TRUE) #Weighted data
mean(dep_vars$pensions, na.rm= TRUE); sd(dep_vars$pensions, na.rm= TRUE) #Raw data

#The mean and sd of pensions in the weighted data is about 10 leva higher than that of the raw data. 
```






```{r Household sample `household weights` applied to household data, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

##Household sample `household weights` applied to household data
##-------------------------------------------------

#Create weighted household data
weighted_hh_data <-svydesign(id=~1, weights =~hh_data$HH_weight, data=hh_data)

#Table of weighted data 
weighted_hh_table <- svyCreateTableOne(vars = c("pensions"), data=weighted_hh_data)

#Weighted mean and sd of total pensions by household
print(weighted_hh_table, smd = TRUE)
#Weighted mean and sd of pensions by individual
print(weighted_table, smd= TRUE)
#Unweighted mean and sd of pensions by individual
mean(dep_vars$pensions, na.rm= TRUE); sd(dep_vars$pensions, na.rm= TRUE)
```






```{r Household sample `household weights` employed to display monthly total income, pension income, and government transfer income by total household income deciles,  message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Household sample `household weights` employed to display monthly total income, pension income, and government transfer income by total household income deciles. 
##----------------------------------------------


#Find weighted household total income deciles. 
weighted_hh_data<-svydesign(id=~1, weights=~hh_data$HH_weight, data=hh_data)

#Create deciles
dt_quantile = svyquantile(~`total monthly net household income`, design = weighted_hh_data, quantiles = seq(.1, 1, by=0.1), method = "linear", ties="rounded")

#Change direction of the table (wide to long)
dt_quantile = data.table(t(dt_quantile), keep.rownames = T)

#Display table
dt_quantile

#-------------------------------------

#Assign net total weighted income deciles
weighted_hh_data$variables$decile <- 0

#Assign First Decile 
weighted_hh_data$variables$decile[weighted_hh_data$variables$`total monthly net household income` < as.numeric(dt_quantile[1,2])]<- 1

#Assign Decile 2-9
for (i in 1:8){
  weighted_hh_data$variables$decile[weighted_hh_data$variables$`total monthly net household income` >= as.numeric(dt_quantile[i,2]) & weighted_hh_data$variables$`total monthly net household income` < as.numeric(dt_quantile[i+1,2])] <- i+1
  }  

#Assign Decile 10
weighted_hh_data$variables$decile[weighted_hh_data$variables$`total monthly net household income` >= as.numeric(dt_quantile[9,2])] <- 10

#Check whether the assignment of deciles was successful.
head(weighted_hh_data$variables$decile)
unique(weighted_hh_data$variables$decile) #All deciles exist
sum(weighted_hh_data$variables$decile==0) #There are no zeros

#-------------------------------------
df <- weighted_hh_data$variables
df[df==0] <- NA
household_income_by_decile <- data.frame(aggregate(df, by=list(df$decile), FUN=mean, na.rm=TRUE))
household_income_by_decile[,3:6]
```




##### ## Compare weighted household survey data with European Union Statistics on Income and Living Conditions (EU-SILC). 





```{r Appendix, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Compare weighted household survey data with European Union Statistics on Income and Living Conditions (EU-SILC). 
#-----------------------------------------------------------------------

#Import data from the 2013 EU-SILC and EUROMOD on the household income by total income decile.
#Data can be found here: https://www.euromod.ac.uk/sites/default/files/statistics/WebStatistics_G3.0%2B_HHIncome_v2.xls

p = c(1,2,3,4,5,6,7,8,9,10)
n = c(360.6, 470.0, 646.9, 825.6, 1023.3, 1220.7, 1407.2, 1619.0, 2043.3, 3411.1)
s = c(106.9, 54.8, 40.7, 37.2, 62.0, 64.5, 59.8, 69.5, 99.2, 214.6)
b = c(79.6, 232.9, 277.9, 300.7, 277.6, 324.6, 307.1, 371.3, 341.0, 329.6)
EU_SILC = data.frame(p,n, s, b)

colnames(EU_SILC) <- c("Decile","Total household income - EU-SILC", "Total government income, excluding pensions EU-SILC", "Total pension income EU-SILC")

#-------------------------------------
#The table below compares the weighted BLISS survey data and data from one of the most widely respected representative surveys, the European Union Statistics on Income and Living Conditions (EU-SILC). Differences in the government benefits between the two data likely are due to the Euromod that is being relied upon to impute government benefit information. Otherwise, though, the BLISS data seems to very much underestimate household income data. The likely reason for this is that far fewer households were sampled than in the EU-SILC per geographic region. In turn, the survey may 


### Table
#-------------------------------------
#Combined the two tables, the weighted data from the BLISS Survey and the data from the EU-SILC/Euromod, and compare. 
kable(cbind(EU_SILC, household_income_by_decile[,3:6] ))

```




###THIS IS WHERE I SUBSET THE DATA INTO BULGARIAN AND ROMA




```{r Create Roma/non-Roma catergory, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Create Roma/Bulgarian catergory
#----------------------------------------------

#Eliminate rows where ethnicity is not reported
#dep_vars <- subset(dep_vars, !is.na(dep_vars$ethnic)); sum(is.na(dep_vars$ethnic))

#Unqiue ethnicity catergories
unique(dep_vars$ethnic)
count(dep_vars, c(ethnic))

#Make ethnic a dummy variable that takes on the value 1 if Roma and 0 if not. 
#dep_vars$ethnic <- ifelse((dep_vars$ethnic)==3,1, 0)

###############----------------- Subset data 

#############################    dep_var_roma_bg


dep_var_roma_bg <- subset(dep_vars, ethnic==1 | ethnic==3)


##############---------------------


#Create Roma column --- Roma and Bulgarian values 

dep_var_roma_bg$Roma <- ifelse((dep_var_roma_bg$ethnic)==3,"Roma", "Bulgarian")

```




```{r Deciles by Roma and Bulgaria}



########### THIS NEEDS TO BE COMPLETELY CHANGED 
############ THE ETHNIC THING IS TOTALLY OFF!!!!!!!!



# #subset for only Roma
# df_roma <- subset.data.frame(weighted_hh_data$variables, weighted_hh_data$variables$ethnic==1)
# df[df==0] <- NA
# household_income_by_decile_df_roma <- data.frame(aggregate(df_roma, by=list(df_roma$decile), FUN=mean, na.rm=TRUE))
# 
# #subset for only non-Roma
# df_non_roma <- subset.data.frame(weighted_hh_data$variables, weighted_hh_data$variables$ethnic==0)
# df[df==0] <- NA
# household_income_by_decile_non_roma <- data.frame(aggregate(df_non_roma, by=list(df_non_roma$decile), FUN=mean, na.rm=TRUE))
```






## INDEPENDENT VARIABLE AREA!!!!!!





```{r Potential Independent Variables, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Potential Independent Variables
#---------------------------------------


#Module 1A: Roster and Module 1B: Education 

#---------------------------------------

#Module 2A: Labor, for Everyone in Household 15 Years and Over and Module 2B: For Members who Reported Working in Past 4 Weeks

unique(dataset$M2_Q7D) #What is the minimum monthly wage you would accept right now to start working?

dataset$M2_Q7F <- ifelse(is.na(dataset$M2_Q7F),"no","yes")
unique(dataset$M2_Q7F) #Would you be willing to move to a different settlement in Bulgaria for a job?

dataset$M2_Q7E[is.na(dataset$M2_Q7E)] <- 0 
dataset$M2_Q7E[1:100] #How far are you willing to commute for a job?
               
unique(dataset$M2_Q25A) #What is the main reason you/[NAME] doesn't work full-time?

unique(dataset$M2_Q25B) #Would you/[NAME] work more hours if there were available and affordable child care services?
dataset$M2_Q25B[is.na(dataset$M2_Q25B)] <- 'no'

unique(dataset$M2_Q25C) #Would you/[NAME] work more hours if there were available and affordable care services for ill, disabled, or elderly people?
dataset$M2_Q25C[is.na(dataset$M2_Q25C)] <- 'no'

#---------------------------------------

#Module 5A: Social Assistance

unique(dataset$M5A_Q1) #Has this household any children under 20 years old?

#--------------------------------------

unique(dataset$M1_Q3) #Sex
unique(dataset$M1_Q14A) #highest level of education
unique(dataset$REGION.x.x) #Region identifier 
#--------------------------------------

#Psych Data 

#Numeracy 
sum(!is.na(dataset$IRT_Scores_Numeracy_skills))
dataset$IRT_Scores_Numeracy_skills

#Reading Comp
dataset$IRT_Scores_Reading_Compr_skills
sum(!is.na(dataset$IRT_Scores_Reading_Compr_skills))

#Semantic Skills
dataset$IRT_Scores_Semantics_skills
sum(!is.na(dataset$IRT_Scores_Semantics_skills))

#There are 1732 observations in the IRT Score variables above that are not N/A's
#These observations were the respondents who were surveyed. 
#The remaining observations will remain N/A

#--------------------------------------

#Create dataset of indp vars
indep_vars <- dataset[c("HH_ID", "HHM_ID", "M2_Q25A", "M1_Q3", "M2_Q7F", "M2_Q7E", "M2_Q25B", "M2_Q25C", "M5A_Q1", "M1_Q14A", "AGE_GROUPS", "REGION.x.x", "IRT_Scores_Numeracy_skills" , "IRT_Scores_Reading_Compr_skills", "IRT_Scores_Semantics_skills")]

#Rename columns
names(indep_vars) <- c("Household Id", "Household Member Id", "Main reason doesn't work full-time ", "Sex: ", "Willing to move within Bulgaria for a job? ", "Length willing to commute? ", "Would work more if child care? ", "Would work more if care services for disabled? ", "Household with children under 20? ", "Education: ", "Age: ", "Region", "Numeracy Score ", "Reading Score ", "Semantics Score ")
#--------------------------------------

#Based on "Main reason doesn't work full-time", create variable "outside of labor market" which takes on the value 1 if attending school or has an illness or disability.
unique(indep_vars$`Main reason doesn't work full-time`)

indep_vars$y <- ifelse(indep_vars$`Main reason doesn't work full-time`=="ATTENDING SCHOOL OR TRAINING COURSES" , 1, 0)
indep_vars$x <- ifelse(indep_vars$`Main reason doesn't work full-time`=="ILLNESS OR DISABILITY", 1, 0)

unique(indep_vars$x)
unique(indep_vars$y)

is.na(indep_vars$x) <- 0 
is.na(indep_vars$y) <- 0 

indep_vars$`Disabled, Ill, or in School` <- indep_vars$x+indep_vars$y

indep_vars$x <- NULL
indep_vars$y <- NULL

#--------------------------------------
unique(indep_vars$`Education: `)

indep_vars$`Education: `[is.na(indep_vars$`Education: `)] <- 'none'

#--------------------------------------

#Display head of data
kable(indep_vars[1:5,1:5])
```


```{r Create combined data-set, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Create combined data-set
#--------------------------------------

dim(dep_vars); dim(indep_vars)
combined_data <- cbind(dep_vars, indep_vars)

#--------------------------------------

#Drop if age is less than 18 
unique(combined_data$`Age: `)

combined_data <- subset(combined_data, `Age: `!="Less than 18")

#Drop observations where sex is equal to N/A
combined_data <- combined_data[complete.cases(combined_data$`Sex: `),]

#--------------------------------------

#Fill in missing values of region by using the region of HH_id
setDT(combined_data)[, Region := unique(Region[!is.na(Region)]), by = HH_id]; unique(combined_data$Region)

#--------------------------------------
#Weight the combined dataset. 

combined_data <-svydesign(id=~1, weights=~dep_vars$`household weights`, data=combined_data)

```

\newpage

# Relevant Summary Statistics

Income inequality between Roma and non-Roma is dramatic. Mean and median monthly net wages for Roma with positive earnings were 338 BGN and 320 BGN in 2013, respectively. The analog figures for non-Roma were a mean of 554 BGN and a median of 480 BGN -- roughly 60 percent greater than Roma. In terms of total net monthly household income, Roma households saw average total incomes of 426 BGN and median incomes of 350 BGN. Meanwhile, non-Roma saw a mean of 889 BGN and a median of 700 BGN -- double the total net income of Roma households. 

This section provides graphical and statistical information regarding economic inequality between Bulgarian Roma and non-Roma. In addition to clearly showing the extent to which Roma and non-Roma differ in terms of household and wage income, differences in levels of education, standardized cognitive test scores, and government transfer income are also presented. In short, Roma see lower household income and wage income, have lower levels of education, earn less for the same level of education relative to non-Roma, have lower test results on standardized tests, and receive higher government income transfers than non-Roma. 

For the purposes of the research question posed here, the combination of these facts suggest that there is clear economic inequality between Roma and non-Roma in Bulgaria and that these differences may in part be explained by differences in a number of clearly measurable factors. 


## Total Net Monthly Household Income

Figures 1 and 2 present the distribution of total net monthly household income by ethnic group. As is strikingly clear, total net monthly household income for Roma is clearly skewed closer to zero than for non-Roma. For Roma, the bulk of the total household income distribution is concentrated between 0 BGN per month and 500 BGN. For non-Roma, the bulk of the distribution extends to 1000 BGN per month. Additionally, Roma household incomes are more concentrated at the mean and median of the distribution, while non-Roma see a greater range of incomes. 

```{r fig.cap = "Distribution of net monthly total household income",fig.width=7, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE}

ggplot(combined_data$variables, aes(`total net monthly household income`, fill = `Roma`)) + geom_density(alpha = 0.2) + xlim(1, 2300) 

#+ labs(title = "Net monthly household income") 

#ggplot(combined_data$variables, aes(`total net monthly household income`)) + geom_density(alpha = 0.2) + xlim(1, 2300) + facet_grid(. ~ `Roma`) + labs(title = "Net monthly household income")

#ggplot(combined_data$variables, aes(`total net monthly household income`)) + geom_density(alpha = 0.2) + xlim(1, 2300) + facet_grid(. ~ `Roma`) + geom_density(aes(weight=(`household weights`/sum(`household weights`)))) + labs(title = "Net monthly household income")

#plot1 <- ggplot(subset(combined_data$variables,Roma=="Roma"), aes(`total net monthly household income`), options(scipen=10000)) + geom_density(alpha = 0.2) + xlim(1, 3500) + geom_density(aes(weight=(`household weights`/sum(`household weights`)))) + labs(title = "Roma") + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +  theme(axis.title.x=element_blank())

#plot2 <- ggplot(subset(combined_data$variables,Roma=="non-Roma"), aes(`total net monthly household income`)) + geom_density(alpha = 0.2) + xlim(1, 3500) + geom_density(aes(weight=(`household weights`/sum(`household weights`)))) + labs(title = "non-Roma")  + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +   theme(axis.title.x=element_blank())
```

```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

mean(subset(combined_data$variables$`monthly average net wages`, combined_data$variables$`monthly average net wages`>0 & combined_data$variables$Roma=="Roma"))

mean(subset(combined_data$variables$`monthly average net wages`, combined_data$variables$`monthly average net wages`>0 & combined_data$variables$Roma=="non-Roma"))

median(subset(combined_data$variables$`monthly average net wages`, combined_data$variables$`monthly average net wages`>0 & combined_data$variables$Roma=="Roma"))

median(subset(combined_data$variables$`monthly average net wages`, combined_data$variables$`monthly average net wages`>0 & combined_data$variables$Roma=="non-Roma"))


mean(subset(combined_data$variables$`total net monthly household income`, combined_data$variables$`total net monthly household income`>0 & combined_data$variables$Roma=="Roma"))

mean(subset(combined_data$variables$`total net monthly household income`, combined_data$variables$`total net monthly household income`>0 & combined_data$variables$Roma=="non-Roma"))

median(subset(combined_data$variables$`total net monthly household income`, combined_data$variables$`total net monthly household income`>0 & combined_data$variables$Roma=="Roma"))

median(subset(combined_data$variables$`total net monthly household income`, combined_data$variables$`total net monthly household income`>0 & combined_data$variables$Roma=="non-Roma"))

```


```{r fig.cap = "Distribution of net monthly total household income",fig.width=7, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE}

plot1 <- ggplot(subset(combined_data$variables,Roma=="Roma"), aes(`total net monthly household income`), options(scipen=10000)) + geom_density(alpha = 0.2) + xlim(1, 3500) + aes(weight=(`household weights`/sum(`household weights`))) + labs(title = "Roma") + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank())

plot2 <- ggplot(subset(combined_data$variables,Roma=="non-Roma"), aes(`total net monthly household income`)) + geom_density(alpha = 0.2) + xlim(1, 3500) + aes(weight=(`household weights`/sum(`household weights`))) + labs(title = "non-Roma")  + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  nrow = 1,
  bottom = textGrob(
    "2013 Bulgarian Leva. Weighted sample. Observations restricted to those with positive incomes. Net household monthly income includes all income.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)


#Weighted normal plot - Roma
#plot(density((subset(combined_data$variables, Roma=="Roma"))$`total net monthly household income`, weights=(subset(combined_data$variables, Roma=="Roma"))$`household weights`/sum((subset(combined_data$variables, Roma=="Roma"))$`household weights`), na.rm=T),type='l',bty='n', xlim=c(1, 1000))

#Weighted normal plot - nonRoma
#plot(density((subset(combined_data$variables, Roma=="non-Roma"))$`total net monthly household income`, weights=(subset(combined_data$variables, Roma=="non-Roma"))$`household weights`/sum((subset(combined_data$variables, Roma=="non-Roma"))$`household weights`), na.rm=T),type='l',bty='n', xlim=c(1, 1000))
```

Table 1 displays the striking distribution of total monthly household income by Roma and non-Roma. This household income variable includes income from employment, remittances, government benefits, and all other sources. Yet it continues to be substantially less for Roma than for non-Roma across the distribution. Each quartile sees between a 200 BGN and nearly 7000 BGN spread. The full spread of the Roma household income distribution would fall below the first income quartile of the non-Roma distribution. 

```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

### Total net monthly weighted household income quartiles by ethnic group

## Roma
roma_quantiles <- wtd.quantile(subset(combined_data$variables$`total net monthly household income`, combined_data$variables$ethnic==1), weights=subset(combined_data$allprob, combined_data$variables$ethnic==1), probs=c(0, .25, .5, .75, 1),normwt=FALSE, na.rm=TRUE)

## Non-Roma
non_roma_quantiles <- wtd.quantile(subset(combined_data$variables$`total net monthly household income`, combined_data$variables$ethnic==0), weights=subset(combined_data$allprob, combined_data$variables$ethnic==0), probs=c(0, .25, .5, .75, 1), normwt=FALSE, na.rm=TRUE)

#Table
df<-cbind(round(roma_quantiles),round(non_roma_quantiles))
colnames(df) <- c("Roma", "non-Roma")

stargazer(df, type = 'latex', title="Total net monthly household income quartiles", header=FALSE)
```

## Wage Income and Total Household Income 

As seen in Figure 3, the relationship exhibited in Table 1 maintains for wage income in addition to total household income. The spread of incomes and the concentration of income is substantially lower for Roma than for non-Roma. Like distribution of household income, the distribution of wage income is also markedly lower and much more concentrated at the center of distribution than for non-Roma. 

```{r fig.cap = "Monthly total household income and individual wage income",fig.width=7, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE}

### Boxplot of wages and net income by ethnicity for incomes greater than 0.

box1 <- ggplot(combined_data$variables, aes(x =`Roma`, y=`total net monthly household income`)) + geom_boxplot() + ylim(1, 4500) + aes(weight=(`household weights`/sum(`household weights`))) +  theme(axis.title.x=element_blank()) + labs(title = "Total household income") 

box2 <- ggplot(combined_data$variables, aes(x =`Roma`, y=`monthly average net wages`)) + geom_boxplot() + ylim(1, 4500) + aes(weight=(`household weights`/sum(`household weights`))) +  theme(axis.title.x=element_blank()) + labs(title = "Wage income") 

grid.arrange(
  box1,
  box2,
  nrow = 1,
  bottom = textGrob(
    "2013 Bulgarian Leva. Weighted sample. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)
```

```{r fig.cap = "Distribution of monthly average net wages",fig.width=7, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE}

plot1 <- ggplot(subset(combined_data$variables,Roma=="Roma"), aes(`monthly average net wages`), options(scipen=10000)) + geom_density(alpha = 0.2) + xlim(1, 2500) + aes(weight=(`household weights`/sum(`household weights`))) + labs(title = "Roma") + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank())

plot2 <- ggplot(subset(combined_data$variables,Roma=="non-Roma"), aes(`monthly average net wages`)) + geom_density(alpha = 0.2) + xlim(1, 2500) + aes(weight=(`household weights`/sum(`household weights`))) + labs(title = "non-Roma")  + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +   theme(axis.title.x=element_blank(), axis.title.y=element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  nrow = 1,
  bottom = textGrob(
    "2013 Bulgarian Leva. Weighted sample.",
    gp = gpar(fontface = 3, fontsize = 7), 
    hjust = 1,
    x = 1
  )
)
```
 

## Education and Wages

Levels of education are lower amongst Roma. Additionally, education is strongly associated with higher earnings for both Roma and non-Roma. However, it is also clear that the returns from the same level of education is lower amongst Roma. In the Blinder-Oaxaca decompositions conducted below, both the impact of differences in education level and difference in returns to education by ethnic status are estimated. 

```{r fig.cap = "Monthly average net wages by education level",fig.width=7, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE}

#Monthly wages by highest level of education for those reporting wages greater than 0
plot1 <- ggplot(subset(combined_data$variables, Roma=="Roma"), aes(x =`Education: `, y=`monthly average net wages`)) + labs(title = "Roma")+geom_boxplot() + ylim(1, 2300) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot(aes(weight=(`household weights`/sum(`household weights`)))) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot2 <- ggplot(subset(combined_data$variables, Roma=="non-Roma"), aes(x =`Education: `, y=`monthly average net wages`)) + labs(title = "non-Roma") + geom_boxplot() + ylim(1, 2300) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot(aes(weight=(`household weights`/sum(`household weights`)))) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  nrow = 1,
  bottom = textGrob(
    "2013 Bulgarian Leva. Weighted sample. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)
```



```{r fig.cap = "Distribution of monthly average net wages by education level", fig.width=7, fig.height=6, message=FALSE, warning=FALSE, echo = FALSE}

## Distribution of monthly average net wages by ethnicity and education for incomes greater than 0.

plot1 <- ggplot(subset(combined_data$variables,Roma=="Roma"), aes(`monthly average net wages`, fill = `Education: `), options(scipen=10000)) + geom_density(alpha = 0.2) + xlim(1, 1300)+ aes(weight=(`household weights`/sum(`household weights`)))+ labs(title = "Roma") + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +  theme(axis.title.x=element_blank()) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot2 <- ggplot(subset(combined_data$variables,Roma=="non-Roma"), aes(`monthly average net wages`, fill = `Education: `), options(scipen=10000)) + geom_density(alpha = 0.2) + xlim(1, 1300) + aes(weight=(`household weights`/sum(`household weights`))) + labs(title = "non-Roma") + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +  theme(axis.title.x=element_blank()) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  nrow = 2,
  bottom = textGrob(
    "2013 Bulgarian Leva. Weighted sample. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)

```

## Government Benefit Income

As is widely remarked upon in Bulgaria, Roma see higher net monthly government transfer income than non-Roma. Given the relatively low household and wage incomes among Roma, it is certainly not surprising that government benefit income is higher amongst Roma. However, government benefits remain paltry. Government benefit income for Roma who receive these benefits is concentrated around 150 BGN and 200 BGN (i.e. a mere 75 and 100 euros). 

```{r fig.cap = "Distribution of net monthly government transfer income, excluding pensions", fig.width=7, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE}

### Distribution of monthly income from household government benefits, excluding pensions, by Roma and non-Roma


plot1 <- ggplot(subset(combined_data$variables,Roma=="Roma"), aes(`household government benefits, excluding pensions`), options(scipen=10000)) + geom_density(alpha = 0.2) + xlim(1, 1500) + aes(weight=(`household weights`/sum(`household weights`))) + labs(title = "Roma") + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +  theme(axis.title.x=element_blank()) + theme(axis.title.x=element_blank()) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot2 <- ggplot(subset(combined_data$variables,Roma=="non-Roma"), aes(`household government benefits, excluding pensions` )) + geom_density(alpha = 0.2) + xlim(1, 1500) + aes(weight=(`household weights`/sum(`household weights`)))  + labs(title = "non-Roma")  + geom_density(alpha = 0.4, color = "black", fill = "#00AFBB") +   theme(axis.title.x=element_blank()) + theme(axis.title.x=element_blank()) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  nrow = 1,
  bottom = textGrob(
    "2013 Bulgarian Leva. Weighted sample. Observations restricted to those with positive government transfer incomes.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)
```

```{r fig.cap = "Monthly income from household government benefits, excluding pensions", fig.width=7, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE}

ggplot(subset(combined_data$variables), aes(x =Roma, y = `household government benefits, excluding pensions`)) + labs(caption = "2013 Bulgarian Leva. Weighted sample. Observations restricted to those with positive government transfer income.") + geom_boxplot() + ylim(1, 1500) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + aes(weight=(`household weights`/sum(`household weights`))) +   theme(axis.title.x=element_blank())


```



## Cognitive Test Scores

In addition to questions regarding demographics, education history, and income, the BLISS 2013 survey asked 1732 adult respondents, aged 18--65, to undertake cognitive and interpersonal skills tests. In their analysis of the BLISS survey, @levin_skills_2016 did not find consistent, significant marginal effects of interpersonal skills and personality traits on labor market outcomes. However, cognitive skills closely follow labor market outcomes and educational outcomes. In contrast to the cognitive skills test which measure literacy and numeracy, the interpersonal skills tests allow for quite a large degree of subjectivity on the part of the respondent and the proctor. In consequence, the measures of cognitive skills used by the BLISS were far less likely to be biased because they lacked subjective categories. 

These tests scores may be particularly useful if there are systematic differences in the quality of education between Roma and non-Roma. If it were the case that standards of passing or subject matter taught varied between Roma majority and non-Roma majority schools -- and thus that a given degree could mean something different depending on a student’s ethnicity -- these standardized cognitive test scores could stand in as a more objective measure of educational attainment than degree-level alone.

For this paper, two tests will be considered: numeracy and reading. The distribution of non-Roma scores is higher than that of Roma. For each of these tests, both the mean and median scores of Roma are significantly lower than those of non-Roma. Additionally, when looking within education level, these differences generally hold across ethnic groups. Boxplots of the numeracy scores are presented here by both ethnic status and educational attainment. Generally, non-Roma see higher numeracy scores than Roma within each grouping of educational attainment. 

```{r message=FALSE, warning=FALSE, echo = FALSE, results='hide'}
tapply(combined_data$variables$`Numeracy Score `, combined_data$variables$Roma, summary, weights= combined_data$variables$`household weights`)
tapply(combined_data$variables$`Semantics Score `, combined_data$variables$Roma, summary, weights= combined_data$variables$`household weights`)
tapply(combined_data$variables$`Reading Score `, combined_data$variables$Roma, summary, weights= combined_data$variables$`household weights`)
```

```{r fig.width=7, fig.height=4, fig.cap = "Numeracy Score by Ethnicity and Education", message=FALSE, warning=FALSE, echo=FALSE}
#Monthly wages by highest level of education for those reporting wages greater than 0
plot1 <- ggplot(subset(combined_data$variables, Roma=="Roma"), aes(x =`Education: `, y=`Numeracy Score `)) + labs(title = "Roma")+geom_boxplot() + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot(aes(weight=(`household weights`/sum(`household weights`)))) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot2 <- ggplot(subset(combined_data$variables, Roma=="non-Roma"), aes(x =`Education: `, y=`Numeracy Score `)) + labs(title = "non-Roma") + geom_boxplot() + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot(aes(weight=(`household weights`/sum(`household weights`)))) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  nrow = 1,
  bottom = textGrob(
    "Numeracy score ranges between -4 and +3, with the higher the score translating to greater numeracy. Weighted sample.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)
```






























\newpage

# Ordinary Least Squares 

In this section, a set of log-linear models are estimated. For each model, the dependent variable is either "monthly average net wages" or "total net monthly household income." The set of independent variables are the set of labor market relevant factors (e.g. level of education, sex, and region). Additionally, each model is run with and without including a Roma indicator so as to show the estimated effect of being Roma on household income and wage income. 

## Functional form of the estimated models

Below is the functional form of the log-linear models estimated in this section. 

$$
ln(income_i)= \beta_0 + \beta_1 Roma_i + \gamma X_i^T
$$ 


## Estimated Log-Linear Models 

Presented below are four models. Two models use monthly average net wages as the dependent variable, while the other two use total net monthly household income. For both models, the population is restricted to those with positive incomes. This means that for the first two models, the estimated coefficients apply to those who were typically employed in some capacity. In all four models, the dependent variable is log transformed; this step was taken in response to the standard skew that these two income distributions take. For the first and third models, a Roma indicator is not included. For the second and fourth models, an indicator is included. Lastly, all of these models have the appropriate sample `household weights` applied to them. 

```{r message=FALSE, warning=FALSE, echo = FALSE}
dstrat<-svydesign(id=~1, weights=~`household weights`, data=combined_data$variables)

model1 <- svyglm(log(`monthly average net wages`) ~ `Sex: ` + `Household with children under 20? ` + `Education: `+ `Age: ` + `Region` + `Numeracy Score ` + `Semantics Score ` + `Reading Score `, design=dstrat, `monthly average net wages`>0)

model2 <- svyglm(log(`monthly average net wages`) ~ `Roma` + `Sex: ` + `Household with children under 20? ` + `Education: `+ `Age: ` + `Region` + `Numeracy Score ` + `Semantics Score ` + `Reading Score `, design=dstrat, `monthly average net wages`>0)

model3 <- svyglm(log(`total net monthly household income`) ~ `Sex: ` + `Household with children under 20? ` + `Education: `+ `Age: ` + `Region` + `Numeracy Score ` + `Semantics Score ` + `Reading Score `, design=dstrat, `total net monthly household income`>0)

model4 <- svyglm(log(`total net monthly household income`) ~ `Roma` + `Sex: ` + `Household with children under 20? ` + `Education: `+ `Age: ` + `Region` + `Numeracy Score ` + `Semantics Score ` + `Reading Score `, design=dstrat, `total net monthly household income`>0)
```

The regression output displayed in Table 2 shows that despite controlling for a plethora of factors that may be driving ethnic inequality between Roma and ethnic Bulgarians, these factors clearly do not explain away Roma-specific factors. The inclusion of a Roma indicator is both negative in these two models and also highly statistically significant. 

In Model 2, there is estimated to be 40.54 percent declines in average net monthly wages if Roma ($(e^{-0.52}-1)\times 100$). In Model 4, the analogous marginal effect is a 35.59 percent decline in total net monthly household income ($(e^{-0.44}-1)\times 100$).

While these estimates do not conclusively explain whether this effect is from discrimination or other systematic differences above and beyond "objective" labor market factors, this strong effect clearly provides justifiable cause to further investigate the contribution of factors beyond objective labor market relevant characteristics.


```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

stargazer(model1, model2, model3, model4, title = "Log-Linear Regression Output", align=TRUE, type = 'latex', no.space=TRUE, float.env = "sidewaystable", header=FALSE)
```

```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

#texreg(list(model1, model2, model3, model4), dcolumn = TRUE, booktabs = TRUE, use.packages = FALSE, label = "tab:3", custom.coef.names = c("Intercept", "Roma", "Female", "Household with children under 20", "No Education", "Primary Education","Secondary Education","Professional Education","Bachelors", "Master's", "Ph.D.", "Age: 30-49", "Age: 50+", "Region" ), caption = "Two linear models.", float.pos = "hb!")
```






## Gauss-Markov Conditions

This subsection examines whether the ordinary least square (OLS) models estimated meet the following two Gauss-Markov conditions: 1) homoskedastic standard errors and 2) a standard normal distribution of errors. In short, the models estimated nearly conform to these Gauss-Markov conditions; their residuals have a near normal distribution, they are centered at zero, and the bulk of residuals are randomly distributed with constant variances. However, despite these OLS models being estimated with robust standard errors, the distribution of errors for all the models are skewed at the extremes. As is typically the case, the distributions of both wage income and total household income in this sample is right-skewed. Despite the log-transformations of these income variables, this skew remains and has consequence for the distribution of errors. In summary, there is evidence of heteroskedasticity in all four models, particularly the first two models. 

If either of these two Gauss-Markov conditions are not met, the estimated standard errors may be upwardly biased, meaning OLS is not the best linear unbiased estimator. However, it should be stressed that if either of these two conditions are violated, there is no implication that the coefficients estimated and presented in the previous section are biased. Greater variance at the extrema merely has the consequence of pushing up standard errors. Therefore, if this heteroskedasticity were able to be properly controlled for, the estimated standard errors would likely be smaller. Additionally, the models estimated were estimated with robust standard errors, which decreases the prevalence or likelihood of a non-constant distribution of errors but also increases standard errors. In turn, the models estimated here likely have upwardly biased standard errors. 

## Standard Normal Distribution of Errors

As seen in Figure 10, for every model estimated the residuals are distributed around zero and their distribution is approximately normal. While the distribution of residuals for all four models have a slight skew, the skew of Models 3 and 4 -- those that estimate total net household income -- is clearly smaller than in Models 1 and 2. This suggests that Models 3 and 4 may exhibit less heteroskedasticity than Models 1 and 2. 

```{r fig.cap = "Distribution of residuals of estimated OLS models", message=FALSE, warning=FALSE, echo = FALSE}
par(mfrow = c(2, 2))  # 2 rows and 2 columns
hist(model1$residuals, main = "Model (1)", xlab = "" )
hist(model2$residuals, main = "Model (2)", xlab = "" )
hist(model3$residuals, main = "Model (3)", xlab = "" )
hist(model4$residuals, main = "Model (4)", xlab = "" )
```

## Homoskedasticity

To further investigate whether these models present evidence of conforming to the standard normal distribution of errors and the homoskedasticity condition, Figure 11 is presented. For each model, two graphs are displayed. On the right is a quantile-quantile plot (Normal Q-Q). On the left, the distributions of estimated residuals are plotted against the fitted values that these models estimate. 

To continue the discussion of the distribution of residuals, consider the plot on the left first. Plotting the residuals of a model against its fitted values shows how homogeneous or heterogenous the variance of a model is. If the pattern is one of randomness, then the errors do not have a relationship with the predicted values (i.e. the errors are homogeneously distributed). The same relationship established by the histogram of residuals is seen here: Models 1 and 2 see heavy clustering for the vast majority of observations, but a there is a sizeable group of outliers that may be evidence of heteroskedasticity. Models 3 and 4 are more evenly distributed and present less evidence of heteroskedasticity.

The Normal Q-Q plots on the right of Figure 11 serve as visual aids in determining whether the residuals of the OLS models are normally distributed. If the theoretical distribution of the residuals (i.e. that the residuals are normally distributed) is met by the estimated model, the plotted residuals would lie along the 45-degree line with 95 percent of the residuals within two standard deviations from the mean of zero. 

The residuals of the four estimated models, unfortunately, suffer from issues of having heavy tails. The plotted residuals conform accurately to a normal distribution for the bulk of the distribution (90 to 95 percent), particularly away from the extremities. However, at the ends of the distributions, the residuals deviate from the theoretical distribution in that they deviate from the 45-degree line. This is evidence that the data contains extreme values -- not a surprising fact, given that the distribution of income and wages typically follows a skewed distribution. Recall, this was an essential consideration in the decision to take the log-transformation of income variables (i.e. the independent variables). 

Depending on the severity and prevalence of this deviation from the theoretical distribution, these extreme values may be evidence that the models’ error terms are heteroskedastic. Despite non-constant variance only being present at the ends of the distribution, the standard errors may still be biased. 

To further determine the magnitude by which standard errors deviate from their theoretical distribution and whether the models estimated should be considered to have heteroskedastic standard errors, studentized Breusch-Pagan tests are run for each OLS model. As is standard for such tests, if the p-value estimated is less than 0.05, the null hypothesis that the variance is constant is rejected in favor of the alternative hypothesis (i.e. that the variance is heteroskedastic). By applying this test statistic, the Breusch-Pagan tests suggest that Models 1 and 2, which estimate monthly net wages, have heteroskedastic standard errors, but that Models 3 and 4 do not. The p-values for these studentized Breusch-Pagan tests are the following: Model 1 (p-value = 0.0002), Model 2 (p-value = 0.00001), Model 3 (p-value = 0.6376), and Model 4 (p-value = 0.59). 

Given the similarity of the two dependent variables, Models 3 and 4 -- the models that are unlikely to contain heteroskedastic standard errors -- can be treated as something of the standard bearer in terms of estimated standard errors. Several more independent variables are estimated to be statistically significant for Models 3 and 4: “Household with children under 20,” “Secondary education,” “Master’s,” and “Ph.D.” This can be taken as additional evidence that the standard errors of Models 1 and 2 are upwardly biased. 

```{r fig.cap = "OLS models: Evidence for standard normal and homoskedastic errors", message=FALSE, warning=FALSE, echo = FALSE}
par(mfrow = c(4,2), pty = "m")
plot(model1, which = 1:2, main="Model 1")
plot(model2, which = 1:2, main="Model 2")
plot(model3, which = 1:2, main="Model 3")
plot(model4, which = 1:2, main="Model 4")
```

```{r warning=FALSE, message=FALSE, echo=FALSE, results="hide"}

lmtest::bptest(model1)
lmtest::bptest(model2)
lmtest::bptest(model3)
lmtest::bptest(model4)

```



\newpage 
# Blinder-Oaxaca Decomposition

Through a Blinder-Oaxaca decomposition, the relative impact of education, region, family size, and other characteristics on income disparities between Roma and non-Roma can be ascertained. Corollary, a Blinder-Oaxaca decomposition can provide strong evidence for the extent to which economic inequality between Roma and non-Roma is due to structural and employment discrimination. 

In the immediate subsections below, the explicit form of the Blinder-Oaxaca decomposition is presented. For sake of simplicity, the explicit form is presented for only one of the two dependent variables: mean net monthly wage income. However, the methodological framework is identical for total net household income, the other dependent variable. As with the OLS models estimated in the previous section, both dependent variables are log-transformed. 

Following a discussion of the Blinder-Oaxaca decomposition’s methodological framework, the estimated results are presented. For both dependent variables, three tables walk the reader through the extent to which household income and wage inequality between Roma and non-Roma can be explained by relevant and observed labor market characteristics. 

Subsequently, the distribution of the Blinder-Oaxaca models' residuals and evidence for heteroskedasticity is discussed. As was found when conducting the same procedure for the log-linear models estimated in the previous section, the Blinder-Oaxaca model estimating wage income was found to exhibit strong evidence of heteroskedasticity. In contrast, the Blinder-Oaxaca model for household income does not exhibit evidence of heteroskedasticity. Consequently, this latter model can be treated as something of the standard-bearer. In contrast, the former model likely contains upwardly biased standard errors. 

This section concludes with a discussion informed by two plots that graphically display the decomposition by independent variable of the income and wage gap between Roma and non-Roma. These plots show the extent to which income variation is explained by education, for instance, by decomposing differences in the level at which Roma and non-Roma are formally educated and differences in the returns to education. These plots provide striking evidence that factors specific to the Roma ethnic status, namely employment and structural discrimination, drive the vast majority of income inequality in Bulgaria.

## Explicit Form of the Blinder-Oaxaca Decomposition

The Blinder-Oaxaca decomposition for log-wages estimates log-linear equations of the form estimated in the previous section for Roma and non-Roma. 

$$
{\displaystyle {\begin{aligned}(1)\qquad \ln({\text{wages}}_{Roma_{i}})&=x_{Roma_{i}}^T \gamma+\epsilon_{Roma_{i}} \\(2)\qquad \ln({\text{wages}}_{non-Roma_{i}})&=x_{non-Roma_{i}}^T \gamma+\epsilon_{non-Roma_{i}}\end{aligned}}}
$$

## Difference in Mean Log-Wages between Non-Roma and Roma

Fitted values from the two log-linear models are subtracted from one another in the following form. 

$$
{\displaystyle {\begin{aligned}(3)\qquad &\operatorname {mean} (\ln({\text{wages}}_{non-Roma}))-\operatorname {mean} (\ln({\text{wages}}_{Roma}))\\[4pt]={}&b_{non-Roma}\operatorname {mean} (X_{non-Roma})-b_{Roma}\operatorname {mean} (X_{Roma}) \end{aligned}}}
$$

## Decomposing Explained and Unexplained Differences

The differences between Roma and non-Roma in terms of wage income are decomposed into a) between-group differences explained by observables and b) differences not explained by observables. 

$$
{\displaystyle {\begin{aligned}
[4pt]={}&b_{non-Roma}(\operatorname {mean} (X_{non-Roma})-\operatorname {mean} (X_{Roma}))+\operatorname {mean} (X_{Roma})(b_{non-Roma}-b_{Roma})
\end{aligned}}}
$$

a) Between-group differences: These are differences in observable and relevant characteristics, like one's level of education, age, and the region in which they live.

$$
b_{non-Roma}(\operatorname {mean} (X_{non-Roma})-\operatorname {mean} (X_{Roma}))
$$

b) Differences not explained by observables: The differences in outcomes that cannot be accounted for by observables are estimated here. Typically in the literature, this portion of the Blinder-Oaxaca decomposition is considered to estimate the role of discrimination.

$$
\operatorname {mean} (X_{Roma})(b_{non-Roma}-b_{Roma})
$$

## Estimated Blinder-Oaxaca Decomposition: Monthly Average Net Wages 

The Blinder-Oaxaca Decomposition is implemented in R using the package `oaxaca`. Two Blinder-Oaxaca Decomposition models are estimated, one for the dependent variable `monthly average net wages` and the other for `total net monthly household income`. As was discussed, the dependent variables here are log-transformed as they were in the linear regression models estimated previously. Tables 5, 6, 7, and 8 should be read as percent changes; for these tables, the coefficients, results, and standard errors have been conveniently multiplied as follows: $100\times(e^{\beta_j}-1)$.  

```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

#Transform the name of c to net.wages so Oaxca can deal with the variable
combined_data$variables$net.wages<-combined_data$variables$`monthly average net wages`

#Transform the name of `total net monthly household income` to net.hh.income so Oaxca can deal with the variable
combined_data$variables$net.hh.income <-combined_data$variables$`total net monthly household income`

#Transform highest level of education into numeric factor so Oaxaca can deal with it effectively
combined_data$variables$`Education: ` <- as.numeric(factor(combined_data$variables$`Education: `, levels = unique(combined_data$variables$`Education: `)))

#net.wages 
blinder_oaxaca_net.wages <- oaxaca( log(net.wages) ~ `Sex: ` + Region + `Household with children under 20? ` + `Age: ` + `Education: ` + `Reading Score ` + `Numeracy Score ` | ethnic , data = subset(combined_data$variables, `monthly average net wages` > 0), group.weights = subset(combined_data$prob, combined_data$variables$`monthly average net wages` > 0))

#net.hh.income 
blinder_oaxaca_net.hh.income <- oaxaca( log(net.hh.income) ~ `Sex: ` + Region + `Household with children under 20? ` + `Age: ` + `Education: ` + `Reading Score ` + `Numeracy Score ` | ethnic , data = subset(combined_data$variables, net.hh.income > 0), group.weights = subset(combined_data$prob, combined_data$variables$net.hh.income > 0))
```

The sub-sections below present the estimated results from the Blinder-Oaxaca decomposition for Roma and non-Roma workers' net monthly wages and net total household incomes. As was addressed, the wage and household income gap between Roma and non-Roma may be due to group differences in the level of wage and income determinants such as age, family characteristics, or level of education. Alternatively, the gap could arise from a differential effect of these determinants on Roma and non-Roma wages. 

The former causal route would be due to what is referred to as endowments or the effect of observables -- i.e. the portion of the gap between Roma and non-Roma that is explained by the observables. The second causal route would be due to differences in coefficients; this is the portion that is unexplained by the model and, therefore, is the result of Roma-specific characteristics. Typically, this portion of the gap is what could be considered as the result of either structural or employment discrimination.

## Threefold Decomposition: Monthly Average Net Wages

As was outlined in the beginning of this section, the Blinder-Oaxaca Decomposition is built from a linear regression framework for which a log-linear model is estimated. Table 4 presents the regression output of this log-linear model. As expected, it is quite similar to the log-linear models estimated in the previous section. 
 

```{r message=FALSE, warning=FALSE, echo = FALSE, results="asis"}

stargazer(summary(blinder_oaxaca_net.wages$reg$reg.pooled.2)$coefficients, title = "Blinder-Oaxaca Log-Linear Regression Output: Wage Income", align=TRUE, type = 'latex', no.space=TRUE, float.env = "sidewaystable", header=FALSE)
```

The mean wages of non-Roma and Roma included in the Blinder-Oaxaca estimates are 472 BGN and 247 BGN, respectively. The wages of non-Roma are 1.9 times larger than Roma. The coefficients presented in the threefold Blinder-Oaxaca Decomposition, which are displayed in Table 5, explain this nearly two-fold mean difference in wages. 

The first term on the right in Table 5, `coef (endowments)`, refers to the proportion of this variation explained by differences in the observables. Given that the dependent variable has been log-transformed, the estimates provided in Table 5 imply that roughly 12 percent of the difference between the mean net wages of Roma and non-Roma can be explained by observables, such as education, differences in family structure, and regional differences in where Roma and non-Roma live. 

Considering the term `coef (coefficients)`, on the other hand, it is clear that a much larger proportion, 82.43 percent (96.88-14.45), of the gap between the mean wages of the two ethnic groups cannot be explained by differences in endowments (i.e. observables). Rather, the independent variables estimated have different effects for the different ethnic groups. For example, education sees higher returns for non-Roma than for Roma. After taking into account the interaction effects of the independent variables and ethnic status, this term suggests that Roma fixed characteristics may play a sizable role in inequality between Roma and non-Roma. 

Given the plethora of evidence presented in the introductory section of widespread discrimination towards Roma in contemporary Bulgaria, there is clearly reason to suspect that this unexplained portion of the gap could be the consequence of discrimination. However, the decomposition presented here cannot be considered as conclusive evidence that this 82.43 percent of the gap is the result of discrimination. Understanding the extent of discrimination's impact requires future research. For now, the evidence presented here can be strongly indicative that discrimination is the dominant factor in wage inequality between Roma and non-Roma. 


```{r message=FALSE, warning=FALSE, echo = FALSE, results="asis"}

stargazer((exp(blinder_oaxaca_net.wages$threefold$overall)-1)*100, title = "Threefold Blinder-Oaxaca Decomposition: Wage Income", align=TRUE, type = 'latex', float.env = "sidewaystable", no.space=TRUE, header=FALSE)
```

The subsequent table, Table 6, examines the explained (endowments) and unexplained (coefficients) components of the threefold decomposition by independent variable. Like the results displayed in the previous table, this table presents the coefficients as the percentage change given a marginal change in the independent variable (i.e $100\times(e^{\beta_j}-1)$). 

```{r message=FALSE, warning=FALSE, echo = FALSE, results="asis"}

stargazer((exp(blinder_oaxaca_net.wages$threefold$variables)-1)*100, title = "Threefold Blinder-Oaxaca Decomposition of Independent Variables: Wage Income", align=TRUE, type = 'latex', float.env = "sidewaystable", no.space=TRUE, font.size = "tiny", header=FALSE)

```

## Estimated Blinder-Oaxaca Decomposition: Total Net Monthly Household Income

In this subsection, the analysis conducted in the previous subsections is applied to total net monthly household income. 

As was the case for the previous regression output, only few independent variables have a statistically significant effect. Ethnic status is amongst those variables that is statistically significant (*see* Table 6). The magnitude of the coefficient on ethnic status is also substantially larger than that of any other independent variable.  

```{r message=FALSE, warning=FALSE, echo = FALSE, results="asis"}
stargazer(summary(blinder_oaxaca_net.hh.income$reg$reg.pooled.2)$coefficients, title = "Blinder-Oaxaca Log-Linear Regression Output: Household Income", align=TRUE, type = 'latex', no.space=TRUE, float.env = "sidewaystable", header=FALSE)
```


## Threefold Decomposition: Total Net Monthly Household Income

Non-Roma and Roma included in the Blinder-Oaxaca estimates see average household incomes of 702 BGN and 291 BGN, respectively. The mean household income of non-Roma is 2.4 times larger than Roma. Table 7 decomposes this gap in terms of endowments and coefficients -- the explained and unexplained portions, respectively. In contrast to the gap between Roma and non-Roma in terms of mean net wages, household income can entirely be explained by Roma fixed characteristics. Almost none of the gap between Roma and non-Roma can be explained by endowments (e.g. education, family composition, etc.). 

```{r message=FALSE, warning=FALSE, echo = FALSE, results="asis"}
stargazer((exp(blinder_oaxaca_net.hh.income$threefold$overall)-1)*100, title = "Threefold Blinder-Oaxaca Decomposition: Household Income", align=TRUE, type = 'latex', float.env = "sidewaystable", no.space=TRUE, header=FALSE)
```

The first column of Table 8, which decomposes the gap into endowment (explained) and coefficient (unexplained) effects by independent variable, shows that there are no independent variables with statistically significant endowment effects. Interestingly, this also holds for the coefficient effects of each independent variable, with the exception of the intercept. This can be interpreted as follows: the gap between Roma and non-Roma cannot be explained by differences in the return to any of the independent variables listed. Rather, the entirety of the gap between the ethnic groups is the result of forces specific to Roma and independent of any of these independent variables. In short, this is strong evidence that forces like discrimination are the most important and, potentially, the only instrumental factors driving the economic gap between Roma and non-Roma. 

```{r message=FALSE, warning=FALSE, echo = FALSE, results="asis"}
stargazer((exp(blinder_oaxaca_net.hh.income$threefold$variables)-1)*100, title = "Threefold Blinder-Oaxaca Decomposition of Independent Variables: Household Income", align=TRUE, type = 'latex', float.env = "sidewaystable", no.space=TRUE, font.size = "tiny", header=FALSE)
```

## Homoskedasticity and Standard Normal Distribution of Errors

This subsection examines whether both of the Blinder-Oaxaca models estimated above meet the homoskedasticity condition and the standard normal distribution of errors condition. As was seen in the analog section for the log-linear models, the models estimated here nearly conform to these Gauss-Markov conditions. However, the decomposition of mean wages exhibits clear evidence of heteroskedasticity. 

Figure 12 displays a plot of the residuals vs fitted values and a normal Q-Q plot. The bulk of the residuals for both models are clearly randomly clustered around zero, suggesting that they are centered at zero as their theoretical distribution would imply. However, despite being estimated with robust standard errors, the distribution of errors for the two models are once again skewed at the extremes. As is typically the case, the distributions of both wage income and total household income in this sample are right-skewed. Despite the log-transformations of these income variables, this skew remains and has consequence for the distribution of errors.  

While the Blinder-Oaxaca model that estimates household income passes the Breusch-Pagan test, the Blinder-Oaxaca model for wage income does not pass the Breusch-Pagan test. In combination with the graphical evidence provided in Figure 12, it is clear that the Blinder-Oaxaca model for wage income suffers from heteroskedasticity. This has the likely consequence of upwardly biasing this model's standard errors. In contrast, the evidence presented here confirms that the Blinder-Oaxaca model that estimates household income has homoskedastic standard errors.  

```{r Breusch-Pagan test Oaxaca Net Wages, warning=FALSE, message=FALSE, echo=FALSE, results="hide"}
lmtest::bptest(blinder_oaxaca_net.wages$reg$reg.pooled.2)
```

```{r fig.cap = "Blinder-Oaxaca: Evidence of standard normal and homoskedastic errors", message=FALSE, warning=FALSE, echo = FALSE}
par(mfrow = c(2,2), pty = "s")
plot(blinder_oaxaca_net.hh.income$reg$reg.pooled.2,  main = "Household Income", which = 1:2)
plot(blinder_oaxaca_net.wages$reg$reg.pooled.2, main = "Wage Income", which = 1:2)
```

```{r warning=FALSE, message=FALSE, echo=FALSE, results="hide"}
#Breusch-Pagan test
lmtest::bptest(blinder_oaxaca_net.hh.income$reg$reg.pooled.2)
```

## Discussion: Explained vs. Unexplained 

The gap in earnings explained by observables versus that which is unexplained is outlined in the figures below. As is strikingly clear, the explained portion of the difference between Roma and non-Roma is paltry. Of all the variables present, cognitive test scores and education explains the largest portion of the gap for both household income and wage income. However, the explanatory magnitude of these variables pales in comparison to the unexplained portion. The size of the gap between Roma and non-Roma is striking evidence that unobservable factors are driving inequality between the ethnic groups. 

However, the size of the standard errors should be taken as a strong cautionary note. With the exception of the intercept in the household income decomposition, the confidence intervals in Figures 13 and 14 contain zero for every independent variable in both models. This implies that the estimates presented here do not sufficiently capture variation to conclusively explain the relative impact of any one independent variable. However, these plots do strongly suggest that some third set of factors is likely of more importance than any of the independent variables estimated.

In the literature, differences in outcomes that cannot be accounted for by observables are generally considered to estimate the role of discrimination. While that may be so, this can also account for Roma-specific characteristics that are relevant to labor market outcomes but that are not due to discrimination. Right-wing commentators would typically assign this differential to cultural forces or as evidence of the negative stereotypes discussed in the introductory section. Identifying this dimension of a Blinder-Oaxaca Decomposition is inevitably contentious, as results could be unreasonably misconstrued to argue Roma cultural inferiority or other discriminatory, specious, and ahistorical claims. Such risk of specious misconstrual only raises the urgency of further probing the extent to which ethnically-based discrimination contributes to economic inequality in Bulgaria.

# Conclusion 

Despite the limitations of the estimates presented here, this paper makes a strong case that characteristics and forces specific to ethnic status are driving economic inequality between Roma and non-Roma in contemporary Bulgaria. In short, this paper provides evidence that discrimination -- outside of differences in education, regional segregation, or family composition -- may be instrumental in driving ethnic inequality in Bulgaria. In the log-linear models estimated in Section 3, it was shown that being Roma has a statistically significant, negative effect on earnings and household income when controlling for factors like education, sex, and age. Likewise, the Blinder-Oaxaca Decomposition estimated in Section 4 presented strong evidence that education, differences in numeracy and literacy, and other relevant labor market characteristics do not have a statistically significant nor a sizeable role in explaining income inequality between Roma and non-Roma in Bulgaria. Rather, the analysis presented here provides strong evidence that forces like structural discrimination and employment discrimination are central to driving ethnic inequality in Bulgaria. 

```{r fig.cap = "Wage decomposition: Explained and unexplained components", warning=FALSE, message=FALSE, echo=FALSE}
plot(blinder_oaxaca_net.wages, decomposition = "twofold", group.weight = -1)
```

```{r fig.cap = "Household income decomposition: Explained and unexplained components", warning=FALSE, message=FALSE, echo=FALSE}
plot(blinder_oaxaca_net.hh.income, decomposition = "twofold", group.weight = -1)
```


\newpage
#References
