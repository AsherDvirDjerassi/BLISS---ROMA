---
title: 'Sources of Ethnic Inequality in Bulgaria: Evidence of Minority Discrimination'
author: "Asher Dvir-Djerassi"
date: ''
output:
  pdf_document:
    fig_caption: yes
    fig_height: 7
    fig_width: 8
    number_sections: yes
  word_document:
    toc: no
  bookdown::pdf_book:
    toc: yes 
fontsize: 11pt
geometry: margin = 1.5in
header-includes:
- \usepackage{booktabs}
- \usepackage{lipsum}
- \usepackage{dcolumn}
- \usepackage{rotating, graphicx}
- \usepackage{float}
- \usepackage{setspace}
- \onehalfspacing
- \usepackage[utf8]{inputenc}
nocite: '@*'
bibliography: bibliography.bib
subtitle: 'DRAFT' 
abstract: Bulgarian Roma and Turks, who both constitute more than 10 percent of Bulgaria's population,  unambiguously face some of the most egregious material poverty and discrimination in contemporary Europe. Income inequality between ethnic minorities and ethnic Bulgarians in contemporary Bulgaria is dramatic; mean and median monthly net wages and total household incomes of ethnic minorities are half of Bulgarian households and wage earners. The aim of this paper is to decompose the factors leading to this inequality. By employing a Blinder-Oaxaca decomposition as well as a set of log-linear models, this paper estimates the extent to which differences in endowments -- e.g. differences in educational attainment, regional differences, household composition, and demographics -- explain inequalities between Bulgarian minorities and ethnic Bulgarians versus the role of factors specific to minorities -- e.g. employer discrimination, opaque structural discrimination, and any other characteristics specific to this ethnic group. This paper uses 2013 cross-sectional data collected in a joint Open Society--World Bank effort termed the Bulgarian Longitudinal Inclusive Society Survey. The estimates obtained here provide clear evidence that after accounting for labor market relevant differences betweeen ethnic groups, one's status as a minority depreciates labor market earnings and household income while being associated with higher levels of government transfer income. The estimates produced here provide strong and statistically significant evidence showing that while differences in certain endowment factors, namely education, explain a portion of the inequalities between minorities and ethnic Bulgarians, other non-endowment factors (e.g. structural and employment discrimination) are driving the bulk of economic inequality between Bulgarian's ethnic groups. Lastly, this paper decomposes the factors associated with observered differences in the economic characteristics of Roma and Turks who live in segregated communities and those who do not in order to estimate the potential role segregation effects may play in suppressing econonmic outcomes for minorities; the estimates produced here do not provide evidence that segregation explains the heterogeniety of economic outcomes within minorities. 

---
\inputencoding{latin2}
\doublespacing
\setlength{\parindent}{2em}



\tableofcontents
\newpage


```{r warning=FALSE, message=FALSE, include=FALSE}
### -------- Packages ---------- ###
#NOTE: additional packages are also uploaded below when needed. 

#install.packages("tinytex")
#tinytex::install_tinytex(force = TRUE)

#install.packages("bookdown")
library("bookdown")
#install.packages("survey")
library("survey")
#install.packages("RSQLite")
library("RSQLite") 
#install.packages("tidyverse")
library("tidyverse")
#install.packages("RefManageR")
library("RefManageR")
#install.packages("foreign")
library("foreign")
suppressPackageStartupMessages(library("dplyr"))
library("knitr")
#install.packages("ggplot2")
library("ggplot2")
#install.packages("Hmisc")
library("Hmisc")
#install.packages("lattice")
library("lattice") 
#install.packages("gridExtra")
library("gridExtra") 
#install.packages("scales")
library("scales")
#options(kableExtra.latex.load_packages = TRUE)
#install.packages("kableExtra")
library("kableExtra")
#install.packages("sjPlot")
library("sjPlot")
#install.packages("stargazer")
library("stargazer")
#install.packages("xtable")
library("xtable") 
#install.packages("texreg")
library("texreg")
#install.packages("magrittr")
library("magrittr")
#install.packages("survey")
library("survey")
#install.packages("tableone")
library("tableone")
#install.packages("data.table")
library("data.table")
#install.packages("oaxaca")
library("oaxaca")
#install.packages("olsrr")
library("olsrr")
#install.packages("lmtest")
library("lmtest")
#install.packages("sandwich")
library("sandwich")
#install.packages("tableone")
library("tableone")
#install.packages("texreg")
library("texreg")
#install.packages("ggthemes") 
library(ggthemes) 
library(tidyr)



### ------ Set Working Directory ###

#setwd("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal")

### -------- Create .bib file from Zotero  ---------- ###

#Link Zotero account to create bibliography in 
user_id = 2693449 #Zotero userID

collection_id = "7HMW3TNA" #Collection Key - The collection id is just the last character set after collectionKey/ at the end of the collection’s URL. https://www.zotero.org/napoleon_asher/items/collectionKey/7HMW3TNA

private_key = "UW0LHvayXhxsAYr3jpIjtA1N" # private key of zetero account can be created through the following steps: Zotero account, Home --> Settings--> Feeds/API --> then "click on "Create new private key"

biblio <- ReadZotero(user = user_id, .params = list(collection = collection_id, key = private_key )) #Creates an object called biblio which reads the reference material from the Zotero collection for which the reference IDs above link to. 

WriteBib(biblio, file = "bibliography.bib", biblatex = TRUE, append = FALSE, verbose = TRUE) #Creates a .bib document in the the working directory. Name the .bib file what the bibliography is called in the intro section (i.e. bibliography: bibliography.bib)

```


# Introduction and Literature Review

Bulgarian Roma unambiguously face some of the most egregious social exclusion, material poverty, and discrimination in contemporary Europe. Presently, Bulgarian Roma -- often pejoratively termed gypsies or tsigani -- constitute roughly 10 percent of the population of Bulgaria [@european_commission_european_2014].^[The analysis for this paper was conducted in R. The Rmarkdown file used to create this PDF can be found at the Github repository for this project: https://github.com/AsherDvirDjerassi/BLISS---ROMA .] The European Union Agency for Fundamental Rights along with other EU agencies, the United Nations Development Program, the World Bank, and the Open Society Foundation have identified the degree of Roma discrimination and ethnic inequality in Bulgaria as abhorrent [*see* @ram_europeanized_2014; @the_economist_left_2015 ].^[According to the Bulgarian national census, Roma make up 5% of the population. However, it is widely agreed that the census dramatically underestimates the true size of the Roma population due to lack of proper registration of Roma, distrust of officials, and intentional obscuration of ethnicity for fear of prejudice (*see* @european_commission_european_2014 and @the_economist_left_2015).]  

Despite calls by civil society and the European Union -- alongside abundant evidence of extreme material poverty and lack of opportunity among Bulgarian Roma -- the current political make-up of Bulgaria has ensured that efforts to reduce inequality and discrimination against Roma are waning. Rather, forces of discrimination have been on the rise since the 2017 Bulgarian elections when a coalition of three ultra-rightwing parties were brought into government by Boyko Borisov, who has held the office of prime minister for a nearly continuously stretch since 2009 [*see* @dnevnik_volen_2018]. In order to maintain control of the government after an election that significantly reduced the size of the Citizens for European Development of Bulgaria (GERB), the prime minister’s party went into coalition with the United Patriots, a coalition of three ultra nationalist, anti-Roma parties that was formed in 2016.^[The following parties constitute the United Patriots: The VMRO (a faction of the Bulgarian National Movement), the National Front for the Salvation of Bulgaria (NFSB), and Ataka.]

As of October 2018, 7 out of 20 ministers and deputies minister in government come from the ultra-rightwing United Patriots. Valeri Simeonov, co-leader of the ultra-right wing coalition, currently holds the position of the Deputy Prime Minister and is tasked with overseeing Bulgaria’s National Council on Co-operation on Ethnic and Integration Issues, which is intended to coordinate policy on minority rights with Bulgarian and European NGOs. Despite holding a position designed to defend minority rights, Simeonov has called the country's Roma minority "ferocious humanoids" whose women "have the instincts of street dogs"[ @katie_french_far-right_2018].

## Evidence of Systematic Prejudice

Drawing from survey data, Alexey Pamporov, a leading Bulgarian sociologist with the Bulgarian Academy of Sciences, writes that "approximately 30% of Bulgarians do not want Roma people living in the country"[-@pamporov_drunken_2012]. Stereotypes of Roma as "lazy," "dirty," "deceitful," and "thievish" proliferate throughout Bulgarian media, popular culture, and mainstream discourse. Pamporov argues that the prevalence of these deleterious stereotypes reinforces residential and educational segregation and leads to labor market discrimination.

Pamporov, along with researchers from the Open Society Foundation, conducted content analysis on Bulgaria's leading newspapers in the few months preceding the 2009 parliamentary elections. Of the articles analyzed, 716 were identified as mentioning Roma either directly or indirectly, while "61.5% seemingly attempted to be politically correct.” These articles used "the endonyms Roma, Romani or other derivatives from these terms, [but] in the majority of articles, referring to ethnicity did not improve the articles' value and informativeness...[A quarter of articles] used the exonym Gypsies. In 55.4% of cases the protagonists are referred to as swarthy... Ethnic identity is not mentioned at all in only 1% of the articles" [@pamporov_drunken_2012, p. 145]. While Bulgarian newspapers vary widely in the share of articles that provide positive, negative, or neutral representations of Roma, typically between 11 and 33 percent of a newspaper's coverage was classified as negative. 

In a set of anonymous questionnaires presented in 2011 to ethnic Bulgarians working as doctors, social workers, or teachers, it is clear that while most ethnic minorities in Bulgaria generally have positive associations, Roma do not [@metodieva_beyond_2012]. Pomaks (ethnic-Bulgarians whose ancestors converted to Islam) and Turks are most strongly associated with being "hardworking" and "religious," while Jews and Armenians are associated with business acumen and cleverness. In sharp contrast, "Roma are depicted as criminals, lazy, dirty, liars, and uneducated both by the national level survey and in the target groups’ samples."  

## Ethnic Inequality and Discrimination in Bulgaria

While it is beyond the scope of this article to establish the complete array of possible consequences that such stereotypes engender, the pervasiveness of negative stereotypes gives strong reason to believe that discrimination against Bulgarian Roma is widespread and plays a significant role in shaping the gap between Roma and ethnic Bulgarians. 

Amnesty International (2018) claims that "marginalization and widespread discrimination against Roma persists." In addition to employment discrimination, Amnesty stresses the obstacles Bulgarian Roma face in accessing public services, particularly education, healthcare, housing, and infrastructure (particularly sewage, trash collection, and clean roads). The most striking and visceral manifestation of ethnic inequality in Bulgaria is the severe inadequacy of infrastructure and housing in Roma communities. According to a 2011 survey conducted by the EU Agency for Fundamental Rights, which surveyed Roma households in primarily Roma neighborhoods and ethnic Bulgarians that lived near to these communities, 39 percent of Roma dwellings had no piped water inside compared with 4 percent of non-Roma dwellings nearby (@european_union_agency_for_fundamental_rights_survey_2014). 75 percent of such Roma dwellings in segregated neighborhoods had no indoor toilet, relative to 31 percent of non-Roma dwellings nearby.

The root of this widespread segregation, inadequate housing, and sub-par infrastructure lies partly in the forced settlement of Bulgarian Roma in 1958. After the completion of full land collectivization by the Communist regime, the Bulgarian politburo outlawed the often migratory living patterns of Roma.^[*See* @ilieva_number_2012 discussion of the Bulgarian Census]. Like the Communist Party's policy towards Bulgarian Turks, ethnic self-identification was heavily discouraged and collective advocacy for Roma causes was censured. The combination of sudden urbanization, lack of political representation, and prejudice on the part of the Communist regime created conditions where Roma were segregated into ghettos. After the fall of communism in the early 1990s, the collapse of state structures allowed for Bulgarian Roma to effectively squat in a manner comparable to Brazilian favelas and slums found elsewhere in the Global South [*see* @barany_politics_2000]. Such communities lacked and continue to lack de jure access to public services: the state often does not recognize a formal responsibility in providing public services to Roma and Turkic dwellings in communities that not legally recognized. 

There are open questions as to what the relative role of labor market discrimination plays in determining economic inequality between ethnic groups in Bulgaria. In terms of labor market outcomes, the gap between Roma and ethnic Bulgarians is very wide. For those of prime working age, 20--64 years old, 68 percent of non-Roma Bulgarians had at least part-time employment compared to 49 percent of Roma.^[The employment rate of ethnic Bulgarians comes from Eurostat, while the employment rate for Roma was collected in the second wave of the European Union Minorities and Discrimination Survey, 2016.] However, it may be the case that employment discrimination is not as instrumental in explaining this gap as the ubiquity of negative stereotypes and prejudice may suggest. Rather, it may be the case that the gap in labor market outcomes between Roma and the rest can be largely explained by differences in relevant labor market characteristics that are outside of ethnicity, such as how much education one has, the skills one possesses, and the region one lives in. In terms of education, Roma have paltry educational outcomes relative to ethnic Bulgarians. According to the 2011 Fundamental Rights Agency Roma Survey, 67 percent of adult Roma reported leaving school before the age of 16. In contrast, a mere 26 percent of non-Roma living in the same communities as these Roma reported leaving school before 16. 

Decomposing the relative impact of factors driving ethnically-based economic inequality is essential to the enterprise of bridging this ethnic divide. With funds dedicated to the plight of Bulgarian Roma withering alongside the rise of ultra-rightwing political parties, ensuring the efficiency of each euro dedicated to ameliorating Roma poverty has even more urgency.


# Data

This paper uses the Bulgarian Longitudinal Inclusive Society Survey (BLISS). BLISS is part of a larger panel survey collected between February 2010 and April 2013 from a representative sample of Bulgarian households at the behest of the World Bank and the Open Society Institute--Sofia. Information on demographics, education, taxes, transfers, and other relevant labor market information on the household and individual household members were collected. 

Distinctive among comparable surveys in Bulgaria, this panel survey was constructed to identify a representative sample of those who identify as ethnically Roma, Turkish, and Bulgarian. To garner sufficient variation among Bulgarian minorities, BLISS surveyed a greater number of Roma and Turkish households than would be proportionate to their share of the population (i.e. a ‘booster’ sample). This representative survey was able to follow households and the members of those households across the survey period (February 2010 to April 2013) with quite little attrition. The planned size of the main sample in the first round was 2,384 households, and 99% of this sample was realized. A Bulgarian Roma booster sample of 296 households was planned; 99% of surveyed households responded. Figure 1 presents the raw and weighted count of households in the 2013 survey by ethnic group.

```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
## Data Preparation

##The procedure for merging the constituent data-sets is quite complicated, therefore, I have included an rds file on github that may be easily download in lieu of merging and cleaning the data as I originally did. However, in the r chunk below, the code used to merge the constituent data-sets is shown, albeit commented-out.

#NOTE: This prodecure can be reproduced most easily by downloading the data files from the Github repo below. The data files are organized such that a reference file, BGR_2013_BLISS_v01_M_M1.dta, is in a seperate folder (M_M1) from the files that make up 'file_list': https://github.com/AsherDvirDjerassi/BLISS---ROMA/tree/master/BLISS%20Data

#Create a data frame, which is set equal to one dataset that has all observations and household and member IDs (i.e. HH_ID and HHM_ID). I use the first dataset in the collection of the BLISS survey (i.e. BGR_2013_BLISS_v01_M_M1.dta). This file has been placed outside of the folder that is used to create the list of other datasets so that it is not included twice. 

#dataset <- data.frame()

#dataset <- read.dta("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_M1.dta") 


#dataset$m1_q1 <- iconv(dataset$m1_q1,from="CP1251",to="UTF-8") #Read names as Bulgarian Cyrillic

#Create a list of the files from the target directory.

#file_list <- list.files(path="/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_Stata8")

#colnames(dataset) <- toupper(names(dataset))    #Makes all columns names upper-case
#if ("ID_HOUSEHOLD" %in% colnames(dataset)){     #Deals with cases where HH_ID is named ID_household
#  dataset <- rename(dataset, "HH_ID" = "ID_HOUSEHOLD")
#}
#if ("HHM_ID" %in% colnames(dataset)){           #Makes data type of HHM_ID the same
#  dataset$HHM_ID <- as.character(dataset$HHM_ID)
#}
#if ("HH_ID" %in% colnames(dataset)){            #Makes data type of HH_ID the same
#  dataset$HH_ID <- as.character(dataset$HH_ID)
#}

#for (i in 1:length(file_list)) {
#  setwd("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_Stata8")
#  temp_data <- read.dta(file_list[i])               #Each data file is read
#  colnames(temp_data) <- toupper(names(temp_data))  #Makes all columns names upper-case
#  if ("ID_HOUSEHOLD" %in% colnames(temp_data)){     #Deals with cases where HH_ID is named ID_household
 #   temp_data <- rename(temp_data, "HH_ID" = "ID_HOUSEHOLD")
#  }
#  if ("HHM_ID" %in% colnames(temp_data)){           #Makes data types the same
 #   temp_data$HHM_ID <- as.character(temp_data$HHM_ID)
#  }
#  if ("HH_ID" %in% colnames(temp_data)){            #Makes data types the same
 #   temp_data$HH_ID <- as.character(temp_data$HH_ID)
#  }
#    if(length(unique(temp_data$HHM_ID))>1){
#    dataset <- left_join(dataset, temp_data, by = c("HH_ID","HHM_ID"))
#    } else {
#    temp_data$HHM_ID <- NULL
#    dataset <- left_join(dataset, temp_data, by = c("HH_ID"))
#    }
#}

#Add Psych Data
#psych_data <- read.dta("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Data/Project Proposal/BGR_2013_BLISS_v01_M_Stata8/BGR_2013_BLISS_v03_M_Psyh.dta")
#colnames(psych_data)[c(4,5)]<-c("HH_ID","HHM_ID")
#psych_data$HHM_ID <- as.character(psych_data$HHM_ID)
#psych_data$HH_ID <- as.character(psych_data$HH_ID)
#dataset <- left_join(dataset, psych_data, by = c("HH_ID","HHM_ID"))

#Add wt_bliss_cs_cs_ind
#wt_bliss_cs_cs_ind <- read.dta("/Users/jmaasch/Downloads/wt_bliss_cs_cs_ind.dta")
#colnames(wt_bliss_cs_cs_ind)[c(1, 9)]<-c("HH_ID","HHM_ID")
#wt_bliss_cs_cs_ind[c(2:8,10:11,13)]<-NULL
#colnames(wt_bliss_cs_cs_ind)[c(3,4)]<-c("wt_bliss_cs_cs_ind","wt_adj_bliss_cs_cs_ind")
#wt_bliss_cs_cs_ind$HHM_ID <- as.character(wt_bliss_cs_cs_ind$HHM_ID)
#wt_bliss_cs_cs_ind$HH_ID <- as.character(wt_bliss_cs_cs_ind$HH_ID)
#dataset <- left_join(dataset, wt_bliss_cs_cs_ind, by = c("HH_ID","HHM_ID"))

#saveRDS(dataset, "dataset.rds")
#getwd()
```



```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
###### ------------------------ LOOK BELOW!------------------------------- ########

#Read Data
dataset <- readRDS("/Users/asherdvir-djerassi/Library/Mobile Documents/com~apple~CloudDocs/Roma Paper/Capstone - rds and r script/dataset.rds")

dim(dataset)
kable(dataset[1:5,1:5])

#NOTE: There are 7468 rows in the final data, when there should be 7467 rows. However, when creating the set of depedent and independent variables, the dataframe used in this analysis has the proper number of rows.

#The data above can be accessed directly here: https://github.com/AsherDvirDjerassi/BLISS---ROMA/blob/master/Data%20and%20Script/dataset-2.rds
```


```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Potential Dependent Variables

#There are two dependent variables used in this project: net monthly average wages and net monthly household income

## Income components

# Taxable employment income + Income from capital, e.g. dividends and interests  + Income received by children + Income from occupational and private pensions + Private transfers received + Income from property + Taxable self-employment income + Non-reported employment income + Non-reported self-employment income - Maintenance payments

#Benefits simulated by EUROMOD: Child benefit for education  (целева помощ за ученици) + Guaranteed minimum income (помощ за социално подпомагане : гарантиран минимален доход) + Means-tested child benefit (месечна помощ за отглеждане на дете) + Contributory maternity benefit for pregnancy and childbirth (Обезщетение за бременност и майчинство) + Non-contributory benefit for raising a child under the age of 1 (месечна помощ за отглеждане на дете до 1 г. възраст) + Heating benefit (целева помощ за отопление) + Unemployment benefit (обезщетениe за безработица) + Contributory maternity benefit for bringing up child up to age 2 (Обезщетение за отглеждане на дете до 2г.) + Non-means tested child benefit for mothers in tertiary education (from 2009 on) + Non-means tested child benefit for twins (from 2009 on) + Birth grant (also for adoption) (еднократна помощ при раждане)				
#Benefits derived from EU-SILC: Sickness benefits + Lump sum pregnancy grant + Other non-means-tested family benefits + Other unemployment benefits + Educational benefit (scholarships etc.) + Other (complementary) non-means-tested social assistance benefits + Old-age pension + Survivor pensions + Disability pensions + Housing benefits + Other means-tested social assistance + Other means-tested family benefits

#-------------------------------------

# Module 2A: Labor, for Everyone in Household 15 Years and Over 
# Module 2B: For Members who Reported Working in Past 4 Weeks

dataset$M2_Q3[1:100] # Have you worked in the past 4 weeks? 
dataset$M2_Q10A[1:100] #m2_q10 What is the total net amount that [NAME] has earned in the past 12 months
dataset$M2_Q16A[1:100] #m2_q16a What are [NAME'S] MONTHLY AVERAGE NET wages (net of taxes and contributions). 
dataset$M2_Q17A[1:100] #m2_q17a What are [NAME'S] MONTHLY AVERAGE NET earnings from this work or busines (current work) 

#-------------------------------------

#Module 5A: Social Assistance

dataset$M5A_Q2_11[1:100]#What was/is the monthly value of this allowance for all household members? Monthly child benefits (for children under 18 years, or 20 if in school)
dataset$M5A_Q3_11[1:100]#What was/is the monthly value of this allowance for all household members? Infant benefits (for children under 1 year or 2 years if disabled)
dataset$M5A_Q4_11[1:100]#What was/is the monthly value of this allowance for all household members? Monthly social assistance for low income households
dataset$M5A_Q5_11[1:100] #What was/is the monthly value of this allowance for all household members? Heating allowance

#-------------------------------------

#Module 5B: Unemployment Benefits

dataset$M5B_Q6[1:100]#What is the monthly value of the unemployement benefits?

#-------------------------------------

#The dataset contains information from Module 5C: Other Social Protection

dataset$M5C_Q2E[1:100]#What pensions, aid or benefits did [NAME] receive in the past 12 months? What is the monthly value of this benefit [NAME] received?
dataset$M5C_Q3E[1:100] #What pensions, aid or benefits did [NAME] receive in the past 12 months? What is the monthly value of this benefit [NAME] received?

#------------------------------------

#Module 10: Subjective
dataset$M10_Q19[1:100]#What is the total net monthly income of your household at the moment (Total sum of the household members income from salaries/wages, pensions, social and family assistance, regular transfers from persons outside the household and from other sources)?
#-------------------------------------

```


```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

####Clean and Transform Independent Variables
#----------------------------------------------
#Combined the data above into dependent variables
#Convert dep_vars from matrix to dataframe
dep_vars <- as.data.frame(cbind(dataset$HH_ID, 
                                dataset$HHM_ID, 
                                dataset$M1_Q22, 
                                dataset$SAMPLE_TYPE.x,
                                dataset$M2_Q3, 
                                dataset$M2_Q16A, 
                                dataset$M5A_Q2_11_PERYEAR, 
                                dataset$M5A_Q3_11_PERYEAR,
                                dataset$M5A_Q4_11_PERYEAR, 
                                dataset$M5A_Q5_11, 
                                dataset$M5B_Q6, 
                                dataset$M5C_Q2E, 
                                dataset$M5C_Q3E, 
                                dataset$M10_Q19, 
                                dataset$WTA_ADJ_HH, 
                                dataset$wt_adj_bliss_cs_cs_ind, 
                                dataset$wt_bliss_cs_cs_ind
                                ))

#Rename columns of dependent variables dataset
names(dep_vars) <- c("HH_id",
                     "HHM_id",
                     "Ethnicity",
                     "Booster or Main Sample",
                     "worked in the past 4 weeks",
                     "monthly average net wages",
                     "annual value of child benefits",
                     "annual value of infant benefits",
                     "annual value of social assistance",
                     "annual value of heating allowance",
                     "monthly value of the unemployement benefits",
                     "monthly value of pension, aid, or benefits, 1",
                     "monthly value of pension, aid, or benefits, 2",
                     "total net monthly household income", 
                     "household weights", 
                     "individual weights with population adjustment",
                     "individual weights without population adjustment")
#-------------------------------------


dep_vars$`Booster or Main Sample` <- ifelse((dep_vars$`Booster or Main Sample`)==1, "Main sample", "Booster sample")

# yes is coded as 1 and no is coded as 2 
dep_vars$`worked in the past 4 weeks`<-ifelse((dep_vars$`worked in the past 4 weeks`)==1,1, 0)

#-------------------------------------

#If ethnicity is N/A, then set ethnicity equal to the value of another member of their household, HH_id. 

setDT(dep_vars)[, ethnic := unique(Ethnicity[!is.na(Ethnicity)]), by = HH_id]

#Display the household id and member id in addition to the old ethnicity column and the new ethnicity column. 
df <- dep_vars %>% select(HH_id, HHM_id, Ethnicity, ethnic) 

#Display the df for rows that contained NA for ethnicity.
head(filter(df, Ethnicity %in% NA))

rm(df)

#Drop old Ethnicity
dep_vars$Ethnicity <- NULL


 #-------------------------------------

#Converts all columns to numeric
dep_vars[,3:14][is.na(dep_vars[,3:14])] <- 0 

#Convert all relevant columns to numeric
dep_vars$`monthly average net wages` <- as.numeric(dep_vars$`monthly average net wages`)

dep_vars$`annual value of child benefits` <- as.numeric(dep_vars$`annual value of child benefits`)

dep_vars$`annual value of infant benefits` <- as.numeric(dep_vars$`annual value of infant benefits`)

dep_vars$`annual value of social assistance` <- as.numeric(dep_vars$`annual value of social assistance`)

dep_vars$`annual value of heating allowance` <- as.numeric(dep_vars$`annual value of child benefits`)

dep_vars$`monthly value of the unemployement benefits` <- as.numeric(dep_vars$`monthly value of the unemployement benefits`)

dep_vars$`monthly value of pension, aid, or benefits, 1` <- as.numeric(dep_vars$`monthly value of pension, aid, or benefits, 1`)

dep_vars$`monthly value of pension, aid, or benefits, 2`<- as.numeric(dep_vars$`monthly value of pension, aid, or benefits, 2`)

dep_vars$`total net monthly household income`<- as.numeric(dep_vars$`total net monthly household income`)

dep_vars$`household weights` <- as.numeric(dep_vars$`household weights`)

```



```{r Table 4.3 Market incomes number of recipients, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

#Make household weights numeric 
dep_vars$`household weights` <- as.numeric(dep_vars$`household weights`)

#Positive monthly average wages (i.e. employed)
dep_vars$`Positive monthly average wages` <- ifelse((dep_vars$`monthly average net wages`)>0,1,0)
dep_vars$`Positive monthly average wages` <- ifelse(is.na(dep_vars$`monthly average net wages`),0,1)
sum(dep_vars$`Positive monthly average wages`)

#Worked in the past 4 weeks (i.e. employed) - This is the same as the above metric
dep_vars$`worked in the past 4 weeks` <- ifelse((dep_vars$`worked in the past 4 weeks`)==2,0,1)
dep_vars$`worked in the past 4 weeks` <- ifelse(is.na(dep_vars$`worked in the past 4 weeks`),0,1)
sum(dep_vars$`Positive monthly average wages`)

dep_vars$`individual weights with population adjustment` <- as.numeric(dep_vars$`individual weights with population adjustment`)
dep_vars$`individual weights without population adjustment` <- as.numeric(dep_vars$`individual weights without population adjustment`)

```


```{r message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Sample `household weights`
#In the subsections below, I walk through the process of assigning sample `household weights` to the data. Additionally, I compare BLISS income data with household `household weights` applied to the data on Bulgarian households from the European Union Survey of Income and Living Conditions. 

## Household sample `household weights` applied to the sample at the individual level


# Discussion of `household weights` in BLISS survey documentation: 
# The propensity score represents the probability that an individual with a particular combination of characteristics would be successfully interviewed, and is therefore a measure of the response rate at the micro level. By multiplying the basic weight by the inverse of this response rate, the weighted estimates reduce the bias due to some groups being under-represented in the sample due to nonresponse. The logistic response propensity scores were calculated separately for the data from the CMS2, CMS3 and BLISS panels of sampleindividuals for the Main Survey and the Booster Survey. Another attritionn analysis was run for the panel households interviewed in all waves of each survey


#Combined booster and main sample HH `household weights` for analysis
head(dep_vars$`household weights`)

#Set N/A's equal to 0 in the household `household weights`
dep_vars$`household weights`[is.na(dep_vars$`household weights`)] <- 0  

dep_vars$`household weights` <- as.numeric(dep_vars$`household weights`)
typeof(dep_vars$`household weights`)
```



```{r Create household df, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
## Create dataframes of household income by source
#----------------------------------------------
dataset$M5A_Q3_11_PERYEAR[is.na(dataset$M5A_Q3_11_PERYEAR)] <- 0 
dataset$M5A_Q2_11_PERYEAR[is.na(dataset$M5A_Q2_11_PERYEAR)] <- 0 
dataset$M5A_Q4_11_PERYEAR[is.na(dataset$M5A_Q4_11_PERYEAR)] <- 0 
dataset$M5A_Q5_11[is.na(dataset$M5A_Q5_11)] <- 0 
dataset$M5C_Q2_PERYEAR[is.na(dataset$M5C_Q2_PERYEAR)] <- 0 
dataset$M5B_Q6_P[is.na(dataset$M5B_Q6_P)] <- 0 
dataset$M2_Q16_PERYEAR[is.na(dataset$M2_Q16_PERYEAR)] <- 0 


#1) household monthly value of infant benefits
`infant benefits` <- aggregate(dataset$M5A_Q3_11_PERYEAR, by=list(dataset$HH_ID), FUN=sum)

#2) household monthly value of child benefits
`child benefits` <- aggregate(dataset$M5A_Q2_11_PERYEAR, by=list(dataset$HH_ID), FUN=mean)

#3) household monthly value of social assistance
`social assistance` <- aggregate(dataset$M5A_Q4_11_PERYEAR, by=list(dataset$HH_ID), FUN=mean)
#4) household heating allowance
`heating allowance` <- aggregate(dataset$M5A_Q5_11, by=list(dataset$HH_ID), FUN=mean)

#5) Household total pensions
hh_pension <- aggregate(dataset$M5C_Q2_PERYEAR, by=list(dataset$HH_ID), FUN=sum)

#6) Unemployment insurance - dataset$M5B_Q6_P is the annual total for unemployment insurance benefits
    #make na zeros
dataset$M5B_Q7A[is.na(dataset$M5B_Q7A)] <- 0
    #
dataset$unemployment_insurance_annual <- dataset$M5B_Q6_P
    #multiply number of months on UI by monthly benefits
`unemployment insurance` <- (aggregate(dataset$unemployment_insurance_annual, by=list(dataset$HH_ID), FUN=sum))

#7) Household Income
hh_income <- (aggregate(dep_vars$`total net monthly household income`, by=list(dep_vars$HH_id), FUN=mean))

#hh_income$x <- hh_income$x*12

#8) Household average net wages
hh_average_net_wages <- aggregate(dataset$M2_Q16_PERYEAR, by=list(dataset$HH_ID), FUN=sum)

#9) Household Ethnicity --- particularly in the event that there are multiple ethnic groups in household
dep_vars$Roma <- ifelse( dep_vars$ethnic==3, 1, 0)
hh_roma <- aggregate(dep_vars$Roma, by=list(dep_vars$HH_id), FUN=mean)
unique(hh_roma[,2])
hh_roma[,2] <- ifelse((hh_roma[,2])==0,0, 1)
unique(hh_roma[,2])

#Use cbind to form one dataframe for household data
hh_data <- cbind.data.frame(`heating allowance`,
                            hh_average_net_wages[,2],
                            hh_income[,2],
                            hh_pension[,2], 
                            hh_roma[,2],
                            `infant benefits`[,2],
                            `child benefits`[,2],
                            `social assistance`[,2],
                            `unemployment insurance`[,2])

colnames(hh_data) <- c("HH_id","heating allowance", "average net wages", "total net monthly household income", "household pension income", "Roma household", "household infant benefits", "household child benefits", "household social assistance income", "unemployment insurance")

dim(hh_data) #proper length (i.e. equal to the number of households) 
head(hh_data)


###----------
#hh weight
sum(is.na(dep_vars$`household weights`)) # no na values in household weights

#Extract household `household weights` - one weight per household (2525 observations)
HH_weight <- aggregate(dep_vars$`household weights`, by=list(dep_vars$HH_id), FUN=mean)

colnames(HH_weight) <- c("HH_id","HH_weight")

hh_data <- left_join(hh_data, HH_weight, by ="HH_id")

#check whether there are na values
unique(is.na(hh_data$HH_weight))

#REMOVE TIHNGS NOT NEEDED 
rm(`heating allowance`,
   hh_average_net_wages,
    hh_income,
    hh_pension, 
    hh_roma,
    `infant benefits`,
    `child benefits`,
    `social assistance`,
   `unemployment insurance`,
    HH_weight)
```



```{r Create Roma/non-Roma catergory, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Create Roma/Bulgarian catergory
#----------------------------------------------
#Eliminate rows where ethnicity is not reported
#dep_vars <- subset(dep_vars, !is.na(dep_vars$ethnic)); sum(is.na(dep_vars$ethnic))
unique(dataset$m1_q22)
  
  
#Unqiue ethnicity catergories
unique(dep_vars$ethnic)
count(dep_vars, c(ethnic))

dep_vars$ethnic <- as.numeric(dep_vars$ethnic)
dep_vars$ethnic_group <- ""

dep_vars$ethnic_group[dep_vars$ethnic == 1] <- "Bulgarian"
dep_vars$ethnic_group[dep_vars$ethnic == 2] <- "Roma"
dep_vars$ethnic_group[dep_vars$ethnic == 3] <- "Turkish"
dep_vars$ethnic_group[dep_vars$ethnic == 4] <- "Other"
dep_vars$ethnic_group[dep_vars$ethnic == 5] <- "Other"
dep_vars$ethnic_group[is.na(dep_vars$ethnic)] <- "Other"

unique(dep_vars$ethnic_group)
count(dep_vars, c(ethnic_group))

# Sample type

#dep_vars$`Booster or Main Sample`

```




```{r Deciles by Roma and Bulgaria, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}


########### THIS NEEDS TO BE COMPLETELY CHANGED 
############ THE ETHNIC THING IS TOTALLY OFF!!!!!!!!



# #subset for only Roma
# df_roma <- subset.data.frame(weighted_hh_data$variables, weighted_hh_data$variables$ethnic==1)
# df[df==0] <- NA
# household_income_by_decile_df_roma <- data.frame(aggregate(df_roma, by=list(df_roma$decile), FUN=mean, na.rm=TRUE))
# 
# #subset for only non-Roma
# df_non_roma <- subset.data.frame(weighted_hh_data$variables, weighted_hh_data$variables$ethnic==0)
# df[df==0] <- NA
# household_income_by_decile_non_roma <- data.frame(aggregate(df_non_roma, by=list(df_non_roma$decile), FUN=mean, na.rm=TRUE))
```



```{r Potential Independent Variables, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## INDEPENDENT VARIABLE AREA!!!!!!

## Potential Independent Variables
#---------------------------------------


#Module 1A: Roster and Module 1B: Education 

#---------------------------------------

#Module 2A: Labor, for Everyone in Household 15 Years and Over and Module 2B: For Members who Reported Working in Past 4 Weeks

unique(dataset$M2_Q7D) #What is the minimum monthly wage you would accept right now to start working?

dataset$M2_Q7F <- ifelse(is.na(dataset$M2_Q7F),"no","yes")
unique(dataset$M2_Q7F) #Would you be willing to move to a different settlement in Bulgaria for a job?

dataset$M2_Q7E[is.na(dataset$M2_Q7E)] <- 0 
dataset$M2_Q7E[1:100] #How far are you willing to commute for a job?
               
unique(dataset$M2_Q25A) #What is the main reason you/[NAME] doesn't work full-time?

unique(dataset$M2_Q25B) #Would you/[NAME] work more hours if there were available and affordable child care services?
dataset$M2_Q25B[is.na(dataset$M2_Q25B)] <- 'no'

unique(dataset$M2_Q25C) #Would you/[NAME] work more hours if there were available and affordable care services for ill, disabled, or elderly people?
dataset$M2_Q25C[is.na(dataset$M2_Q25C)] <- 'no'

#---------------------------------------

#Module 5A: Social Assistance

unique(dataset$M5A_Q1) #Has this household any children under 20 years old?

#--------------------------------------

unique(dataset$M1_Q3) #Sex
unique(dataset$M1_Q14A) #highest level of education
unique(dataset$REGION.x.x) #Region identifier 

#--------------------------------------

#Psych Data 

#Numeracy 
sum(!is.na(dataset$IRT_Scores_Numeracy_skills))
dataset$IRT_Scores_Numeracy_skills

#Reading Comp
dataset$IRT_Scores_Reading_Compr_skills
sum(!is.na(dataset$IRT_Scores_Reading_Compr_skills))

#Semantic Skills
dataset$IRT_Scores_Semantics_skills
sum(!is.na(dataset$IRT_Scores_Semantics_skills))

#There are 1732 observations in the IRT Score variables above that are not N/A's
#These observations were the respondents who were surveyed. 
#The remaining observations will remain N/A
#--------------------------------------

#Create dataset of indp vars
indep_vars <- dataset[c("HH_ID", "HHM_ID", "M2_Q25A", "M1_Q3", "M2_Q7F", "M2_Q7E", "M2_Q25B", "M2_Q25C", "M5A_Q1", "M1_Q14A", "AGE_GROUPS", "Region", "IRT_Scores_Numeracy_skills" , "IRT_Scores_Reading_Compr_skills", "IRT_Scores_Semantics_skills")]

#Rename columns
names(indep_vars) <- c("Household Id", "Household Member Id", "Main reason doesn't work full-time ", "Sex: ", "Willing to move within Bulgaria for a job? ", "Length willing to commute? ", "Would work more if child care? ", "Would work more if care services for disabled? ", "Household with children under 20? ", "Education ", "Age: ", "Region", "Numeracy", "Literacy", "Semantics")
#--------------------------------------

#Based on "Main reason doesn't work full-time", create variable "outside of labor market" which takes on the value 1 if attending school or has an illness or disability.
unique(indep_vars$`Main reason doesn't work full-time`)

indep_vars$y <- ifelse(indep_vars$`Main reason doesn't work full-time`=="ATTENDING SCHOOL OR TRAINING COURSES" , 1, 0)
indep_vars$x <- ifelse(indep_vars$`Main reason doesn't work full-time`=="ILLNESS OR DISABILITY", 1, 0)

unique(indep_vars$x)
unique(indep_vars$y)

is.na(indep_vars$x) <- 0 
is.na(indep_vars$y) <- 0 

indep_vars$`Disabled, Ill, or in School` <- indep_vars$x+indep_vars$y

indep_vars$x <- NULL
indep_vars$y <- NULL

#--------------------------------------
unique(indep_vars$Education)

indep_vars$Education <- gsub("none", "none", indep_vars$Education)

indep_vars$Education <- gsub("initial", "initial", indep_vars$Education)

indep_vars$Education <- gsub("secondary", "secondary", indep_vars$Education)

indep_vars$Education <- gsub("PROFESSIONAL BACHELOR", "bachelor's", indep_vars$Education)

indep_vars$Education <- gsub("HIGHER, BACHELOR", "bachelor's", indep_vars$Education)

indep_vars$Education <- gsub("HIGHER, MASTER", "master's", indep_vars$Education)

indep_vars$Education <- gsub("HIGHER, PhD", "PhD", indep_vars$Education)
unique(indep_vars$Education)

indep_vars <- indep_vars %>% mutate(Education = factor(Education, levels = c("none", "initial", "primary", "secondary", "bachelor's", "master's", "PhD"))) 

```


```{r Create combined data-set, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

## Create combined data-set
#--------------------------------------

dim(dep_vars); dim(indep_vars)
combined_data <- cbind(dep_vars, indep_vars)

combined_data$`total net monthly household income`
#--------------------------------------

#Drop if age is less than 18 
unique(combined_data$`Age: `)

combined_data <- subset(combined_data, `Age: `!="Less than 18")

#Drop observations where sex is equal to N/A
combined_data <- combined_data[complete.cases(combined_data$`Sex: `),]

#--------------------------------------

#Fill in missing values of region by using the region of HH_id
setDT(combined_data)[, Region := unique(Region[!is.na(Region)]), by = HH_id]; unique(combined_data$Region)

#--------------------------------------

#Add to ethnic group and booster to 
hh_data <- left_join(hh_data, combined_data, by = "HH_id")
hh_data$`total net monthly household income` <- hh_data$`total net monthly household income.x` 
hh_data$`total net monthly household income.y` <- NULL
hh_data$`total net monthly household income.x` < NULL

hh_data <- hh_data %>% drop_na(`Age: `)

summary(combined_data$`Age: `)
summary(hh_data$`Age: `)

subset(combined_data$`total net monthly household income` , combined_data$`Age: `=="18 - 29")
subset(hh_data$`total net monthly household income` , hh_data$`Age: `=="18 - 29")


#--------------------------------------
#Weight the combined dataset. 
combined_data_weighted <-svydesign(id=~1, weights=~combined_data$`household weights`, data=combined_data)


#--------------------------------------
#Currently hh_data is comprised of all household members who are over the age of 18. We would like to now construct the data frame such that each unit of observation is comprised of the unique household members. 

```


```{r fig.cap = "Count of total households by ethnic group by weighted and unweighted sample",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

options(scipen=10000)

#Count of observations by ethnic groups
g_un_weighted <- ggplot(hh_data, aes(ethnic_group)) +
  scale_y_continuous(labels = scales::comma) + 
  geom_bar(stat = "count") + 
  theme_minimal() +
  labs(title = "Without sample weights", y=NULL, x = NULL) 

g_weighted <- ggplot(hh_data, aes(ethnic_group, weight =`household weights`)) + 
  scale_y_continuous(labels = scales::comma) + geom_bar(stat = "count") + 
  theme_minimal() +
  labs(title = "With sample weights", y=NULL, x = NULL) 

grid.arrange(
  g_un_weighted,
  g_weighted,
  nrow = 2,
  bottom = textGrob(
    "",
    gp = gpar(fontface = 3, fontsize = 8),
    hjust = 1,
    x = 1
  )
)
```

## Data Quality 

Table 1, 2, and 3 compares the 2013 BLISS data to the EU-SILC -- one of the most widely used surveys in the EU dedicated to ascertaining socio-economic data -- and to Bulgaria's administrative data.^[See tables 4.2 through 4.8 in Euromod country report for Bulgaria that is linked here for the EU-SILC and administrative data discussed in this section: https://www.euromod.ac.uk/sites/default/files/country-reports/year7/Y7_BG_CR_Final_0.pdf] In contrast to both the EU-SILC and the BLISS, Bulgarian administrative data ought to be quite close to the accurate figures, particularly as it relates to social transfer spending. Contrasting these surveys with administrative data provides us with an opportunity to investigate the relative quality of this data.  
```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}
total_benefits <- list()

#1) household heating allowance -- same for all hh members
hh_inc_1 <- unique(hh_data[,c('HH_id', 'heating allowance', 'HH_weight')],by = c('HH_id')) 
total_benefits$`annual heating allowance` <- (sum(hh_inc_1$`heating allowance`*hh_inc_1$HH_weight))

#2) Household average net wages -- wages are unique to hh member, therefore should sum all hh members
hh_inc_2 <- unique(hh_data[,c('HH_id', 'average net wages', 'HH_weight')],by = c('HH_id')) 
total_benefits$`total net wages` <- (sum(hh_inc_2$`average net wages`*hh_inc_2$HH_weight))

#3) Household Income -- hh income same for all hh members, therefore only each unique household should be summed
hh_inc_3 <- unique(hh_data[,c('HH_id', 'total net monthly household income', 'HH_weight')],by = c('HH_id')) 
total_benefits$`total net monthly household income` <- sum(hh_inc_3$`total net monthly household income`*hh_inc_3$HH_weight)

#4) Household total pensions -- income same for all hh members, therefore only each unique household should be summed
hh_inc_4 <- unique(hh_data[,c('HH_id', 'household pension income', 'HH_weight')],by = c('HH_id')) 
total_benefits$`household pension income` <- sum(hh_inc_4$`household pension income`*hh_inc_4$HH_weight)

#5) household annual income from infant benefits -- income same for all hh members, therefore only each unique household should be summed
hh_inc_5 <- unique(hh_data[,c('HH_id', 'household infant benefits', 'HH_weight')],by = c('HH_id')) 
total_benefits$`total household infant benefits` <- sum(hh_inc_5$`household infant benefits`*hh_inc_5$HH_weight)

#6) household annual income child benefits -- income same for all hh members, therefore only each unique household should be summed
hh_inc_6 <- unique(hh_data[,c('HH_id', 'household child benefits', 'HH_weight')],by = c('HH_id')) 
total_benefits$`total household child benefits` <- sum(hh_inc_6$`household child benefits`*hh_inc_6$HH_weight)

#7) household annual income social assistance -- income same for all hh members, therefore only each unique household should be summed
hh_inc_7 <- unique(hh_data[,c('HH_id', 'household social assistance income', 'HH_weight')],by = c('HH_id')) 
total_benefits$`total household social assistance` <- sum(hh_inc_7$`household social assistance income`*hh_inc_7$HH_weight)

#8) household income from unemployment insurance -- income same for all hh members, therefore only each unique household should be summed
hh_inc_8 <- unique(hh_data[,c('HH_id', 'unemployment insurance', 'HH_weight')],by = c('HH_id')) 
total_benefits$`unemployment insurance` <- sum(hh_inc_8$`unemployment insurance`*hh_inc_8$HH_weight)


total_benefits <- as.data.frame(total_benefits)/1000000
total_benefits <- round(total_benefits)

colnames(total_benefits) <- c("annual heating allowance", "total net average annual wages", "total net monthly household income", "household pension income", "household infant benefits", "household child benefits", "household social assistance income", "unemployment insurance benefits")

#EU-SILC and administrative data
eu_silc = c(35, 25646, NA ,9469, 73, 236, 23, 363)
external = c(75, 27765, NA ,7461, 142, 352, 54, 351)  

#Monthly child benefits (for children under 18 years, or 20 if in school)	
#Infant benefits (for children under 1 year, or 2 years if disabled)	
  
euromod <- t( data.frame(eu_silc, external))

colnames(euromod) <- c("total monthly heating allowance", "total net average annual wages", "total net monthly household income", "household pension income", "household infant benefits", "household child benefits", "household social assistance income", "unemployment insurance benefits")

euromod <- as.data.frame(t(euromod))

total_benefits <- as.data.frame(t(total_benefits))
total_benefits <- cbind(total_benefits, euromod)

colnames(total_benefits) <- c("BLISS", "EU-SILC", "Administrative Data")

total_benefits$`BLISS/EU-SILC`<-round(total_benefits$BLISS/ total_benefits$`EU-SILC`, digits = 2)

total_benefits$`BLISS/Administrative Data`<- round(total_benefits$BLISS/ total_benefits$`Administrative Data`, digits = 2)

kable(total_benefits, "latex", booktabs = T, caption = "Aggregate Household Income by Data (2013 Bulgarian leva, millions)", linesep = "", align = "c")  %>%
  kable_styling(position = "center")  %>% 
  add_header_above(c(" " = 1, "Aggregate Income" = 3, "Ratios" = 2)) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"))  %>% 
  footnote(general = "All monetary units are in millions of 2013 Bulgarian leva. For the administrative data and the EU-SILC, families are the unit of observation for infant and child benefits while social assistance and heating allowance recipiency is reported on the household level.", threeparttable = T, footnote_as_chunk = T) 
```

Table 1 displays aggregate household income by data source. Both the BLISS and the EU-SILC have quite similar results. In terms of annual heating allowances, the EU-SILC and the BLISS survey produce aggregate estimates of 37 and 35 million leva. For heating, child, and infant benefits very similar aggregate estimates are shared between these two surveys, with BLISS estimates between 1.04 and 1.10 times greater than the EU-SILC. 

However, these two surveys perform poorly relative to the administrative data. This phenomena is shared with many surveys that attempt to be representative. The aggregate income predicted by the BLISS is frequently less than half that of the administrative data. This is often the case because of under-reporting. 

```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

total_recipients <- list()

#1) household heating allowance
total_recipients$`heating allowance` <- sum(ifelse(hh_inc_1$`heating allowance`!= 0, 1, 0)*hh_inc_1$HH_weight)
  
#2) individuals employed
total_recipients$`individuals employed` <- NA

#3) total pensions
total_recipients$`pension` <- NA

#4) household monthly value of infant benefits
total_recipients$`infant benefits` <- sum(ifelse(hh_inc_5$`household infant benefits`!= 0, 1, 0)*hh_inc_5$HH_weight)

#5) household monthly value of child benefits
total_recipients$`total child benefits` <- sum(ifelse(hh_inc_6$`household child benefits`!= 0, 1, 0)*hh_inc_6$HH_weight)

#6) household monthly value of social assistance
total_recipients$`unemployment insurance` <- NA

#7) household monthly value of social assistance
total_recipients$`social assistance` <- sum(ifelse(hh_inc_7$`household social assistance income`!= 0, 1, 0)*hh_inc_7$HH_weight) 
  
total_recipients <- as.data.frame(total_recipients)/1000
total_recipients <- round(total_recipients)

colnames(total_recipients) <- c("households receiving heating allowances", "individuals employed", "households receiving pensions", "households receiving infant benefits", "households receiving child benefits", "individuals receiving unemployment insurance benefits", "households receiving social assistance income")


eu_silc = c(35, 2930, 2967, 38, 344, 18, 201)
external = c(75, 2935, 2670, 62, 537, 50, 117)  

#Monthly child benefits (for children under 18 years, or 20 if in school)	
#I assume this refers to means tested child benefit


#Infant benefits (for children under 1 year, or 2 years if disabled)	
  
euromod_recipients <- t( data.frame(eu_silc, external))

colnames(euromod_recipients) <- c("households receiving heating allowances", "individuals employed", "households receiving pensions", "households receiving infant benefits", "households receiving child benefits", "individuals receiving unemployment insurance benefits", "households receiving social assistance income")

euromod_recipients <- as.data.frame(t(euromod_recipients))

total_recipients <- as.data.frame(t(total_recipients))
total_recipients <- cbind(total_recipients, euromod_recipients)

colnames(total_recipients) <- c("BLISS", "EU-SILC", "Administrative Data")

total_recipients$`BLISS/EU-SILC`<- round(total_recipients$BLISS/ total_recipients$`EU-SILC`, digits = 2)

total_recipients$`BLISS/Administrative Data`<-round(total_recipients$BLISS/ total_recipients$`Administrative Data`, digits = 2)


kable(total_recipients, "latex", booktabs = T, caption = "Total recipients in thousands by survey and income source", linesep = "", align = "c")  %>%
  kable_styling(position = "center")  %>% 
  add_header_above(c(" " = 1, "Total Recipients" = 3, "Ratios" = 2)) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"))  %>% 
  footnote(general = "For the BLISS data, total recipients are restricted to households because this table is only concerned with the BLISS weighted at the household level. Given that the BLISS was designed to be representative at the household level, receipt of income which is accounted for by the survey at the individual level is not reported. For the administrative data and the EU-SILC, families are the unit of observation for infant and child benefits while social assistance and heating allowance recipiency is reported on the household level.", threeparttable = T, footnote_as_chunk = T) 
```

The same relationship seen in figure 1 is also seen in figure 2. Relative to the administrative data, both the BLISS data and the EU-SILC estimate sizeably different numbers of households seeing income from each source enumerated. However, it is unambiguously the case that the BLISS performs worse than the EU-SILC. However, this poor performance is likely a result of the weights that the survey uses, rather than a factor that will introduce sizable bias. The main concern for our purposes is whether the bias introduced by sampling errors dramatically varies by ethnic group. 

```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

## Household sample `household weights` employed to display monthly total income, pension income, and government transfer income by total household income deciles. 
##----------------------------------------------------------

#Find weighted household total income deciles. 
weighted_hh_data<-svydesign(id=~1, weights=~hh_data$HH_weight, data=hh_data)

#Create deciles
dt_quantile = svyquantile(~`total net monthly household income`, design = weighted_hh_data, quantiles = seq(.1, 1, by=0.1), method = "linear", ties="rounded")

#Change direction of the table (wide to long)
dt_quantile = data.table(t(dt_quantile), keep.rownames = T)

dt_quartile_unweighted <- quantile(hh_data$`total net monthly household income`, prob = seq(0, 1, length = 11), type = 5)
dt_quartile_unweighted <- as.data.frame(dt_quartile_unweighted)

dt_quartile_unweighted <- quantile(hh_data$`total net monthly household income`, prob = seq(0, 1, length = 11), type = 5)
dt_quartile_unweighted <- as.data.frame(dt_quartile_unweighted)

dt_quartile_unweighted_roma <- quantile(subset(hh_data$`total net monthly household income`, hh_data$ethnic_group=="Roma"), prob = seq(0, 1, length = 11), type = 5)
dt_quartile_unweighted_roma <- as.data.frame(dt_quartile_unweighted_roma)

dt_quartile_unweighted_bg <- quantile(subset(hh_data$`total net monthly household income`, hh_data$ethnic_group=="Bulgarian"), prob = seq(0, 1, length = 11), type = 5)
dt_quartile_unweighted_bg <- as.data.frame(dt_quartile_unweighted_bg)

## Compare weighted household survey data with European Union Statistics on Income and Living Conditions (EU-SILC). 
#-----------------------------------------------------------

#Import data from the 2013 EU-SILC and EUROMOD on the household income by total income decile.
#Data can be found here: https://www.euromod.ac.uk/sites/default/files/statistics/WebStatistics_G3.0%2B_HHIncome_v2.xls

p = c(1,2,3,4,5,6,7,8,9,10)
n = c(360.6, 470.0, 646.9, 825.6, 1023.3, 1220.7, 1407.2, 1619.0, 2043.3, 3411.1)
EU_SILC = data.frame(p,n)

deciles <- cbind(EU_SILC, dt_quantile[,2], dt_quartile_unweighted[2:11,1], dt_quartile_unweighted_roma[2:11,1],  dt_quartile_unweighted_bg[2:11,1])
colnames(deciles) <- c("Decile","EU-SILC", "Weighted BLISS", "Complete Sample", "Roma", "Bulgarians")

rm(EU_SILC, dt_quantile, dt_quartile_unweighted, dt_quartile_unweighted_roma, dt_quartile_unweighted_bg)

#-------------------------------------
#The table below compares the weighted BLISS survey data and data from one of the most widely respected representative surveys, the European Union Statistics on Income and Living Conditions (EU-SILC). Differences in the government benefits between the two data likely are due to the Euromod that is being relied upon to impute government benefit information. Otherwise, though, the BLISS data seems to very much underestimate household income data. The likely reason for this is that far fewer households were sampled than in the EU-SILC per geographic region. In turn, the survey may 


### Table
#-------------------------------------
#Combined the two tables, the weighted data from the BLISS Survey and the data from the EU-SILC/Euromod, and compare. 
#Source: https://www.euromod.ac.uk/sites/default/files/statistics/WebStatistics_G3.0%2B_HHIncome_v2.xls 

kable(round(deciles), "latex", booktabs = T, caption = "Total net monthly household income deciles by survey", linesep = "", align = "c")  %>%
  kable_styling(position = "center")  %>% 
  kable_styling(latex_options = c("scale_down", "hold_position")) %>% 
  add_header_above(c(" " = 3, "Unweighted BLISS" = 3))  %>% 
  footnote(general = "All figures are reported as 2013 Bulgarian leva. The EU-SILC data was reported in 2013 Euros and was appropriately converted to 2013 leva. The BLISS data reports total monthly household net income, while the EU-SILC data reports total monthly average disposable household income.", threeparttable = T, footnote_as_chunk = T)

```

Table 3 is able to address this question by looking at net monthly household income deciles by survey and by ethnic group. While the EU-SILC clearly reports higher incomes than the BLISS, these lower incomes hold for both Roma and ethnic Bulgarians. Table 3 can be read as evidence that the mechanisms that introduced errors into the BLISS survey and pushed down income have affected the two predominant ethnic groups of interest in very similar ways. Otherwise stated, table 3 suggests that the income information of both ethnic groups have been biased similarly. 



```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

dt_quartile_1 <- quantile(subset(hh_data$`total net monthly household income`, hh_data$`Booster or Main Sample`== "Booster sample" & hh_data$ethnic_group == "Roma"), prob = seq(0, 1, length = 6), type = 5)
dt_quartile_1 <- as.data.frame(dt_quartile_1)

dt_quartile_2 <- quantile(subset(hh_data$`total net monthly household income`, hh_data$`Booster or Main Sample`== "Main sample" & hh_data$ethnic_group == "Roma"), prob = seq(0, 1, length = 6), type = 5)
dt_quartile_2 <- as.data.frame(dt_quartile_2)

dt_quartile_3 <- quantile(subset(hh_data$`total net monthly household income`, hh_data$ethnic_group == "Roma"), prob = seq(0, 1, length = 6), type = 5)
dt_quartile_3 <- as.data.frame(dt_quartile_3)

dt_quartile_4 <- quantile(subset(hh_data$`total net monthly household income`, hh_data$`Booster or Main Sample`== "Booster sample" & hh_data$ethnic_group == "Turkish"), prob = seq(0, 1, length = 6), type = 5)
dt_quartile_4 <- as.data.frame(dt_quartile_4)

dt_quartile_5 <- quantile(subset(hh_data$`total net monthly household income`, hh_data$`Booster or Main Sample`== "Main sample" & hh_data$ethnic_group == "Turkish"), prob = seq(0, 1, length = 6), type = 5)
dt_quartile_5 <- as.data.frame(dt_quartile_5)

dt_quartile_6 <- quantile(subset(hh_data$`total net monthly household income`, hh_data$ethnic_group == "Turkish"), prob = seq(0, 1, length = 6), type = 5)
dt_quartile_6 <- as.data.frame(dt_quartile_6)

dt_quartile_7 <- quantile(subset(hh_data$`total net monthly household income`, hh_data$ethnic_group == "Bulgarian"), prob = seq(0, 1, length = 6), type = 5)
dt_quartile_7 <- as.data.frame(dt_quartile_7)

quartiles <- cbind(dt_quartile_7, dt_quartile_6, dt_quartile_3, dt_quartile_5, dt_quartile_2, dt_quartile_4, dt_quartile_1)
colnames(quartiles) <- c("Bulgarian", "Turkish", "Roma", "Turkish", "Roma", "Turkish", "Roma")


kable(round(quartiles[2:6,]), "latex", booktabs = T, caption = "Net household income quintiles by survey and sample group", linesep = "", align = "l")  %>%
  kable_styling(position = "center")  %>% 
  kable_styling(latex_options = c("scale_down", "hold_position")) %>%
  add_header_above(c(" " = 1, "Complete sample" = 3, "Main sample" = 2, "Booster sample" = 2)) %>%
  footnote(general = "Incomes are reported in 2013 Bulgarian leva. Observations included in the booster sample come from neighborhoods and communities that are ethnically segregated. While observations in the 'main sample' do not come from such segregated communities. Any social consequences or characteristics associated with segregated neighborhoods should dominate in the booster sample.", threeparttable = T, footnote_as_chunk = T) 
```

Table 3 and table 4 both show that ethnic minorities in Bulgaria see substantially smaller net household income than ethnic Bulgarians. As is clear from table 4, the net household income for Turkish households is even markedly lower than survey respondents who identify as Roma. Despite having a higher status in Bulgaria, Turks see lower incomes. 

A complex feature of ethnic identity in Bulgaria is the fact that many who identify as Turkish are seen and treated as Roma by the majority of Bulgarians. In addition to families identifying as Turkish to elevate and escape prejudice, Maru\v{s}iakova and Popov (2000) shows that the line between these ethnic identities are often blurred. Therefore, for much of the analysis done in this paper, Roma, Turks, and other minorities will be grouped together as ethnic minorities. 


\newpage

```{r message=FALSE, warning=FALSE, echo=FALSE, results = "hide"}

#SET-UP: Create additional variables for regressions and survey design
#-----------------------------------------------------
#Ethnic Minority - 21.77 percent of the sample
  #unweighted
  combined_data$ethnic_minority <- ifelse(combined_data$ethnic_group!="Bulgarian", 1, 0)

  #Weighted
  combined_data_weighted$variables$ethnic_minority <- ifelse(combined_data_weighted$variables$ethnic_group!="Bulgarian", 1, 0)

#Education numeric
  #Unweighted
  combined_data$Education_numeric <- as.numeric(combined_data$Education)
  combined_data$Education_numeric[is.na(combined_data$Education_numeric)] <- 0 

  #Weighted
  combined_data_weighted$variables$Education_numeric <- as.numeric(combined_data_weighted$variables$Education)
  combined_data_weighted$variables$Education_numeric[is.na(combined_data_weighted$variables$Education_numeric)] <- 0

#Region numeric
  #Unweighted
  combined_data$region_numeric <- as.numeric(combined_data$Region)
  combined_data$region_numeric[is.na(combined_data$region_numeric)] <- 0 

  #Weighted
  combined_data_weighted$variables$region_numeric <- as.numeric(combined_data_weighted$variables$Region)
  combined_data_weighted$variables$region_numeric[is.na(combined_data_weighted$variables$Region)] <- 0 

#Public assistance income
combined_data$`public assistance income` <- combined_data$`annual value of child benefits`+combined_data$`annual value of infant benefits`+combined_data$`annual value of social assistance`+combined_data$`annual value of heating allowance`
  
#Survey Design
dstrat<-svydesign(id=~1, weights=~`household weights`, data=combined_data_weighted$variables)
```

## Distribution of incomes for weighted and unweighted samples

Figure 2 displays the distribution of mean monthly average net wages by ethnic group and by their samples both weighted and unweighted. The data presented in this figure only accounts of observations with positive wages. The mean and standard deviation are the same for both the weighted and unweighted samples. 

```{r fig.cap = "Mean monthly average net wages by ethnic group by weighted and unweighted samples",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

#sd - un_weighted
plot1 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group)) ), aes(x=`ethnic_group`, y=`monthly average net wages`)) +
  stat_summary(fun.y="sd", geom="bar") + 
  labs(title = "Standard deviation without sample weights", y=NULL, x = NULL) + 
  theme_minimal() 

#sd - weighted
plot2 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group))), aes(x=`ethnic_group`, y=`monthly average net wages`, weight = `household weights`)) +
  stat_summary(fun.y="sd", geom="bar") + 
  labs(title = "Standard deviation with sample weights", y=NULL, x = NULL) + 
  theme_minimal()

#mean - un_weighted
plot3 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group))), aes(x=`ethnic_group`, y=`monthly average net wages`)) + 
  stat_summary(fun.y="mean", geom="bar") + 
  labs(title = "Mean without sample weights", y=NULL, x = NULL) + 
  theme_minimal() 

#mean - weighted
plot4 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group))), aes(x=`ethnic_group`, y=`monthly average net wages`, weight = `household weights`)) + 
  stat_summary(fun.y="mean", geom="bar") + 
  labs(title = "Mean with sample weights", y=NULL, x = NULL) + 
  theme_minimal() 

grid.arrange(
  plot1,
  plot2,
  plot3,
  plot4,
  nrow = 2,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 8),
    hjust = 1,
    x = 1
  )
)
```


\newpage

### Monthly average net wages 

As with figure 2, where the mean wage of minorities is clearly less than ethnic Bulgarians, figure 3 and 4 are able to more clearly communicate the extent to which the income distribution is shifted upward for ethnic Bulgarians relative to Turks and Roma. 

```{r fig.cap = "Monthly average net wages for households with positive incomes by weighted and unweighted sample",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}


ethnic_group_weights <- hh_data %>%
  group_by(ethnic_group)  %>%
  summarise(ethnic_group_weights = sum(`household weights`))

hh_data <- hh_data %>%
  left_join(ethnic_group_weights, by = "ethnic_group")



### ------ Roma ------
plot1 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group)) &  hh_data$ethnic_group == "Roma" ), aes(x=`ethnic_group`, y=`monthly average net wages`)) + labs(title = "Without household sample weights", x = "Ethnic groups" ) +geom_violin(alpha=0.5, color="gray") + ylim(1, 3000) +geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))+coord_flip()
  
plot2 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group) &  hh_data$ethnic_group == "Roma")), aes(x=ethnic_group, y=`monthly average net wages`, weights = `household weights`)) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + coord_flip() + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))

### ------ Turkish ------
plot3 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group)) &  hh_data$ethnic_group == "Turkish" ), aes(x=`ethnic_group`, y=`monthly average net wages`)) + labs(title = "Without household sample weights", x = "Ethnic groups" ) +geom_violin(alpha=0.5, color="gray") + ylim(1, 3000) +geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))+coord_flip()
  
plot4 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group) &  hh_data$ethnic_group == "Turkish")), aes(x=ethnic_group, y=`monthly average net wages`, weights = `household weights`)) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + coord_flip() + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))

### ------ Other ------
plot5 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group)) &  hh_data$ethnic_group == "Other" ), aes(x=`ethnic_group`, y=`monthly average net wages`)) + labs(title = "Without household sample weights", x = "Ethnic groups" ) +geom_violin(alpha=0.5, color="gray") + ylim(1, 3000) +geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))+coord_flip()
  
plot6 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group) &  hh_data$ethnic_group == "Other")), aes(x=ethnic_group, y=`monthly average net wages`, weights = `household weights`)) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + coord_flip() + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))

### ------ Bulgarian ------
plot7 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group)) &  hh_data$ethnic_group == "Bulgarian" ), aes(x=`ethnic_group`, y=`monthly average net wages`)) + labs(title = "Without household sample weights", x = "Ethnic groups" ) +geom_violin(alpha=0.5, color="gray") + ylim(1, 3000) +geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))+coord_flip()
  
plot8 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group) &  hh_data$ethnic_group == "Bulgarian")), aes(x=ethnic_group, y=`monthly average net wages`, weights = `household weights`)) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + coord_flip() + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))

grid.arrange(
  plot1,
  plot2,
  plot3,
  plot4,
  plot5,
  plot6,
  plot7,
  plot8,
  nrow = 4,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 8),
    hjust = 1,
    x = 1
  )
)
```

For all ethnic groups, the distribution of wage income presents a left-skew as always the case with distribution of income in market economies. However, for both Turks and Roma there is a sizablely larger group concentrated at the low end of the wage distribution and fewer resting at the top. 

```{r fig.cap = "Distribution of monthly average net wages with household weights", message=FALSE, warning=FALSE, echo = FALSE, results="asis"}

plot1 <- ggplot(subset(combined_data, combined_data$ethnic_group=="Bulgarian" & combined_data$`monthly average net wages` >0 ), aes(x=`monthly average net wages`,weights=`household weights`/sum(`household weights`))) + 
  geom_density() + 
    xlim(0, 2000) +
  theme( axis.title.x = element_text(size = 8)) + 
  theme_minimal() + 
  labs(title = "Bulgarian", y = NULL, x = NULL)  

plot2 <- ggplot(subset(combined_data, combined_data$ethnic_group=="Other" & combined_data$`monthly average net wages` >0 ), aes(x=`monthly average net wages`,weights= `household weights`/sum(`household weights`))) + 
  geom_density() + 
    xlim(0, 2000) +
  theme( axis.title.x = element_text(size = 8)) + 
  theme_minimal() + 
  labs(title = "Other", y = NULL, x = NULL) 

plot3 <- ggplot(subset(combined_data, combined_data$ethnic_group=="Roma" & combined_data$`monthly average net wages` >0 ), aes(x=`monthly average net wages`,weights=`household weights`/sum(`household weights`))) + 
  geom_density() + 
    xlim(0, 2000) +
  theme( axis.title.x = element_text(size = 8)) + 
  theme_minimal() + 
  labs(title = "Roma", y = NULL, x = NULL) 

plot4 <- ggplot(subset(combined_data, combined_data$ethnic_group=="Turkish" & combined_data$`monthly average net wages` >0 ), aes(x=`monthly average net wages`,weights=`household weights`/sum(`household weights`))) + 
  geom_density() + 
    xlim(0, 2000) +
  theme( axis.title.x = element_text(size = 8)) + 
  theme_minimal() + 
  labs(title = "Turkish", y = NULL, x = NULL)  


grid.arrange(
  plot1,
  plot2,
  plot3,
  plot4,
  nrow = 2,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 8),
    hjust = 1,
    x = 1
  )
)

```


\newpage 

### Total net monthly household income

The extent to which ethnic minorities are concentrated lower on the distribution is even more aparent when looking at the distribution of net total monthly household income in figure 5. In this figure, household income is strikingly less for ethnic minorities and to a greater degree than wage inequality between ethnic groups would suggest. This is likely the result of low levels of female labor force participation and lower levels of employment, generally, amongst ethnic minorities. 

```{r fig.cap = "Distribution of total net household public assistance income for household with positive public assistance income. Household weights have been applied.",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

plot1 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group)) & ethnic_group == "Bulgarian"), mapping = aes(x=ethnic_group, y=`total net monthly household income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

plot2 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group)) & ethnic_group == "Roma"), mapping = aes(x=ethnic_group, y=`total net monthly household income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

plot3 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group)) & ethnic_group == "Turkish"), mapping = aes(x=ethnic_group, y=`total net monthly household income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

plot4 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group)) & ethnic_group == "Other"), mapping = aes(x=ethnic_group, y=`total net monthly household income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

grid.arrange(
  plot1,
  plot2,
  plot3,
  plot4,
  nrow = 4,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 8),
    hjust = 1,
    x = 1
  )
)
```
 
\newpage 
### Public Assistance Income

Figure 6 looks at the distribution of government transfer or public assistance income (social assistance, heating allowance, child, and infant benefits) for household’s with positive transfer income. As is clear, Roma and Turkish households quite clearly see income from such government benefits more frequently than Bulgarian households, but the distribution is quite similar between ethnic groups. The fact that household public assistance is distributed around 700 leva for all ethnic groups, stands against the widespread notion in Bulgaria that minorities utilize the public assistance system unfairly. 

```{r fig.cap = "Distribution of net monthly income with household weights",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

plot1 <- ggplot(subset(combined_data,(!is.na(combined_data$ethnic_group)) & ethnic_group == "Bulgarian"), mapping = aes(x=ethnic_group, y=`public assistance income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 1500) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

plot2 <- ggplot(subset(combined_data
,(!is.na(combined_data$ethnic_group)) & ethnic_group == "Roma"), mapping = aes(x=ethnic_group, y=`public assistance income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 1500) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

plot3 <- ggplot(subset(combined_data
,(!is.na(combined_data$ethnic_group)) & ethnic_group == "Turkish"), mapping = aes(x=ethnic_group, y=`public assistance income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 1500) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

plot4 <- ggplot(subset(combined_data
,(!is.na(combined_data$ethnic_group)) & ethnic_group == "Other"), mapping = aes(x=ethnic_group, y=`public assistance income`, weights = `household weights`)) + 
  labs(title = NULL , y =NULL, x = NULL) + 
  ylim(1, 1500) + geom_violin(alpha=0.5, color="gray") + 
  geom_jitter(alpha=0.05, aes(ethnic_group), position = position_jitter(width = 0.05)) +
  coord_flip() + 
  theme_minimal()

grid.arrange(
  plot1,
  plot2,
  plot3,
  plot4,
  nrow = 4,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 8),
    hjust = 1,
    x = 1
  )
)
```

\newpage
## Education and standarized test results

Given that education quality may differ between ethnic groups and across the whole population, the BLISS asked a random sample of adult respondents to take a standarized numeracy and literacy test. Figure 7 shows that there is clearly a strong positive relationship between mean numeracy score and one's level of education. This suggests that this measure of numeracy may be a useful measure of cognitive skills generally that may be able to overcome heterogeneity in school quality.

```{r fig.cap = "Mean numeracy score by education level",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}
  
ggplot(aes(x = Education, y = Numeracy), data = combined_data) + stat_summary(fun.y = "mean", geom = "bar") + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + theme_hc()+ scale_colour_hc()
```

A simple OLS estimation of the effect of education on numeracy and literacy test results also confirms this relationship implying the strength of these tests as measure of labor market relevant skills. 

\newpage 
```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

stargazer(lm(Numeracy ~ Education, combined_data), lm(Literacy ~ Education, combined_data), title="OLS estimates: Educational attainment on standarized test score", covariate.labels=c("initial", "primary", "secondary", "bachelor's", "master's", "PhD", "Constant"), header=FALSE)
```

Figure 8 display a box-plot for all ethnic groups by monthly average net wages by their highest level of education. For nearly all levels of education, Turks and Roma see lower earnings. But as would be predicted and as the OLS model estimated previously confirmed, higher education is associated with higher wages. This figure, confirms that increasing education levels amongst Roma and Turks may serve as a mechanism to foster economic inequality. However, other policy options are needed in order to guarantee that the returns to educations are the same for all ethnic groups. 

```{r fig.cap = "Monthly average net wages by education level for those with positive earnings", fig.width=5, fig.height=7, message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

#Monthly wages by highest level of education for those reporting wages greater than 0
plot1 <- ggplot(subset(combined_data, ethnic_group=="Roma"), aes(x =Education, y=`monthly average net wages`)) + labs(title = "Roma") + ylim(1, 2300) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot2 <- ggplot(subset(combined_data, ethnic_group=="Bulgarian"), aes(x =Education, y=`monthly average net wages`)) + labs(title = "Bulgarian") + geom_boxplot() + ylim(1, 2300) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot3 <- ggplot(subset(combined_data, ethnic_group=="Turkish"), aes(x =Education, y=`monthly average net wages`)) + labs(title = "Turkish") + ylim(1, 2300) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  plot3,
  nrow = 3,
  bottom = textGrob(
    "2013 Bulgarian Leva. Unweighted sample. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 5),
    hjust = 1,
    x = 1
  )
)
```

## Segregation 

Lastly, figure 9, presented here,  differentiates monthly net household income by ethnicity and sample type. This figure sheds light on the potential negative effect of neighborhood segregation on income. Households from the main sample are households living in non-ethnically segregated communities, while those from the booster sample do live in segregated communities. While Roma households in segregated communities, see lower household incomes on average relative to non-segregated households, this relationship is more muted for Turkish households. This figure suggests that there is some ambiguity as to whether there is a segregation effect at play. Later in this paper, the question of whether a segregation effect plays a prominent role in driving 
heterogeneity within ethnic minorities is closely examined. 

```{r fig.cap = "Monthly net household income by ethnicity and sample type with household sample weights",fig.width=5, fig.height=4, message=FALSE, warning=FALSE, echo = FALSE, results = "asis"}

plot1 <- ggplot(subset(hh_data, ethnic_group=="Roma"), aes(x =`Booster or Main Sample`, y=`total net monthly household income`)) + labs(title = "Roma") + ylim(1, 2700) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot(aes(weight=(`household weights`/sum(`household weights`)))) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot2 <- ggplot(subset(combined_data, ethnic_group=="Turkish"), aes(x =`Booster or Main Sample`, y=`total net monthly household income`)) + labs(title = "Turkish") + ylim(1, 2700) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot(aes(weight=(`household weights`/sum(`household weights`)))) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

plot3 <- ggplot(subset(combined_data, ethnic_group=="Other"), aes(x =`Booster or Main Sample`, y=`total net monthly household income`)) + labs(title = "Other") + ylim(1, 2700) + theme(axis.text.x = element_text(angle = 60, hjust = 1))  + geom_boxplot(aes(weight=(`household weights`/sum(`household weights`)))) + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

grid.arrange(
  plot1,
  plot2,
  plot3,
  nrow = 1,
  bottom = textGrob(
    "2013 Bulgarian Leva. Weighted sample. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 8),
    hjust = 1,
    x = 1
  )
)
```


#Methodology

In order to understand the sources of economic inequality between Bulgaria's ethnic minorities and ethnic Bulgarians this paper seeks to decompose the factors that accounts for such inequalities by employing two empirical methods: a log-linear model and a Blinder-Oaxaca Decomposition. These empirical methods seek to explain ethnic inequality along three distinct dependent variables: 1) average net monthly wages (i.e. earned income), 2) total annual net household income, and 3) total annual household social assistance income, which is defined as total household income from the low-income social assistance program, the low-income monthly heating allowance, and the cash benefits for children and infants.^[The respective identifiers provided for these variables in the World Bank data dictionary for the BLISS 2013 are as follows: M2_Q16_perYear (average net wages per year), M10_Q19 (total net monthly household income), M5A_Q4_11 (monthly social assistance income), M5A_Q5_11 (monthly heating allowance), M5A_Q2_11 (monthly child benefits), and M5A_Q3_11 (monthly infant benefits).]

One chief aim of this paper is to decompose the role of endowment factors -- i.e. observables relevant to economic outcomes like education and family composistion -- on economic differences between ethnic groups and the role of residential segregation. Otherwise stated, this paper seeks to estimate the impact of differences in relevant economic characteristics, such as educational attainment, family composition, and residential segregation, on inequalities of earnings, net household income, and government transfer income. Through decomposing the role of observable factors, the potential role of more opaque and unobservable forces, such as labor market discrimination and structural discrminiation, can be better understood and estimated. In the three subsections enumerated below, these three distinct empirical strategies used to explore ethnic inequality in Bulgaria are outlined. 

## Log-linear Approach

Below is the explicit functional form of the log-linear models estimated for the three depedent variables in question.  For each dependent variable, three models are estimated: 1) One model of the form below but without the segregation term, 2) another model with the segregation term, and 3) a third model that combines all ethnic groups into one independent variable. For each model an array of relevant economic characteristics are controlled for. In total nine log-linear model are estimated.
<!-- --> 
$$
{\scriptsize{ln(income_i)= \beta_0 + \: \beta_1 Roma_i \: + \: \beta_2 Turk_i \: + \: \beta_3 Non-Segregated_i \: + \: X_i^T \gamma \: + \:\epsilon_{i}}}
$$ 
<!-- --> 

## Blinder-Oaxaca Decomposition

Through a threeway Blinder-Oaxaca decomposition, the relative impact of education, region, family size, and other characteristics on income disparities between ethnic minorities and ethnic Bulgarians can be ascertained. Of even more importance, a Blinder-Oaxaca decomposition can provide strong evidence for the extent to which economic inequality between ethnic groups is due to structural and employment discrimination. 

In the immediate subsections below, the explicit form of the Blinder-Oaxaca decomposition is presented. For sake of simplicity, the explicit form is presented for a general dependent variable termed income. As is done in the analysis below, all ethnic minorities are grouped together.

The Blinder-Oaxaca decomposition is based off of two linear regression models:
<!-- --> 
$$
\small
{\begin{aligned} (1)\qquad \:{\text{income}}_{Minorities_{i}}&= \beta_1 Region_{Minorities_{i}} + ... + x_{Minorities_{i}}^T \gamma+\epsilon_{Minorities_{i}} \\ (2)\qquad {\text{income}}_{ Bulgarians_{i}} & = \beta_1 Region_{\: Bulgarians_{i}}  + ... +  x_{ Bulgarians_{i}}^T \gamma+\epsilon_{ Bulgarians_{i}} \end{aligned}}
$$
<!-- --> 
The fitted values from these two linear models are subtracted from one another as follows:
<!-- --> 
$$
\small{\begin{aligned} (3)\qquad & \; \overline{\text{income}}_{Bulgarians} \; -  \; \overline{\text{income}}_{Minorities} \; = \overline{ X}_{Bulgarians} \; \hat \beta^T_{Bulgarians} - \overline{ X}_{Minorities} \; \hat \beta^T_{Minorities} \end{aligned}}
$$
<!-- --> 
From here equation 3 can be further decomposed into the portions of the difference in mean income that results from differences in a) endowments, b) coefficients, and c) the interaction of the two. 
<!-- --> 

a) Endowments: These are differences in observable and relevant characteristics, like one's level of education, age, and the region in which they live, that explain the gap in income between ethnic minorities and ethnic Bulgarians.
<!-- --> 
$$
{\begin{aligned} (a)\qquad & \hat{\boldsymbol{\beta^T}}_{Bulgarians} ( \overline{X}_{Bulgarians} - \overline{X}_{Minorities} )\end{aligned}}
$$
<!-- --> 
b) Coefficients: This component of the three-way Blinder-Oaxaca decomposition expresses the gap that is not explained by observable. For the same observable, such as for the same level of education, the coefficients term expresses how this observable is related to different economic outcomes based on which group one belongs to. For example, if for the same level of education, ethnic-Bulgarians typically saw higher incomes, the coefficient term would pick-up this difference in how the same endowment may see different economic consequences. Typically in the literature, this portion of the Blinder-Oaxaca decomposition is considered as an estimate of the role of discrimination. 
<!-- --> 
$$
{\begin{aligned}(b)\qquad & \overline{\textbf{X}^T}_{Minorities} (\space \hat{\boldsymbol{\beta}}_{Bulgarians} - \hat{\boldsymbol{\beta}}_{Minorities}) \end{aligned}} 
$$
<!-- --> 
c) Interactions: Lastly, this term identifies the portion of the gap that is due to the multiplicative effect of differences in endowments and differences in the economic returns on those endowments. To continue with the example that regards education, if ethnic minorities generally saw lower returns to education and lower levels of education, this term would estimate that multiplicative effect.
<!-- --> 
$$
{\begin{aligned} (b)\qquad & (\overline{ X}_{Bulgarians} - \overline{ X}_{Minorities})^T (\space \hat{\boldsymbol{\beta}}_{Bulgarians} - \hat{\boldsymbol{\beta}}_{Minorities}) \end{aligned}}
$$
<!-- --> 



#Results 

## Estimated Log-Linear Models 

Presented below in table 5 are nine models; three models attempt to explain monthly average net wages, three explain net monthly household income, and the final three models seek to explain public assistance. For all three types of models, the population is restricted to households and individuals that see positive incomes from the dependent variables being estimated (e.g. only those who saw wage income are included in the sample population for the first three models). In all nine models, the dependent variable is log transformed; this step was taken in response to the standard right skew that income distributions typically take. 

```{r, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}


#--------------------------------
#Unweighted - wage

summary(model1 <- lm(log(`monthly average net wages`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group , data = combined_data, `monthly average net wages`>0))

summary(model2 <- lm(log(`monthly average net wages`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group +`Booster or Main Sample`, data = combined_data, `monthly average net wages`>0))

summary(model3 <- lm(log(`monthly average net wages`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + `Booster or Main Sample` + ethnic_minority, data = combined_data, `monthly average net wages`>0))

#--------------------------------
#Unweighted - household inc

summary(model4 <- lm(log(`total net monthly household income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group , data = combined_data, `total net monthly household income`>0))

summary(model5 <- lm(log(`total net monthly household income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric  + ethnic_group + `Booster or Main Sample`, data = combined_data, `total net monthly household income`>0))

summary(model6 <- lm(log(`total net monthly household income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + `Booster or Main Sample` + ethnic_minority, data = combined_data, `total net monthly household income`>0))

#--------------------------------
#Unweighted - public assistance

summary(model7 <- lm(log(`public assistance income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group, data = combined_data, `public assistance income`>0))

summary(model8 <- lm(log(`public assistance income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group + `Booster or Main Sample`, data = combined_data, `public assistance income`>0))

summary(model9 <- lm(log(`public assistance income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + `Booster or Main Sample` + ethnic_minority, data = combined_data, `public assistance income`>0))

```

```{r message=FALSE, warning=FALSE, echo = FALSE, results = "hide"}

resizebox.stargazer = function(..., tab.width = "!", tab.height = "!"
                               ){
  #Activate str_which() function:
  require(stringr) 

  #Extract the code returned from stargazer()
  res = capture.output(
    stargazer::stargazer(...)
    )

  #Render the arguments:
  tab.width = tab.width
  tab.height = tab.height

  #Attach "}" between \end{tabular} and \end{table}
  res = 
    prepend(res, "}", before = length(res))

  #Input \resizebox before \begin{tabular}
  res = 
    c(res[1:str_which(res, "^\\\\begin\\{tabular\\}.*")-1],
      paste0("\\resizebox{",tab.width,"}{",tab.height,"}{%"),
      res[str_which(res, "^\\\\begin\\{tabular\\}.*"):length(res)]
      )

  #Produce the whole strings
  cat(res, sep = "\n")
}

resizebox.stargazer(model1, model2, model3, model4, model5, model6, model7, model8, model9, no.space=TRUE,  title = "Log-Linear Regression Output", covariate.labels = c("Female", "No children under 20", "Education", "Age: 30 - 49", "Age: 50+", "Numeracy", "Literacy", "Semantics", "Region","Other Ethnic Minority", "Roma", "Turkish", "Non-Segregated", "Ethnic Minority"), align=TRUE, type = 'latex', float.env = "sidewaystable", header=FALSE, omit.stat=c("LL","ser","f"), tab.width = "1\\textwidth")
```

```{r, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
#--------------------------------
#Weighted - wage
summary(model1 <- lm(log(`monthly average net wages`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group , data = combined_data, `monthly average net wages`>0, weights = `individual weights with population adjustment`))

summary(model2 <- lm(log(`monthly average net wages`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group +`Booster or Main Sample`, data = combined_data, `monthly average net wages`>0,  weights = `individual weights with population adjustment`)) 

summary(model3 <- lm(log(`monthly average net wages`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + `Booster or Main Sample` + ethnic_minority, data = combined_data, `monthly average net wages`>0,  weights = `individual weights with population adjustment`))

#--------------------------------
#Weighted - household inc

summary(model4 <- lm(log(`total net monthly household income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group , data = combined_data, `total net monthly household income`>0, weights = `individual weights with population adjustment`))

summary(model5 <- lm(log(`total net monthly household income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric  + ethnic_group + `Booster or Main Sample`, data = combined_data, `total net monthly household income`>0,  weights = `individual weights with population adjustment`))

summary(model6 <- lm(log(`total net monthly household income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + `Booster or Main Sample` + ethnic_minority, data = combined_data, `total net monthly household income`>0, weights = `individual weights with population adjustment`))

#--------------------------------
#Weighted - public assistance

summary(model7 <- lm(log(`public assistance income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group, data = combined_data, `public assistance income`>0, weights = `individual weights with population adjustment`))

summary(model8 <- lm(log(`public assistance income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + ethnic_group + `Booster or Main Sample`, data = combined_data, `public assistance income`>0, weights = `individual weights with population adjustment`))

summary(model9 <- lm(log(`public assistance income`) ~ `Sex: ` + `Household with children under 20? ` + Education_numeric + `Age: `+ Numeracy + Literacy + Semantics + region_numeric + `Booster or Main Sample` + ethnic_minority, data = combined_data, `public assistance income`>0, weights = `individual weights with population adjustment`))
```


```{r message=FALSE, warning=FALSE, echo = FALSE, results = "asis"}

resizebox.stargazer = function(..., tab.width = "!", tab.height = "!"
                               ){
  #Activate str_which() function:
  require(stringr) 

  #Extract the code returned from stargazer()
  res = capture.output(
    stargazer::stargazer(...)
    )

  #Render the arguments:
  tab.width = tab.width
  tab.height = tab.height

  #Attach "}" between \end{tabular} and \end{table}
  res = 
    prepend(res, "}", before = length(res))

  #Input \resizebox before \begin{tabular}
  res = 
    c(res[1:str_which(res, "^\\\\begin\\{tabular\\}.*")-1],
      paste0("\\resizebox{",tab.width,"}{",tab.height,"}{%"),
      res[str_which(res, "^\\\\begin\\{tabular\\}.*"):length(res)]
      )

  #Produce the whole strings
  cat(res, sep = "\n")
}

resizebox.stargazer(model1, model2, model3, model4, model5, model6, model7, model8, model9, no.space=TRUE,  title = "Log-Linear Regression Output", covariate.labels = c("Female", "No children under 20", "Education", "Age: 30 - 49", "Age: 50+", "Numeracy", "Literacy", "Semantics", "Region","Other Ethnic Minority", "Roma", "Turkish", "Non-Segregated", "Ethnic Minority"), align=TRUE, type = 'latex', float.env = "sidewaystable", header=FALSE, omit.stat=c("LL","ser","f"), tab.width = "1\\textwidth")
```

The regression output displayed in table 5 shows that despite controlling for a plethora of relevant economic factors that may be driving ethnic inequality, one's status as an ethnic minority decreases earned income and household income for observations with positive earnings and household income, respectively. Models 1 and 2 estimate that  relative to ethnic Bulgarians one's status as a Turk decreases wages amongst the employed by 15.9 and 18.8 percent, respectively. The analog figure for those who identify as Roma is 20.4 percent. 

As discussed, those who identify as Turks in Bulgaria are often identified and characterized as Roma by parties who are relevant in determining economic outcomes (e.g. employers, policy makers, etc.). Therefore, in place of including an independent variables for Roma, Turks, and other ethnic minorities, models 3, 6, and 9 merely contain a dummy variable for all ethnic minorities; such an approach may appropriately deal with a potentially artificial or non-relevant distinctions for the purposes here between different ethnic minorities in Bulgaria. 

As is the case when estimating Roma and Turks independently, after controlling for a host of economic relevant factors -- i.e. where one resides, whether one lives in an ethnically segregated neighborhood, one's level of education, family composition, standardized test scores, gender, and age -- ethnic minorities in Bulgaria are estimated to see lower earnings (-16.1 percent), lower household net income (-23.3 percent), and greater household public assistance income (+12.4 percent) relative to ethnic Bulgarians. These estimates are statistically significant at the 10 percent level, in the case of model 9, and the 1 percent level, in the case of models 3 and 6.  

The empirical approach taken here is not able to definitively uncover the mechanisms driving observed inequality along ethnic lines; it cannot determine the extent to which the statistically significant effect of one's ethnic minority status is the result of employment discrimination, structural discrimination, and other minority specific factors. However, the results obtained here do provide strong evidence that factors, that include employment discrimination, are responsible for depressing wages amongst employed Roma and Turks by potentially 20 percent relative to ethnic Bulgarians with the same relevant economic characteristics. Furthermore, one's ethnic status may depress total net household income by between 20 percent (Roma estimates from models 4 and 5) and nearly 50 percent (Turkish estimates from models 4 and 5). 

Likely due to lower wages earning and total net household income, public assistance income is estimated 35 percent higher amongst Turks and 17 percent for ethnic minorities as a whole than ethnic Bulgarians with comparable observable.  Additionally, living in an non-ethnically segregated neighborhood is not associated with public assistance income being higher than those who do not live in such neighborhoods. 


## Decomposition of the sources of inequality between ethnic minorities and ethnic-Bulgarians

The log-linear estimates in the previous section were able to show that inequality between ethnic groups in Bulgaria is clearly not a mere function of differing endowments, such as differing levels of education, numeracy, family structure, and other economically relevant observable. Rather, in the previous section the log-linear estimates obtained clearly maintained that one's minority status depressed wages, incomes, and increased public assistance income above and beyond what one's economic observable would predict. In this section a Blinder-Oaxaca Decomposition is employed to the estimate the extent to which different endowments explain ethnic economic inequality between ethnic groups and to further estimate the role that factors specific to one's ethnicity (e.g. discrimination) play in driving economic inequality. 

```{r, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

#----------------- Make variables numeric
combined_data$Sex <- as.numeric(combined_data$`Sex: `) 
combined_data$children <-as.numeric(combined_data$`Household with children under 20? `)
combined_data$Age <-as.numeric(combined_data$`Age: `)
combined_data$Segregated <- ifelse(combined_data$`Booster or Main Sample`=="Booster sample", 1, 0)
#unique(combined_data$Segregated)

#------------------ Blinder Oaxaca 
blinder_oaxaca_net_wages <- oaxaca ((`monthly average net wages`) ~ Sex + children + Education_numeric + Age + Numeracy + Literacy + Semantics | ethnic_minority, data = subset(combined_data, combined_data$`monthly average net wages`>0))

blinder_oaxaca_net_household_income <- oaxaca ((`total net monthly household income`) ~ Sex + children + Education_numeric + Age + Numeracy + Literacy + Semantics | ethnic_minority, data = subset(combined_data, combined_data$`total net monthly household income`>0))

blinder_oaxaca_public_assistance <- oaxaca ((`public assistance income`) ~ Sex + children + Education_numeric + Age + Numeracy + Literacy + Semantics | ethnic_minority, data = subset(combined_data, combined_data$`public assistance income`>0))

#------------------ Plots 

plota <- plot(blinder_oaxaca_net_wages, main= "Wage income", component.left = TRUE, group.weight = .5, variables = c("Sex", "children", "Education_numeric", "Age", "Numeracy", "Literacy"), variable.labels = c("Sex" = "Sex", "children"="Household w/ children", "Education_numeric"= "Education", "Age"="Age", "Numeracy"="Numeracy", "Literacy"="Literacy"), bar.color = c("limegreen", "hotpink", "steelblue"))

plotb <- plot(blinder_oaxaca_net_household_income, main= "Net household income", component.left = TRUE, group.weight = .5, variables = c("Sex", "children", "Education_numeric", "Age", "Numeracy", "Literacy"), variable.labels = c("Sex" = "Sex", "children"="Household w/ children", "Education_numeric"= "Education", "Age"="Age", "Numeracy"="Numeracy", "Literacy"="Literacy"), bar.color = c("limegreen", "hotpink", "steelblue"))

plotc <- plot(blinder_oaxaca_public_assistance, main= "Public assistance income", component.left = TRUE, group.weight = .5, variables = c("Sex", "children", "Education_numeric", "Age", "Numeracy", "Literacy"), variable.labels = c("Sex" = "Sex", "children"="Household w/ children", "Education_numeric"= "Education", "Age"="Age", "Numeracy"="Numeracy", "Literacy"="Literacy"), bar.color = c("limegreen", "hotpink", "steelblue"))
```


```{r, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
blinder_oaxaca_net_wages$y
blinder_oaxaca_net_wages$threefold$overall
blinder_oaxaca_net_wages$beta$beta.diff

blinder_oaxaca_net_household_income$threefold$overall
blinder_oaxaca_net_household_income$y

blinder_oaxaca_public_assistance$threefold$overall
blinder_oaxaca_public_assistance$y
```


```{r message=FALSE, warning=FALSE, echo = FALSE, results = "asis"}

#---- Kable Table
df <- as.data.frame( blinder_oaxaca_net_wages$threefold$overall)
df[,2] <- as.data.frame( blinder_oaxaca_net_household_income$threefold$overall)
df[,3] <- as.data.frame( blinder_oaxaca_public_assistance$threefold$overall)

colnames(df) <- c("Wage Income", "Household Income", "Public Assistance")

kable(df, "latex", booktabs = T, caption = "Threeway Decomposition by Ethnic Minorities and Ethnic Bulgarians", linesep = "", align = "l")  %>%
  kable_styling(position = "center")  %>% 
  kable_styling(latex_options = c("scale_down", "hold_position")) %>%
  footnote(general = "Incomes are reported in 2013 Bulgarian leva. ", threeparttable = T, footnote_as_chunk = T) 
```

The mean monthly difference in wages between the ethnic minorities and ethnic Bulgarians is 128 leva. The respective figures for net annual household income and annual income from public assistance is 428 leva and -619 leva. Table 7 displays the output of a three-way Blinder-Oaxaca decomposition that attempts to explain this differential in income. For all three decompositions, the gap that is explained by differences in endowments and the portion explained by differences in coefficients are statistically significant. 

The threefold decomposition estimated here suggests that, of the 128, 428, and -619 leva difference, roughly 42, 227, and -356 leva of this gap are the result of differences in endowments (e.g. age, gender, and education). Otherwise stated, the models here estimate that 33, 53, and 57 percent of the mean difference in wages, total household income, and social assistance income, respectively, between ethnic minorities and ethnic Bulgarians can be explained by differences in endowments. 

In regards to wage and public assistance income, a larger share of the respective 128 and -619 leva gap result from differences in coefficients than endowments (46.8 and 76.89 percent, respectively). 33 percent of the 428 leva mean difference in net household income is explained by difference in the coefficients. 

As was stated in the methodology section, the coefficient component of the decomposition uncovers how the same endowment is associated with a different flows of income for the two groups. Differences in coefficients are typically explained as evidence of discrimination. However, it would not typically be the case that the channel by which discrimination has consequence is solely through one coefficient or another. Rather, the effect of discrimination is cumulative. Therefore, in figure 2, which presents the decomposition of many of the coefficients estimated, the role of discrimination is slightly difficult to make sense of. Many independent variables do not have statistically significant effects, despite both the coefficient and endowment effects estimated having large and statistically significant explanatory power. 

However, figure 2 does tell an important piece of the story of ethnic inequality with regards to education. The coefficient term with regards to wage and household income shows smaller returns to education for ethnic minorities than ethnic Bulgarians. An additional level of educational certification (e.g. high school diploma to bachelor's) is associated with 77 leva increase in household income and 48 leva rise in wage income for ethnic Bulgarians relative to ethnic minorities.

As is clear from figure 2, education stands quite alone in having a large statistically significant role in explaining the gap between ethnic minorities and ethnic Bulgarians; this stands true for all three models. In terms of both net household income and wage income, the combined size of the endowment and coefficient terms explain most of the gap between ethnic minorities and ethnic Bulgarians. 

```{r fig.cap = "Threeway Blinder-Oaxaca Decomposition by Ethnic Status", warning=FALSE, message=FALSE, echo=FALSE}

grid.arrange( 
              arrangeGrob(plota, top=textGrob("Wage and earned income",
                                      gp=gpar(fontsize=10,font=3))),                         arrangeGrob(plotb, top=textGrob("Net total household income",
                                      gp=gpar(fontsize=10,font=3))), 
              arrangeGrob(plotc, top=textGrob("Public assistance income",
                                      gp=gpar(fontsize=10,font=3))), 
              ncol=3,  
              bottom = textGrob("2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.", gp = gpar(fontface = 10, fontsize = 5), hjust = 1, x = 1)
              )
```


## Decomposing the sources of inequality between minorities in segregated and non-segregated communities

The Blinder-Oaxaca estimated for the previous section did not account for the role of residential segregation in driving inequality between ethnic minorities and ethnic Bulgarian nor within ethnic minorities. This section deals with that issue by estimating three Blinder-Oaxaca models of the exact form estimated in the previous section, except that the two groups being compared are ethnic minorities who live in segregated communities and ethnic minorities who do not. 

```{r, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}

#------------------ Blinder Oaxaca 
blinder_oaxaca_net_wages_seg <- oaxaca ((`monthly average net wages`) ~ Sex + children + Education_numeric + Age + Numeracy + Literacy + Semantics | Segregated, data = subset(combined_data, combined_data$`monthly average net wages`>0 & combined_data$ethnic_minority==1))

blinder_oaxaca_net_household_income_seg <- oaxaca ((`total net monthly household income`) ~ Sex + children + Education_numeric + Age + Numeracy + Literacy + Semantics | Segregated, data = subset(combined_data, combined_data$`total net monthly household income`>0 & combined_data$ethnic_minority==1))

blinder_oaxaca_public_assistanc_seg <- oaxaca ((`public assistance income`) ~ Sex + children + Education_numeric + Age + Numeracy + Literacy + Semantics | Segregated, data = subset(combined_data, combined_data$`public assistance income`>0 & combined_data$ethnic_minority==1))

#------------------ Plots 

plota <- plot(blinder_oaxaca_net_wages_seg, main= "Wage income", component.left = TRUE, group.weight = .5, variables = c("Sex", "children", "Education_numeric", "Age", "Numeracy", "Literacy"), variable.labels = c("Sex" = "Sex", "children"="Household w/ children", "Education_numeric"= "Education", "Age"="Age", "Numeracy"="Numeracy", "Literacy"="Literacy"), bar.color = c("limegreen", "hotpink", "steelblue"))

plotb <- plot(blinder_oaxaca_net_household_income_seg, main= "Net household income", component.left = TRUE, group.weight = .5, variables = c("Sex", "children", "Education_numeric", "Age", "Numeracy", "Literacy"), variable.labels = c("Sex" = "Sex", "children"="Household w/ children", "Education_numeric"= "Education", "Age"="Age", "Numeracy"="Numeracy", "Literacy"="Literacy"), bar.color = c("limegreen", "hotpink", "steelblue"))

plotc <- plot(blinder_oaxaca_public_assistanc_seg, main= "Public assistance income", component.left = TRUE, group.weight = .5, variables = c("Sex", "children", "Education_numeric", "Age", "Numeracy", "Literacy"), variable.labels = c("Sex" = "Sex", "children"="Household w/ children", "Education_numeric"= "Education", "Age"="Age", "Numeracy"="Numeracy", "Literacy"="Literacy"), bar.color = c("limegreen", "hotpink", "steelblue"))
```


```{r message=FALSE, warning=FALSE, echo = FALSE, results = "asis"}

#---- Kable Table
df2 <- as.data.frame( blinder_oaxaca_net_wages_seg$threefold$overall)
df2[,2] <- as.data.frame( blinder_oaxaca_net_household_income_seg$threefold$overall)
df2[,3] <- as.data.frame( blinder_oaxaca_public_assistanc_seg$threefold$overall)

colnames(df2) <- c("Wage Income", "Household Income", "Public Assistance")

kable(df2, "latex", booktabs = T, caption = "Threeway Decomposition of Segregation Effects within Ethnic Minorities", linesep = "", align = "l")  %>%
  kable_styling(position = "center")  %>% 
  kable_styling(latex_options = c("scale_down", "hold_position")) %>%
  footnote(general = "Incomes are reported in 2013 Bulgarian leva.", threeparttable = T, footnote_as_chunk = T) 
```

Between ethnically segregated communities and within ethnic minorities, there are large mean differences in income. The greatest differences is with respect to public assistance income, where such transfer income is on average 769 leva greater in segregated communities than non-segregated communities. In terms of annual household income, households in segregated communities see annual household incomes of 136 leva less. While differences in wages are an average 5.8 leva less per month for those in segregated communities with positive wage income. 

As before, table 8 outlines the main results of the decomposition. Unlike table 7, all three Blinder-Oaxaca models estimated here see no statistically significant results. The standard errors for the endowment, coefficient, and interaction terms are quite sizable. In figure 3, which outlines the decomposition by each independent variable, this same relationship holds: there are no statistically significant terms in figure 3 either. 

Even though the mean differences in income between segregated communities and non-segregated communities are large, the estimated provided here are insufficient evidence to establish the role, nature, and mechanisms behind any segregation effect. 


```{r fig.cap = "Threeway Decomposition of Segregation Effects within Ethnic Minorities", warning=FALSE, message=FALSE, echo=FALSE}

grid.arrange( 
              arrangeGrob(plota, top=textGrob("Wage and earned income",
                                      gp=gpar(fontsize=10,font=3))),                         arrangeGrob(plotb, top=textGrob("Net total household income",
                                      gp=gpar(fontsize=10,font=3))), 
              arrangeGrob(plotc, top=textGrob("Public assistance income",
                                      gp=gpar(fontsize=10,font=3))), 
              ncol=3,  
              bottom = textGrob("2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.", gp = gpar(fontface = 10, fontsize = 5), hjust = 1, x = 1)
              )
```


```{r, message=FALSE, warning=FALSE, echo = FALSE, results="hide"}
blinder_oaxaca_net_wages_seg$threefold$overall
blinder_oaxaca_net_wages_seg$y

blinder_oaxaca_net_household_income_seg$threefold$overall
blinder_oaxaca_net_household_income_seg$y

blinder_oaxaca_public_assistanc_seg$threefold$overall
blinder_oaxaca_public_assistanc_seg$y
```


#Discussion

The empirical strategy and estimates provided here, both those of the log-linear models and the Blinder-Oaxaca decomposition, strongly suggest that differences in endowments are not the only factor in driving economic inequality between ethnic minorities and ethnic Bulgarians. There seems to be strong case that factors specific to ethnic minorities are driving a sizable portion of the gap in mean income. These factors are likely some combination of employer discrimination and structural discrimination. 

The Blinder-Oaxaca models estimate that between roughly 30 and 60 percent of the difference in mean income between these groups can explained by differences in endowments. This can be read as strongly evidence of employment discrimination and structural discrimination that does not concern the distribution of endowments. According to the estimates produced here, employment discrimination may cause up roughly 50 percent or more of the difference in mean wages between minorities and ethnic Bulgarians. 

There is strong evidence that education plays an important role in driving inequality. Roughly a third of the difference in mean income from wages, public assistance, and total household income can be explained by lower levels of education (i.e. lower levels of educational endowment). Given that changing coefficients may be more difficult than changing endowments, investment in education amongst ethnic minorities is clearly a fruitful path.

Lastly, despite not finding a clearly statistically significant relationship between segregation and income -- that is with exception of model 3 in table 5 that finds a large and statistically significant segregation effect on public assistance income, there is reason to look closer into the role of segregation. The gap in income between ethnic minorities living in such communities and outside of them are so large that there is likely a mechanism driving this that is related to segregation. 

However, while reducing ethnic segregation may be a fruitful path, the contours of that policy program must be more thoroughly considered than this paper has allowed for and the mechanisms by which segregation cause income inequality ought to be better understood. 

#Conclusion

This paper provides strong evidence that the size of ethnic inequality is large, that discrimination likely plays a predominant role, and increasing education is likely one of the clearest paths to reducing inequality. However, there are additional steps that ought to be taken in future research. 

1) The empirical approach taken here ought to be expanded to questions of employment inequality.

2) The relationship between wage discrimination, public assistance use, and lower rates of employment amongst minorities ought to be considered. Namely, if expected earnings for ethnic minorities are depressed relative to ethnic Bulgarians because of wage discrimination, there may be cause for ethnic minorities to find informal work so to retain public assistance income or work abroad. In turn, wage discrimination may be artificially suppressing employment rates amongst minorities. 

3) Unlike the methods used here, employment must be considered with a non-linear estimation technique, such as a probit model. Therefore, future research ought to employ a Blinder-Oaxaca model that utilize a probit model at its heart. 

4) Future analysis ought to deal with the selection issues faced. In our data on wages, for instance, data is only available for those employed. Meaning, wage information for those who are not employed are unknown. It may be the case that wage discrimination is even more severe than this data suggests because the wage that employer would be willing to hire at is below the minimum wage. However, selection issues also apply to public assistance use and segregation. 

\newpage
#References