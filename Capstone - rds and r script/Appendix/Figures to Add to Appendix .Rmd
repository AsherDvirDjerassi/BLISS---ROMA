---
title: "Figures to Add to Appendix Later"
author: "Asher Dvir-Djerassi"
date: "5/5/2019"
output: pdf_document
---





\newpage

## Distribution of incomes for weighted and unweighted samples

Figure 5 continues to display the distribution of earned income by ethnic group and by the weighted and unweighted sample. 

```{r fig.cap = "Monthly average net wages for households with positive incomes by weighted and unweighted sample",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}


ethnic_group_weights <- hh_data %>%
  group_by(ethnic_group)  %>%
  summarise(ethnic_group_weights = sum(`household weights`))

hh_data <- hh_data %>%
  left_join(ethnic_group_weights, by = "ethnic_group")

plot1 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group))), aes(x=`ethnic_group`, y=`monthly average net wages`)) + labs(title = "Without household sample weights", x = "Ethnic groups" ) + ylim(1, 3000) +geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))+coord_flip()
  
plot2 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group))), mapping = aes(x=ethnic_group, y=`monthly average net wages`, weights = `household weights`/sum(`household weights`))) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1)) + coord_flip()


grid.arrange(
  plot1,
  plot2,
  nrow = 2,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes. Wage income includes all earned income.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)

```


To a greater extent than figure 5, figure 6 is able to more clearly communicate the extent to which the income distribution is shifted upward for ethnic Bulgarians relative to Turks and Roma. 

```{r fig.cap = "Distribution of monthly total net total household income for households with positive incomes by weighted and unweighted samples",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

plot1 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group))), aes(x=`ethnic_group`, y=`total net monthly household income`)) + labs(title = "Without household sample weights", x = "Ethnic groups" ) + ylim(1, 3000) +geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1))+coord_flip()
  
plot2 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group))), mapping = aes(x=ethnic_group, y=`total net monthly household income`, weights = `household weights`/sum(`household weights`))) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1)) + coord_flip()


grid.arrange(
  plot1,
  plot2,
  nrow = 2,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)
```


Figure 7 looks at the distribution of government transfer income (social assistance, heating allowance, child, and infant benefits) for household's with positive transfer income. As is clear from the unweighted data, Roma households quite clearly see more income from such government benefits. 

```{r fig.cap = "Total net monthly household income from government benefits for households with positive government benefit incomes by weighted and unweighted sample",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

hh_data$`transfer income` <- hh_data$`monthly value of social assistance`+hh_data$`monthly value of heating allowance`+hh_data$`monthly value of child benefits`+hh_data$`monthly value of infant benefits`

plot1 <- ggplot(subset(hh_data, (!is.na(hh_data$ethnic_group))), aes(x=`ethnic_group`, y=`transfer income` )) + labs(title = "Without household sample weights", x = "Ethnic groups" ) + ylim(1, 1000) +geom_violin(alpha=0.5, color="gray") +coord_flip()
  
plot2 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group))), mapping = aes(x=ethnic_group, y=`transfer income` , weights = `household weights`/sum(`household weights`))) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 1000) + geom_violin(alpha=0.5, color="gray")  + coord_flip()

grid.arrange(
  plot1,
  plot2,
  nrow = 2,
  bottom = textGrob(
    "2013 Bulgarian Leva. Observations restricted to those with positive incomes.",
    gp = gpar(fontface = 3, fontsize = 7),
    hjust = 1,
    x = 1
  )
)
```



```{r message=FALSE, warning=FALSE, echo=FALSE}

#CONSIDER OTHER WAYS OF USING WEIGHTS LATER

#plot1 <- ggplot(subset(hh_data,(!is.na(hh_data$ethnic_group))), mapping = aes(x=ethnic_group, y=`total net monthly household income`, weights = `household weights`, bw = ethnic_group_weights)) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1)) + coord_flip()

#plot2 <- ggplot(combined_data, mapping = aes(x=ethnic_group, y=`monthly average net wages`, weights = `household weights`, bw = ethnic_group_weights)) + labs(title = "With household sample weights", x = "Ethnic groups") + ylim(1, 3000) + geom_violin(alpha=0.5, color="gray") + geom_jitter(alpha=0.5, aes(ethnic_group), position = position_jitter(width = 0.1)) + coord_flip()
```

\newpage
## Education and standarized test results

Given that education quality may differ between ethnic groups and across the whole population, the BLISS asked a random sample of adult respondents to take a standarized numeracy and literacy test. Figure 8 shows that there is clearly a strong positive relationship between the mean numeracy score and one's level of education. 

```{r fig.cap = "Mean numeracy score by education level",message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}
  
ggplot(aes(x = Education, y = Numeracy), data = combined_data) + stat_summary(fun.y = "mean", geom = "bar") + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + theme_hc()+ scale_colour_hc()
```

A simple OLS estimation of the effect of education on numeracy and literacy test results also confirms this relationship implying the strength of these tests as measure of labor market relevant skills. 

```{r message=FALSE, warning=FALSE, echo=FALSE, results = "asis"}

stargazer(lm(Numeracy ~ Education, combined_data), lm(Literacy ~ Education, combined_data), title="OLS estimates: Educational attainment on standarized test score", covariate.labels=c("initial", "primary", "secondary", "bachelor's", "master's", "PhD", "Constant"), header=FALSE)
```
